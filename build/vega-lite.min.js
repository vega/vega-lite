!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vl=e()}}(function(){return function o(a,s,l){function c(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(u)return u(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var r=s[n]={exports:{}};a[n][0].call(r.exports,function(e){var t=a[n][1][e];return c(t||e)},r,r.exports,o,a,s,l)}return s[n].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){var y="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var p=t.space||"";"number"==typeof p&&(p=Array(p+1).join(" "));var o,g="boolean"==typeof t.cycles&&t.cycles,m=t.replacer||function(e,t){return t},h=t.cmp&&(o=t.cmp,function(r){return function(e,t){var n={key:e,value:r[e]},i={key:t,value:r[t]};return o(n,i)}}),v=[];return function e(t,n,i,r){var o=p?"\n"+new Array(r+1).join(p):"",a=p?": ":":";if(i&&i.toJSON&&"function"==typeof i.toJSON&&(i=i.toJSON()),void 0!==(i=m.call(t,n,i))){if("object"!=typeof i||null===i)return y.stringify(i);if(b(i)){for(var s=[],l=0;l<i.length;l++){var c=e(i,l,i[l],r+1)||y.stringify(null);s.push(o+p+c)}return"["+s.join(",")+o+"]"}if(-1!==v.indexOf(i)){if(g)return y.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}v.push(i);var u=O(i).sort(h&&h(i));for(s=[],l=0;l<u.length;l++){var f=e(i,n=u[l],i[n],r+1);if(f){var d=y.stringify(n)+a+f;s.push(o+p+d)}}return v.splice(v.indexOf(i),1),"{"+s.join(",")+o+"}"}}({"":e},"",e,0)};var b=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},O=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var i in e)t.call(e,i)&&n.push(i);return n}},{jsonify:2}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var i,r,o,s,a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:i,text:o}},c=function(e){return e&&e!==r&&l("Expected '"+e+"' instead of '"+r+"'"),r=o.charAt(i),i+=1,r},u=function(){var e,t="";for("-"===r&&c(t="-");"0"<=r&&r<="9";)t+=r,c();if("."===r)for(t+=".";c()&&"0"<=r&&r<="9";)t+=r;if("e"===r||"E"===r)for(t+=r,c(),"-"!==r&&"+"!==r||(t+=r,c());"0"<=r&&r<="9";)t+=r,c();if(e=+t,isFinite(e))return e;l("Bad number")},f=function(){var e,t,n,i="";if('"'===r)for(;c();){if('"'===r)return c(),i;if("\\"===r)if(c(),"u"===r){for(t=n=0;t<4&&(e=parseInt(c(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof a[r])break;i+=a[r]}else i+=r}l("Bad string")},d=function(){for(;r&&r<=" ";)c()};s=function(){switch(d(),r){case"{":return function(){var e,t={};if("{"===r){if(c("{"),d(),"}"===r)return c("}"),t;for(;r;){if(e=f(),d(),c(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=s(),d(),"}"===r)return c("}"),t;c(","),d()}}l("Bad object")}();case"[":return function(){var e=[];if("["===r){if(c("["),d(),"]"===r)return c("]"),e;for(;r;){if(e.push(s()),d(),"]"===r)return c("]"),e;c(","),d()}}l("Bad array")}();case'"':return f();case"-":return u();default:return"0"<=r&&r<="9"?u():function(){switch(r){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}l("Unexpected '"+r+"'")}()}},t.exports=function(e,a){var t;return o=e,i=0,r=" ",t=s(),d(),r&&l("Syntax error"),"function"==typeof a?function e(t,n){var i,r,o=t[n];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(r=e(o,i))?o[i]=r:delete o[i]);return a.call(t,n,o)}({"":t},""):t}},{}],4:[function(e,t,n){var u,f,d,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function p(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,function(e){var t=r[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}t.exports=function(e,t,n){var i;if(f=u="","number"==typeof n)for(i=0;i<n;i+=1)f+=" ";else"string"==typeof n&&(f=n);if((d=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,n){var i,r,o,a,s,l=u,c=n[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof d&&(c=d.call(n,t,c)),typeof c){case"string":return p(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(u+=f,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,i=0;i<a;i+=1)s[i]=e(i,c)||"null";return o=0===s.length?"[]":u?"[\n"+u+s.join(",\n"+u)+"\n"+l+"]":"["+s.join(",")+"]",u=l,o}if(d&&"object"==typeof d)for(a=d.length,i=0;i<a;i+=1)"string"==typeof(r=d[i])&&(o=e(r,c))&&s.push(p(r)+(u?": ":":")+o);else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o=e(r,c))&&s.push(p(r)+(u?": ":":")+o);return o=0===s.length?"{}":u?"{\n"+u+s.join(",\n"+u)+"\n"+l+"}":"{"+s.join(",")+"}",u=l,o}}("",{"":e})}},{}],5:[function(e,t,n){var i,r,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?u=c.concat(u):d=-1,u.length&&g())}function g(){if(!f){var e=l(p);f=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,f=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||f||l(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],6:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],7:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(d,e,T){(function(i,r){var s=/%[sdj%]/g;T.format=function(e){if(!O(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(l(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,r=i.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(r<=n)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),a=i[n];n<r;a=i[++n])y(a)||!u(a)?o+=" "+a:o+=" "+l(a);return o},T.deprecate=function(e,t){if(_(r.process))return function(){return T.deprecate(e,t).apply(this,arguments)};if(!0===i.noDeprecation)return e;var n=!1;return function(){if(!n){if(i.throwDeprecation)throw new Error(t);i.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}};var e,o={};function l(e,t){var n={seen:[],stylize:c};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),v(t)?n.showHidden=t:t&&T._extend(n,t),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=a),p(n,e,n.depth)}function a(e,t){var n=l.styles[t];return n?"["+l.colors[n][0]+"m"+e+"["+l.colors[n][1]+"m":e}function c(e,t){return e}function p(t,n,i){if(t.customInspect&&n&&w(n.inspect)&&n.inspect!==T.inspect&&(!n.constructor||n.constructor.prototype!==n)){var e=n.inspect(i,t);return O(e)||(e=p(t,e,i)),e}var r=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(O(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(b(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(t,n);if(r)return r;var o,a=Object.keys(n),s=(o={},a.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return g(n);if(0===a.length){if(w(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(S(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return t.stylize(Date.prototype.toString.call(n),"date");if(x(n))return g(n)}var c,u="",f=!1,d=["{","}"];(h(n)&&(f=!0,d=["[","]"]),w(n))&&(u=" [Function"+(n.name?": "+n.name:"")+"]");return S(n)&&(u=" "+RegExp.prototype.toString.call(n)),E(n)&&(u=" "+Date.prototype.toUTCString.call(n)),x(n)&&(u=" "+g(n)),0!==a.length||f&&0!=n.length?i<0?S(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=f?function(t,n,i,r,e){for(var o=[],a=0,s=n.length;a<s;++a)N(n,String(a))?o.push(m(t,n,i,r,String(a),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(m(t,n,i,r,e,!0))}),o}(t,n,i,s,a):a.map(function(e){return m(t,n,i,s,e,f)}),t.seen.pop(),function(e,t,n){if(60<e.reduce(function(e,t){return 0,0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,u,d)):d[0]+u+d[1]}function g(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,n,i,r,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),N(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(l.value)<0?-1<(s=y(n)?p(e,l.value,null):p(e,l.value,n-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),_(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function b(e){return"number"==typeof e}function O(e){return"string"==typeof e}function _(e){return void 0===e}function S(e){return u(e)&&"[object RegExp]"===t(e)}function u(e){return"object"==typeof e&&null!==e}function E(e){return u(e)&&"[object Date]"===t(e)}function x(e){return u(e)&&("[object Error]"===t(e)||e instanceof Error)}function w(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function n(e){return e<10?"0"+e.toString(10):e.toString(10)}T.debuglog=function(t){if(_(e)&&(e=i.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var n=i.pid;o[t]=function(){var e=T.format.apply(T,arguments);console.error("%s %d: %s",t,n,e)}}else o[t]=function(){};return o[t]},(T.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},T.isArray=h,T.isBoolean=v,T.isNull=y,T.isNullOrUndefined=function(e){return null==e},T.isNumber=b,T.isString=O,T.isSymbol=function(e){return"symbol"==typeof e},T.isUndefined=_,T.isRegExp=S,T.isObject=u,T.isDate=E,T.isError=x,T.isFunction=w,T.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},T.isBuffer=d("./support/isBuffer");var f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}T.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[n(e.getHours()),n(e.getMinutes()),n(e.getSeconds())].join(":"),[e.getDate(),f[e.getMonth()],t].join(" ")),T.format.apply(T,arguments))},T.inherits=d("inherits"),T._extend=function(e,t){if(!t||!u(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,d("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}],9:[function(e,t,n){var i;i=this,function(e){"use strict";var f,d,i="view",p="[",g="]",m="{",h="}",v=":",y=",",b="@",o=">",O=/[[\]{}]/,r={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function _(e,t,n,i,r){for(var o,a=0,s=e.length;t<s;++t){if(o=e[t],!a&&o===n)return t;r&&0<=r.indexOf(o)?--a:i&&0<=i.indexOf(o)&&++a}return t}function a(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=_(e,r,y,p+m,g+h),t.push(e.substring(n,r).trim()),n=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function s(e){return"["===e[0]?function(e){var t,n,i=e.length,r=1;if((r=_(e,r,g,p,g))===i)throw"Empty between selector: "+e;if(2!==(t=a(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(r+1).trim())[0]!==o)throw"Expected '>' after between selector: "+e;{if(t=t.map(s),(n=s(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t}return n}(e):function(t){var e,n,i={source:f},r=[],o=[0,0],a=0,s=0,l=t.length,c=0;if(t[l-1]===h){if(!(0<=(c=t.lastIndexOf(m))))throw"Unmatched right brace: "+t;try{o=function(n){var e=n.split(y);if(!n.length||2<e.length)throw n;return e.map(function(e){var t=+e;if(t!=t)throw n;return t})}(t.substring(c+1,l-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,c).trim(),l=t.length,c=0}if(!l)throw t;t[0]===b&&(a=++c);(e=_(t,c,v))<l&&(r.push(t.substring(s,e).trim()),s=c=++e);if((c=_(t,c,p))===l)r.push(t.substring(s,l).trim());else if(r.push(t.substring(s,c).trim()),n=[],(s=++c)===l)throw"Unmatched left bracket: "+t;for(;c<l;){if((c=_(t,c,g))===l)throw"Unmatched left bracket: "+t;if(n.push(t.substring(s,c).trim()),c<l-1&&t[++c]!==p)throw"Expected left bracket: "+t;s=++c}if(!(l=r.length)||O.test(r[l-1]))throw"Invalid event selector: "+t;1<l?(i.type=r[1],a?i.markname=r[0].slice(1):(u=r[0],d.hasOwnProperty(u)?i.marktype=r[0]:i.source=r[0])):i.type=r[0];var u;"!"===i.type.slice(-1)&&(i.consume=!0,i.type=i.type.slice(0,-1));null!=n&&(i.filter=n);o[0]&&(i.throttle=o[0]);o[1]&&(i.debounce=o[1]);return i}(e)}e.selector=function(e,t,n){return f=t||i,d=n||r,a(e.trim()).map(s)},Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:i.vega=i.vega||{})},{}],10:[function(e,t,n){var i;i=this,function(e){"use strict";var h=function(e,t,n){return e.fields=t||[],e.fname=n,e};function v(e){return null==e?null:e.fields}var u=function(e){throw Error(e)},y=function(e){var t,n,i,r=[],o=null,a=0,s=e.length,l="";function c(){r.push(l+e.substring(t,n)),l="",t=n+1}for(e+="",t=n=0;n<s;++n)if("\\"===(i=e[n]))l+=e.substring(t,n),t=++n;else if(i===o)c(),o=null,a=-1;else{if(o)continue;t===a&&'"'===i?(t=n+1,o=i):t===a&&"'"===i?(t=n+1,o=i):"."!==i||a?"["===i?(t<n&&c(),a=t=n+1):"]"===i&&(a||u("Access path missing open bracket: "+e),0<a&&c(),a=0,t=n+1):t<n?c():t=n+1}return a&&u("Access path missing closing bracket: "+e),o&&u("Access path missing closing quote: "+e),t<n&&(n++,c()),r},t=Array.isArray,n=function(e){return e===Object(e)},i=function(e){return"string"==typeof e};function b(e){return t(e)?"["+e.map(b)+"]":n(e)||i(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var r=function(e,t){var n=y(e),i="return _["+n.map(b).join("][")+"];";return h(Function("_",i),[e=1===n.length?n[0]:e],t||e)},o=[],a=r("id"),s=h(function(e){return e},o,"identity"),l=h(function(){return 0},o,"zero"),c=h(function(){return 1},o,"one"),f=h(function(){return!0},o,"true"),d=h(function(){return!1},o,"false");function p(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var g=function(e){return e[e.length-1]},m=function(e){return null==e||""===e?null:+e};function O(t){return function(e){return t*Math.exp(e)}}function _(t){return function(e){return Math.log(t*e)}}function S(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function E(e,t,n,i){var r=n(e[0]),o=n(g(e)),a=(o-r)*t;return[i(r-a),i(o-a)]}function x(e,t,n,i,r){var o=i(e[0]),a=i(g(e)),s=null!=t?i(t):(o+a)/2;return[r(s+(o-s)*n),r(s+(a-s)*n)]}var w=function(e){return null!=e?t(e)?e:[e]:[]},N=function(e){return"function"==typeof e},T={},P=function(e){return"[object Date]"===Object.prototype.toString.call(e)},D=function(e){return"number"==typeof e},k=function(e,t){for(var n="";0<=--t;)n+=e;return n};function j(e){return D(e)?e:P(e)?e:Date.parse(e)}e.accessor=h,e.accessorName=function(e){return null==e?null:e.fname},e.accessorFields=v,e.id=a,e.identity=s,e.zero=l,e.one=c,e.truthy=f,e.falsy=d,e.logger=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return 1<=t&&p("error","ERROR",arguments),this},warn:function(){return 2<=t&&p("warn","WARN",arguments),this},info:function(){return 3<=t&&p("log","INFO",arguments),this},debug:function(){return 4<=t&&p("log","DEBUG",arguments),this}}},e.None=0,e.Error=1,e.Warn=2,e.Info=3,e.Debug=4,e.panLinear=function(e,t){return E(e,t,m,s)},e.panLog=function(e,t){var n=Math.sign(e[0]);return E(e,t,_(n),O(n))},e.panPow=function(e,t,n){return E(e,t,S(n),S(1/n))},e.zoomLinear=function(e,t,n){return x(e,t,n,m,s)},e.zoomLog=function(e,t,n){var i=Math.sign(e[0]);return x(e,t,n,_(i),O(i))},e.zoomPow=function(e,t,n,i){return x(e,t,n,S(i),S(1/i))},e.array=w,e.compare=function(e,t){var n,i,r,o,a,s,l,c,u,f=[],d=(e=w(e)).map(function(e,t){return null==e?null:(f.push(t),N(e)?e:y(e).map(b).join("]["))}),p=f.length-1,g=w(t),m="var u,v;return ";if(p<0)return null;for(i=0;i<=p;++i)r=d[n=f[i]],N(r)?(o="(u=this."+(s="f"+n)+"(a))",a="(v=this."+s+"(b))",(l=l||{})[s]=r):(o="(u=a["+r+"])",a="(v=b["+r+"])"),s="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==g[n]?c=-(u=1):(u=-1,c=1),m+="("+o+"<"+a+"||u==null)&&v!=null?"+c+":(u>v||v==null)&&u!=null?"+u+":"+s+"!==u&&v===v?"+c+":v!==v&&u===u?"+u+(n<p?":":":0");return r=Function("a","b",m+";"),l&&(r=r.bind(l)),e=e.reduce(function(t,e){return N(e)?(v(e)||[]).forEach(function(e){t[e]=1}):null!=e&&(t[e+""]=1),t},{}),h(r,Object.keys(e))},e.constant=function(e){return N(e)?e:function(){return e}},e.debounce=function(t,e){var n,i;function r(){e(i),n=i=null}return function(e){i=e,n&&clearTimeout(n),n=setTimeout(r,t)}},e.error=u,e.extend=function(e){for(var t,n,i=1,r=arguments.length;i<r;++i)for(n in t=arguments[i])e[n]=t[n];return e},e.extentIndex=function(e,t){var n,i,r,o,a,s=-1,l=e.length;if(null==t){for(;++s<l;)if(null!=(i=e[s])&&i<=i){n=r=i;break}for(o=a=s;++s<l;)null!=(i=e[s])&&(i<n&&(n=i,o=s),r<i&&(r=i,a=s))}else{for(;++s<l;)if(null!=(i=t(e[s],s,e))&&i<=i){n=r=i;break}for(o=a=s;++s<l;)null!=(i=t(e[s],s,e))&&(i<n&&(n=i,o=s),r<i&&(r=i,a=s))}return[o,a]},e.fastmap=function(t){var r,o,a={};function n(e){return a.hasOwnProperty(e)&&a[e]!==T}return r={size:0,empty:0,object:a,has:n,get:function(e){return n(e)?a[e]:void 0},set:function(e,t){return n(e)||(++r.size,a[e]===T&&--r.empty),a[e]=t,this},delete:function(e){return n(e)&&(--r.size,++r.empty,a[e]=T),this},clear:function(){r.size=r.empty=0,r.object=a={}},test:function(e){return arguments.length?(o=e,r):o},clean:function(){var e,t,n={},i=0;for(e in a)(t=a[e])===T||o&&o(t)||(n[e]=t,++i);r.size=i,r.empty=0,r.object=a=n}},t&&Object.keys(t).forEach(function(e){r.set(e,t[e])}),r},e.field=r,e.inherits=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},e.isArray=t,e.isBoolean=function(e){return"boolean"==typeof e},e.isDate=P,e.isFunction=N,e.isNumber=D,e.isObject=n,e.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},e.isString=i,e.key=function(e,t){e&&(e=t?w(e).map(function(e){return e.replace(/\\(.)/g,"$1")}):w(e));var n=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+(t?b(e):y(e).map(b).join("]["))+"]"}).join("+'|'+")+";"):function(){return""};return h(n,e,"key")},e.merge=function(e,t,n,i){var r=t.length,o=n.length;if(!o)return t;if(!r)return n;for(var a=i||new t.constructor(r+o),s=0,l=0,c=0;s<r&&l<o;++c)a[c]=0<e(t[s],n[l])?n[l++]:t[s++];for(;s<r;++s,++c)a[c]=t[s];for(;l<o;++l,++c)a[c]=n[l];return a},e.pad=function(e,t,n,i){var r=n||" ",o=e+"",a=t-o.length;return a<=0?o:"left"===i?k(r,a)+o:"center"===i?k(r,~~(a/2))+o+k(r,Math.ceil(a/2)):o+k(r,a)},e.peek=g,e.repeat=k,e.splitAccessPath=y,e.stringValue=b,e.toBoolean=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)},e.toDate=function(e,t){return t=t||j,null==e||""===e?null:t(e)},e.toNumber=m,e.toString=function(e){return null==e||""===e?null:e+""},e.toSet=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t},e.truncate=function(e,t,n,i){var r=null!=i?i:"â€¦",o=e+"",a=o.length,s=Math.max(0,t-r.length);return a<=t?o:"left"===n?r+o.slice(a-s):"center"===n?o.slice(0,Math.ceil(s/2))+r+o.slice(a-~~(s/2)):o.slice(0,s)+r},e.visitArray=function(e,t,n){if(e){var i,r=0,o=e.length;if(t)for(;r<o;++r)(i=t(e[r]))&&n(i,r,e);else e.forEach(n)}},Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:i.vega=i.vega||{})},{}],11:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.3.1",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/src/index.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",types:"typings/vega-lite.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",prebuild:"mkdir -p build/site build/test-gallery",build:"npm run build:only","build:only":"tsc && cp package.json build && browserify src/index.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"node node_modules/uglify-js/bin/uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && npm run build:only && npm run build:examples-only","build:examples-only":"npm run build:example && npm run build:examples-normalized","build:examples-normalized":"rm -f examples/specs/normalized/*.vl.json && scripts/build-normalized-examples","build:example":"TZ=America/Los_Angeles scripts/build-examples.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts)' -delete && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' -type f -exec rm -f {} +",data:"rsync -r node_modules/vega-datasets/data/* data",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"ts-json-schema-generator --path tsconfig.json --type TopLevelSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run prebuild && npm run data && npm run build:site && npm run build:toc && npm run build:versions && scripts/create-example-pages",site:"bundle exec jekyll serve --incremental",lint:"tslint -p .",test:"npm run build:only && npm run test:only && npm run test:runtime && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run test:runtime && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:runtime":"TZ=America/Los_Angeles wdio wdio.conf.js","test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","test:debug":"tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/index.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.1.2","@types/d3":"^4.13.0","@types/highlight.js":"^9.12.2","@types/mkdirp":"^0.5.2","@types/mocha":"^2.2.48","@types/node":"^9.4.7","@types/webdriverio":"^4.10.0",ajv:"^6.2.1","browser-sync":"^2.23.6","browserify-shim":"^3.8.14",browserify:"^16.1.1",chai:"^4.1.2",cheerio:"^1.0.0-rc.2",chromedriver:"^2.36.0",codecov:"^3.0.0",d3:"^4.13.0",exorcist:"^1.0.1","highlight.js":"^9.12.0",mkdirp:"^0.5.1",mocha:"^5.0.4",nodemon:"^1.17.1",nyc:"^11.4.1","source-map-support":"^0.5.3","svg2png-many":"^0.0.7","ts-json-schema-generator":"^0.21.0","ts-node":"^5.0.1",tsify:"^3.0.4","tslint-eslint-rules":"^5.1.0",tslint:"5.9.1",typescript:"^2.7.2","uglify-js":"^3.3.14","vega-datasets":"^1.18.0","vega-embed":"^3.1.1","vega-tooltip":"^0.6.1",vega:"^3.2.1",watchify:"^3.11.0","wdio-chromedriver-service":"^0.1.2","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.13","wdio-static-server-service":"^1.0.1",webdriverio:"^4.12.0","yaml-front-matter":"^4.0.0"},dependencies:{"@types/json-stable-stringify":"^1.0.32","vega-typings":"^0.2.11","json-stable-stringify":"^1.0.1",tslib:"^1.9.0","vega-event-selector":"^2.0.0","vega-util":"^1.7.0",yargs:"^11.0.0"}}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),r=e("./util"),o={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};n.AGGREGATE_OPS=r.flagKeys(o),n.isAggregateOp=function(e){return!!o[e]},n.COUNTING_OPS=["count","valid","missing","distinct"],n.isCountingAggregateOp=function(e){return e&&r.contains(n.COUNTING_OPS,e)},n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=i.toSet(n.SHARED_DOMAIN_OPS)},{"./util":125,"vega-util":10}],13:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.AXIS_PARTS=["domain","grid","labels","ticks","title"],n.AXIS_PROPERTY_TYPE={grid:"grid",gridScale:"grid",domain:"main",labels:"main",labelFlush:"main",labelOverlap:"main",minExtent:"main",maxExtent:"main",offset:"main",ticks:"main",title:"main",values:"both",scale:"both",zindex:"both"};var o={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},a=i({},o,{encoding:1,labelAngle:1,titleMaxLength:1}),s=i({scale:1},o,{gridScale:1,encode:1});n.isAxisProperty=function(e){return!!a[e]},n.VG_AXIS_PROPERTIES=r.flagKeys(s),n.AXIS_PROPERTIES=r.flagKeys(a)},{"./util":125}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),r=e("./channel"),o=e("./util");n.binToString=function(t){return i.isBoolean(t)?"bin":"bin"+o.keys(t).map(function(e){return o.varName("_"+e+"_"+t[e])}).join("")},n.autoMaxBins=function(e){switch(e){case r.ROW:case r.COLUMN:case r.SIZE:case r.COLOR:case r.FILL:case r.STROKE:case r.OPACITY:case r.SHAPE:return 6;default:return 10}}},{"./channel":15,"./util":125,"vega-util":10}],15:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var o,a,s=e("./util");(a=o=n.Channel||(n.Channel={})).ROW="row",a.COLUMN="column",a.X="x",a.Y="y",a.X2="x2",a.Y2="y2",a.LATITUDE="latitude",a.LONGITUDE="longitude",a.LATITUDE2="latitude2",a.LONGITUDE2="longitude2",a.COLOR="color",a.FILL="fill",a.STROKE="stroke",a.SHAPE="shape",a.SIZE="size",a.OPACITY="opacity",a.TEXT="text",a.ORDER="order",a.DETAIL="detail",a.KEY="key",a.TOOLTIP="tooltip",a.HREF="href",n.X=o.X,n.Y=o.Y,n.X2=o.X2,n.Y2=o.Y2,n.LATITUDE=o.LATITUDE,n.LATITUDE2=o.LATITUDE2,n.LONGITUDE=o.LONGITUDE,n.LONGITUDE2=o.LONGITUDE2,n.ROW=o.ROW,n.COLUMN=o.COLUMN,n.SHAPE=o.SHAPE,n.SIZE=o.SIZE,n.COLOR=o.COLOR,n.FILL=o.FILL,n.STROKE=o.STROKE,n.TEXT=o.TEXT,n.DETAIL=o.DETAIL,n.KEY=o.KEY,n.ORDER=o.ORDER,n.OPACITY=o.OPACITY,n.TOOLTIP=o.TOOLTIP,n.HREF=o.HREF,n.GEOPOSITION_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1},n.GEOPOSITION_CHANNELS=s.flagKeys(n.GEOPOSITION_CHANNEL_INDEX);var l=i({x:1,y:1,x2:1,y2:1},n.GEOPOSITION_CHANNEL_INDEX,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});n.isColorChannel=function(e){return"color"===e||"fill"===e||"stroke"===e};var c=i({},l,{row:1,column:1});n.CHANNELS=s.flagKeys(c);c.order,c.detail;var u=r(c,["order","detail"]);n.SINGLE_DEF_CHANNELS=s.flagKeys(u),n.isChannel=function(e){return!!c[e]},n.UNIT_CHANNELS=s.flagKeys(l);l.x,l.y,l.x2,l.y2,l.latitude,l.longitude,l.latitude2,l.longitude2;var f=r(l,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]);n.NONPOSITION_CHANNELS=s.flagKeys(f);var d={x:1,y:1};n.POSITION_SCALE_CHANNELS=s.flagKeys(d);f.text,f.tooltip,f.href,f.detail,f.key,f.order;var p=r(f,["text","tooltip","href","detail","key","order"]);n.NONPOSITION_SCALE_CHANNELS=s.flagKeys(p);var g=i({},d,p);function m(e){switch(e){case n.COLOR:case n.FILL:case n.STROKE:case n.DETAIL:case n.KEY:case n.TOOLTIP:case n.HREF:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0,geoshape:!0};case n.X:case n.Y:case n.LATITUDE:case n.LONGITUDE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:case n.LATITUDE2:case n.LONGITUDE2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0,geoshape:!0};case n.TEXT:return{text:!0}}}n.SCALE_CHANNELS=s.flagKeys(g),n.isScaleChannel=function(e){return!!g[e]},n.supportMark=function(e,t){return t in m(e)},n.getSupportedMark=m,n.rangeType=function(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:case n.HREF:return"discrete";case n.COLOR:case n.FILL:case n.STROKE:return"flexible";case n.LATITUDE:case n.LONGITUDE:case n.LATITUDE2:case n.LONGITUDE2:case n.DETAIL:case n.KEY:case n.ORDER:return}throw new Error("rangeType not implemented for "+e)}},{"./util":125}],16:[function(e,t,n){"use strict";var h=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},v=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var y=e("util"),b=e("../../axis"),O=e("../../fielddef"),_=e("../../util");function a(e,n,t,i){void 0===i&&(i={header:!1});var r=e.combine(),o=r.orient,a=r.scale,s=r.title,l=v(r,["orient","scale","title"]);if(_.keys(l).forEach(function(e){var t=b.AXIS_PROPERTY_TYPE[e];t&&t!==n&&"both"!==t&&delete l[e]}),"grid"===n){if(!l.grid)return;if(l.encode){var c=l.encode.grid;l.encode=h({},c?{grid:c}:{}),0===_.keys(l.encode).length&&delete l.encode}return h({scale:a,orient:o},l,{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0})}if(i.header||!e.mainExtracted){if(l.encode){for(var u=0,f=b.AXIS_PARTS;u<f.length;u++){var d=f[u];e.hasAxisPart(d)||delete l.encode[d]}0===_.keys(l.encode).length&&delete l.encode}var p,g,m=(p=s,g=t,y.isArray(p)?p.map(function(e){return O.title(e,g)}).join(", "):p);return h({scale:a,orient:o},m?{title:m}:{},l,{zindex:1})}}n.assembleAxis=a,n.assembleAxes=function(e,t){var n=e.x,i=void 0===n?[]:n,r=e.y,o=void 0===r?[]:r;return i.map(function(e){return a(e,"main",t)}).concat(i.map(function(e){return a(e,"grid",t)}),o.map(function(e){return a(e,"main",t)}),o.map(function(e){return a(e,"grid",t)})).filter(function(e){return e})}},{"../../axis":13,"../../fielddef":106,"../../util":125,util:8}],17:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../util");var r=function(r){function e(e,t,n){void 0===e&&(e={}),void 0===t&&(t={}),void 0===n&&(n=!1);var i=r.call(this)||this;return i.explicit=e,i.implicit=t,i.mainExtracted=n,i}return o(e,r),e.prototype.clone=function(){return new e(a.duplicate(this.explicit),a.duplicate(this.implicit),this.mainExtracted)},e.prototype.hasAxisPart=function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t},e}(e("../split").Split);n.AxisComponent=r},{"../../util":125,"../split":95}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getAxisConfig=function(e,t,n,i,r){void 0===i&&(i="");for(var o=0,a=("band"===r?["axisBand"]:[]).concat(["x"===n?"axisX":"axisY","axis"+i.substr(0,1).toUpperCase()+i.substr(1),"axis"]);o<a.length;o++){var s=a[o];if(t[s]&&void 0!==t[s][e])return t[s][e]}}},{}],19:[function(e,t,n){"use strict";var f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),d=e("../../fielddef"),p=e("../../scale"),r=e("../../type"),g=e("../../util"),m=e("../common"),h=e("./config");function v(e,t){return"top"===t||"bottom"===t?e<=45||315<=e?{value:"top"===t?"bottom":"top"}:135<=e&&e<=225?{value:"top"===t?"top":"bottom"}:{value:"middle"}:e<=45||315<=e||135<=e&&e<=225?{value:"middle"}:45<=e&&e<=135?{value:"left"===t?"top":"bottom"}:{value:"left"===t?"bottom":"top"}}function y(e,t,n){return void 0!==e.labelAngle?(e.labelAngle%360+360)%360:t===i.X&&g.contains([r.NOMINAL,r.ORDINAL],n.type)?270:void 0}function b(e,t){return e=(e%360+360)%360,"top"===t||"bottom"===t?e%180==0?"center":0<e&&e<180?"top"===t?"right":"left":"top"===t?"left":"right":(e+90)%180==0?"center":90<=e&&e<270?"left"===t?"left":"right":"left"===t?"right":"left"}n.labels=function(e,t,n,i){var r=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),o=e.axis(t),a=e.config,s={};if(d.isTimeFieldDef(r)){var l=e.getScaleComponent(t).get("type")===p.ScaleType.UTC;s.text={signal:m.timeFormatExpression("datum.value",r.timeUnit,o.format,a.axis.shortTimeLabels,a.timeFormat,l)}}var c=h.getAxisConfig("labelAngle",e.config,t,i,e.getScaleComponent(t).get("type"));if(void 0===c&&(c=y(o,t,r))&&(s.angle={value:c}),void 0!==c){var u=b(c,i);u&&(s.align={value:u}),s.baseline=v(c,i)}return s=f({},s,n),0===g.keys(s).length?void 0:s},n.labelBaseline=v,n.labelAngle=y,n.labelAlign=b},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../type":124,"../../util":125,"../common":24,"./config":18}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../axis"),S=e("../../channel"),f=e("../../fielddef"),E=e("../../util"),d=e("../common"),x=e("../resolve"),o=e("../split"),l=e("./component"),c=e("./config"),p=e("./encode"),g=e("./properties");n.parseUnitAxis=function(n){return S.POSITION_SCALE_CHANNELS.reduce(function(e,t){return n.component.scales[t]&&n.axis(t)&&(e[t]=[function(r,o){var a=o.axis(r),s=new l.AxisComponent;u.VG_AXIS_PROPERTIES.forEach(function(e){var t=function(e,t,n,i){var r=i.fieldDef(n);switch(e){case"scale":return i.scaleName(n);case"gridScale":return g.gridScale(i,n);case"format":return d.numberFormat(r,t.format,i.config);case"grid":var o=i.getScaleComponent(n).get("type");return d.getSpecifiedOrDefaultValue(t.grid,g.grid(o,r));case"labelFlush":return g.labelFlush(r,n,t);case"labelOverlap":var o=i.getScaleComponent(n).get("type");return g.labelOverlap(r,t,n,o);case"orient":return d.getSpecifiedOrDefaultValue(t.orient,g.orient(n));case"tickCount":var o=i.getScaleComponent(n).get("type"),a="x"===n?"width":"y"===n?"height":void 0,s=a?i.getSizeSignalRef(a):void 0;return d.getSpecifiedOrDefaultValue(t.tickCount,g.tickCount(n,r,o,s));case"title":var l="x"===n?"x2":"y2",c=i.fieldDef(l);return d.getSpecifiedOrDefaultValue(void 0===t.title?void 0:t.title,d.mergeTitleFieldDefs([f.toFieldDefBase(r)],c?[f.toFieldDefBase(c)]:[]));case"values":return g.values(t,i,r)}return u.isAxisProperty(e)?t[e]:void 0}(e,a,r,o);if(void 0!==t){var n="values"===e?!!a.values:"encode"===e?!!a.encoding||!!a.labelAngle:t===a[e],i=c.getAxisConfig(e,o.config,r,s.get("orient"),o.getScaleComponent(r).get("type"));(n||void 0===i)&&s.set(e,t,n)}});var i=a.encoding||{},e=u.AXIS_PARTS.reduce(function(e,t){if(!s.hasAxisPart(t))return e;var n="labels"===t?p.labels(o,r,i.labels||{},s.get("orient")):i[t]||{};return void 0!==n&&0<E.keys(n).length&&(e[t]={update:n}),e},{});return 0<E.keys(e).length&&s.set("encode",e,!!a.encoding||!!a.labelAngle),s}(t,n)]),e},{})};var w={bottom:"top",top:"bottom",left:"right",right:"left"};function N(e,t){if(!e)return t.map(function(e){return e.clone()});if(e.length===t.length){for(var n=e.length,i=0;i<n;i++){var r=e[i],o=t[i];if(!!r!=!!o)return;if(r&&o){var a=r.getWithExplicit("orient"),s=o.getWithExplicit("orient");if(a.explicit&&s.explicit&&a.value!==s.value)return;e[i]=m(r,o)}}return e}}function m(t,i){for(var e=function(n){var e=o.mergeValuesWithExplicit(t.getWithExplicit(n),i.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return d.titleMerger(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return o.defaultTieBreaker(e,t,n,"axis")});t.setWithExplicit(n,e)},n=0,r=u.VG_AXIS_PROPERTIES;n<r.length;n++){e(r[n])}return t}n.parseLayerAxis=function(e){for(var t=e.component,n=t.axes,i=t.resolve,r={top:0,bottom:0,right:0,left:0},o=0,a=e.children;o<a.length;o++){(g=a[o]).parseAxisAndHeader();for(var s=0,l=E.keys(g.component.axes);s<l.length;s++){var c=l[s];i.axis[c]=x.parseGuideResolve(e.component.resolve,c),"shared"===i.axis[c]&&(n[c]=N(n[c],g.component.axes[c]),n[c]||(i.axis[c]="independent",delete n[c]))}}for(var u=0,f=[S.X,S.Y];u<f.length;u++){c=f[u];for(var d=0,p=e.children;d<p.length;d++){var g;if((g=p[d]).component.axes[c]){if("independent"===i.axis[c]){n[c]=(n[c]||[]).concat(g.component.axes[c]);for(var m=0,h=g.component.axes[c];m<h.length;m++){var v=h[m],y=v.getWithExplicit("orient"),b=y.value,O=y.explicit;if(0<r[b]&&!O){var _=w[b];r[b]>r[_]&&v.set("orient",_,!1)}r[b]++}}delete g.component.axes[c]}}}}},{"../../axis":13,"../../channel":15,"../../fielddef":106,"../../util":125,"../common":24,"../resolve":75,"../split":95,"./component":17,"./config":18,"./encode":19,"./properties":21}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-util"),o=e("../../bin"),i=e("../../channel"),a=e("../../datetime"),s=e("../../fielddef"),l=e("../../log"),c=e("../../scale"),u=e("../../type"),f=e("../../util");n.grid=function(e,t){return!c.hasDiscreteDomain(e)&&!t.bin},n.gridScale=function(e,t){var n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)},n.labelFlush=function(e,t,n){return void 0!==n.labelFlush?n.labelFlush:!("x"!==t||!f.contains(["quantitative","temporal"],e.type))||void 0},n.labelOverlap=function(e,t,n,i){return void 0!==t.labelOverlap?t.labelOverlap:"nominal"!==e.type?"log"!==i||"greedy":void 0},n.orient=function(e){switch(e){case i.X:return"bottom";case i.Y:return"left"}throw new Error(l.message.INVALID_CHANNEL_FOR_AXIS)},n.tickCount=function(e,t,n,i){if(!c.hasDiscreteDomain(n)&&"log"!==n&&!f.contains(["month","hours","day","quarter"],t.timeUnit))return t.bin?{signal:"ceil("+i.signal+"/20)"}:{signal:"ceil("+i.signal+"/40)"}},n.title=function(e,t,n){var i=s.title(t,n);return e?r.truncate(i,e):i},n.values=function(e,t,n){var i=e.values;if(e.values&&a.isDateTime(i[0]))return i.map(function(e){return{signal:a.dateTimeExpr(e,!0)}});if(!i&&n.bin&&n.type===u.QUANTITATIVE){var r=t.getName(o.binToString(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+r+".start, "+r+".stop + "+r+".step, "+r+".step)"}}return i}},{"../../bin":14,"../../channel":15,"../../datetime":103,"../../fielddef":106,"../../log":110,"../../scale":115,"../../type":124,"../../util":125,"vega-util":10}],22:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../util"),l=e("./data/parse"),c=e("./layoutsize/assemble"),o=function(o){function e(e,t,n,i,r){return o.call(this,e,t,n,i,r)||this}return r(e,o),e.prototype.parseData=function(){this.component.data=l.parseData(this),this.children.forEach(function(e){e.parseData()})},e.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),s.keys(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,i=this.children;t<i.length;t++){e(i[t])}},e.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},e.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},e.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},e.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},e.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},c.assembleLayoutSignals(this))},e.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},e.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleLayoutSize();return a({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},i?{encode:{update:i}}:{},e.assembleGroup())})},e}(e("./model").Model);n.BaseConcatModel=o},{"../util":125,"./data/parse":42,"./layoutsize/assemble":49,"./model":69}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("../log"),l=e("../spec"),c=e("./concat"),u=e("./facet"),f=e("./layer"),d=e("./repeat"),p=e("./unit");n.buildModel=function(e,t,n,i,r,o,a){if(l.isFacetSpec(e))return new u.FacetModel(e,t,n,r,o);if(l.isLayerSpec(e))return new f.LayerModel(e,t,n,i,r,o,a);if(l.isUnitSpec(e))return new p.UnitModel(e,t,n,i,r,o,a);if(l.isRepeatSpec(e))return new d.RepeatModel(e,t,n,r,o);if(l.isConcatSpec(e))return new c.ConcatModel(e,t,n,r,o);throw new Error(s.message.INVALID_SPEC)}},{"../log":110,"../spec":118,"./concat":26,"./facet":46,"./layer":47,"./repeat":73,"./unit":96}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),r=e("../channel"),a=e("../fielddef"),s=e("../scale"),l=e("../timeunit"),o=e("../type"),c=e("../util");function u(e){return[].concat(e.type,e.style||[])}function f(e,t,n){var i=n.mark[e],r=n[t.type];void 0!==r[e]&&(i=r[e]);for(var o=0,a=u(t);o<a.length;o++){var s=a[o],l=n.style[s],c=e;l&&void 0!==l[c]&&(i=l[c])}return i}function d(e,t,n){if(e.type===o.QUANTITATIVE)return t||n.numberFormat}function p(e,t){return"format("+e+', "'+(t||"")+'")'}function g(e,t,n){return p(e,t||n.numberFormat)}function m(e,t,n,i){return e+" === null || isNaN("+e+') ? "null" : '+g(e,n,i)+' + " - " + '+g(t,n,i)}function h(e,t,n,i,r,o){if(!t||n){var a=n||r;return o?"utcFormat("+e+", '"+a+"')":"timeFormat("+e+", '"+a+"')"}return l.formatExpression(t,e,i,o)}function v(e,t){var r=e.slice();return t.forEach(function(e){for(var t=0,n=r;t<n.length;t++){var i=n[t];if(c.stringify(i)===c.stringify(e))return}r.push(e)}),r}n.applyConfig=function(e,t,n){for(var i=0,r=n;i<r.length;i++){var o=r[i],a=t[o];void 0!==a&&(e[o]={value:a})}return e},n.applyMarkConfig=function(e,t,n){for(var i=0,r=n;i<r.length;i++){var o=r[i],a=f(o,t.markDef,t.config);void 0!==a&&(e[o]={value:a})}return e},n.getStyles=u,n.getMarkConfig=f,n.formatSignalRef=function(e,t,n,i){var r=d(e,t,i);if(e.bin)return{signal:m(a.vgField(e,{expr:n}),a.vgField(e,{expr:n,binSuffix:"end"}),r,i)};if("quantitative"===e.type)return{signal:""+p(a.vgField(e,{expr:n}),r)};if(a.isTimeFieldDef(e)){var o=a.isScaleFieldDef(e)&&e.scale&&e.scale.type===s.ScaleType.UTC;return{signal:h(a.vgField(e,{expr:n}),e.timeUnit,t,i.text.shortTimeLabels,i.timeFormat,o)}}return{signal:"''+"+a.vgField(e,{expr:n})}},n.getSpecifiedOrDefaultValue=function(e,t){return void 0!==e?e:t},n.numberFormat=d,n.numberFormatExpr=g,n.binFormatExpression=m,n.timeFormatExpression=h,n.sortParams=function(e,n){return(i.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(a.vgField(t,n)),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})},n.mergeTitleFieldDefs=v,n.titleMerger=function(e,t){if(i.isArray(e.value)&&i.isArray(t.value))return{explicit:e.explicit,value:v(e.value,t.value)};if(!i.isArray(e.value)&&!i.isArray(t.value))return{explicit:e.explicit,value:e.value===t.value?e.value:e.value+", "+t.value};throw new Error("It should never reach here")},n.binRequiresRange=function(e,t){return e.bin?r.isScaleChannel(t)&&c.contains(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}},{"../channel":15,"../fielddef":106,"../scale":115,"../timeunit":120,"../type":124,"../util":125,"vega-util":10}],25:[function(e,t,n){"use strict";var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("../config"),f=e("../fielddef"),d=e("../log"),p=e("../spec"),g=e("../toplevelprops"),m=e("../util"),h=e("./buildmodel"),v=e("./data/assemble"),y=e("./data/optimize");n.compile=function(e,t){void 0===t&&(t={}),t.logger&&d.set(t.logger),t.fieldTitle&&f.setTitleFormatter(t.fieldTitle);try{var n=u.initConfig(m.mergeDeep({},t.config,e.config)),i=p.normalize(e,n),r=g.normalizeAutoSize(e.autosize,n.autosize,p.isLayerSpec(i)||p.isUnitSpec(i)),o=h.buildModel(i,null,"",void 0,void 0,n,"fit"===r.type);return o.parse(),y.optimizeDataflow(o.component.data),function(e,t){var n=e.config?u.stripAndRedirectConfig(e.config):void 0,i=[].concat(e.assembleSelectionData([]),v.assembleRootData(e.component.data,t.datasets||{}));delete t.datasets;var r=e.assembleProjections(),o=e.assembleTitle(),a=e.assembleGroupStyle(),s=e.assembleLayoutSignals();return s=s.filter(function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)}),{spec:c({$schema:"https://vega.github.io/schema/vega/v3.0.json"},e.description?{description:e.description}:{},t,o?{title:o}:{},a?{style:a}:{},{data:i},0<r.length?{projections:r}:{},e.assembleGroup(s.concat(e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{})}}(o,(a=e,s=n,l=r,c({autosize:1===m.keys(l).length&&l.type?l.type:l},g.extractTopLevelProperties(s),g.extractTopLevelProperties(a))))}finally{t.logger&&d.reset(),t.fieldTitle&&f.resetTitleFormatter()}var a,s,l}},{"../config":101,"../fielddef":106,"../log":110,"../spec":118,"../toplevelprops":122,"../util":125,"./buildmodel":23,"./data/assemble":28,"./data/optimize":40}],26:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../log"),l=e("../spec"),a=e("./baseconcat"),c=e("./buildmodel"),u=e("./layoutsize/parse"),f=function(a){function e(e,t,n,i,r){var o=a.call(this,e,t,n,r,e.resolve)||this;return o.type="concat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&s.warn(s.message.CONCAT_CANNOT_SHARE_AXIS),o.isVConcat=l.isVConcatSpec(e),o.children=(l.isVConcatSpec(e)?e.vconcat:e.hconcat).map(function(e,t){return c.buildModel(e,o,o.getName("concat_"+t),void 0,i,r,!1)}),o}return r(e,a),e.prototype.parseLayoutSize=function(){u.parseConcatLayoutSize(this)},e.prototype.parseAxisGroup=function(){return null},e.prototype.assembleLayout=function(){return o({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},e}(a.BaseConcatModel);n.ConcatModel=f},{"../log":110,"../spec":118,"./baseconcat":22,"./buildmodel":23,"./layoutsize/parse":50}],27:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),u=e("../../fielddef"),s=e("../../log"),f=e("../../util"),d=e("../common");var r=function(r){function c(e,t,n){var i=r.call(this,e)||this;return i.dimensions=t,i.measures=n,i}return o(c,r),c.prototype.clone=function(){return new c(null,a({},this.dimensions),f.duplicate(this.measures))},c.makeFromEncoding=function(e,o){var t=!1;o.forEachFieldDef(function(e){e.aggregate&&(t=!0)});var a={},s={};return t?(o.forEachFieldDef(function(e,t){var n,i,r;e.aggregate?"count"===e.aggregate?(a["*"]=a["*"]||{},a["*"].count=u.vgField(e,{aggregate:"count"})):(a[e.field]=a[e.field]||{},a[e.field][e.aggregate]=u.vgField(e),l.isScaleChannel(t)&&"unaggregated"===o.scaleDomain(t)&&(a[e.field].min=u.vgField(e,{aggregate:"min"}),a[e.field].max=u.vgField(e,{aggregate:"max"}))):(n=s,i=t,(r=e).bin?(n[u.vgField(r,{})]=!0,n[u.vgField(r,{binSuffix:"end"})]=!0,d.binRequiresRange(r,i)&&(n[u.vgField(r,{binSuffix:"range"})]=!0)):n[u.vgField(r)]=!0)}),f.keys(s).length+f.keys(a).length===0?null:new c(e,s,a)):null},c.makeFromTransform=function(e,t){for(var n={},i={},r=0,o=t.aggregate;r<o.length;r++){(l=o[r]).op&&("count"===l.op?(i["*"]=i["*"]||{},i["*"].count=l.as||u.vgField(l)):(i[l.field]=i[l.field]||{},i[l.field][l.op]=l.as||u.vgField(l)))}for(var a=0,s=t.groupby||[];a<s.length;a++){var l;n[l=s[a]]=!0}return f.keys(n).length+f.keys(i).length===0?null:new c(e,n,i)},c.prototype.merge=function(e){f.differ(this.dimensions,e.dimensions)?s.debug("different dimensions, cannot merge"):(!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];for(var r in i)i.hasOwnProperty(r)&&(n in e?e[n][r]=i[r]:e[n]={op:i[r]})}}(this.measures,e.measures),e.remove())},c.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},c.prototype.dependentFields=function(){var t={};return f.keys(this.dimensions).forEach(function(e){return t[e]=!0}),f.keys(this.measures).forEach(function(e){return t[e]=!0}),t},c.prototype.producedFields=function(){var e=this,n={};return f.keys(this.measures).forEach(function(t){f.keys(e.measures[t]).forEach(function(e){n[e+"_"+t]=!0})}),n},c.prototype.assemble=function(){for(var e=[],t=[],n=[],i=0,r=f.keys(this.measures);i<r.length;i++)for(var o=r[i],a=0,s=f.keys(this.measures[o]);a<s.length;a++){var l=s[a];n.push(this.measures[o][l]),e.push(l),t.push(o)}return{type:"aggregate",groupby:f.keys(this.dimensions),ops:e,fields:t,as:n}},c}(e("./dataflow").DataFlowNode);n.AggregateNode=r},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../util":125,"../common":24,"./dataflow":31}],28:[function(e,t,n){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../data"),g=e("../../util"),l=e("./aggregate"),c=e("./bin"),u=e("./calculate"),f=e("./dataflow"),d=e("./facet"),p=e("./filter"),m=e("./filterinvalid"),h=e("./formatparse"),v=e("./geojson"),y=e("./geopoint"),b=e("./indentifier"),O=e("./lookup"),_=e("./source"),S=e("./stack"),E=e("./timeunit");function x(r){var o=0;return function t(e,n){e instanceof _.SourceNode&&(s.isUrlData(e.data)||(r.push(n),n={name:null,source:n.name,transform:[]}));if(e instanceof h.ParseNode&&(e.parent instanceof _.SourceNode&&!n.source?n.format=a({},n.format||{},{parse:e.assembleFormatParse()}):n.transform=n.transform.concat(e.assembleTransforms())),e instanceof d.FacetNode)return n.name||(n.name="data_"+o++),!n.source||0<n.transform.length?(r.push(n),e.data=n.name):e.data=n.source,void e.assemble().forEach(function(e){return r.push(e)});(e instanceof p.FilterNode||e instanceof u.CalculateNode||e instanceof y.GeoPointNode||e instanceof v.GeoJSONNode||e instanceof l.AggregateNode||e instanceof O.LookupNode||e instanceof b.IdentifierNode)&&n.transform.push(e.assemble()),(e instanceof m.FilterInvalidNode||e instanceof c.BinNode||e instanceof E.TimeUnitNode||e instanceof S.StackNode)&&(n.transform=n.transform.concat(e.assemble())),e instanceof l.AggregateNode&&(n.name||(n.name="data_"+o++)),e instanceof f.OutputNode&&(n.source&&0===n.transform.length?e.setSource(n.source):e.parent instanceof f.OutputNode?e.setSource(n.name):(n.name||(n.name="data_"+o++),e.setSource(n.name),1===e.numChildren()&&(r.push(n),n={name:null,source:n.name,transform:[]})));switch(e.numChildren()){case 0:e instanceof f.OutputNode&&(!n.source||0<n.transform.length)&&r.push(n);break;case 1:t(e.children[0],n);break;default:n.name||(n.name="data_"+o++);var i=n.name;!n.source||0<n.transform.length?r.push(n):i=n.source,e.children.forEach(function(e){t(e,{name:null,source:i,transform:[]})})}}}n.assembleFacetData=function(t){var e=[],n=x(e);return t.children.forEach(function(e){return n(e,{source:t.name,name:null,transform:[]})}),e},n.assembleRootData=function(e,t){var n=g.vals(e.sources),i=[],r=x(i),o=0;n.forEach(function(e){e.hasName()||(e.dataName="source_"+o++);var t=e.assemble();r(e,t)}),i.forEach(function(e){0===e.transform.length&&delete e.transform}),i.sort(function(e,t){return 0===(e.transform||[]).length?-1:0===(t.transform||[]).length?1:0});for(var a=0,s=i;a<s.length;a++)for(var l=0,c=(p=s[a]).transform||[];l<c.length;l++){var u=c[l];"lookup"===u.type&&(u.from=e.outputNodes[u.from].getSource())}for(var f=0,d=i;f<d.length;f++){var p;(p=d[f]).name in t&&(p.values=t[p.name])}return i}},{"../../data":102,"../../util":125,"./aggregate":27,"./bin":29,"./calculate":30,"./dataflow":31,"./facet":32,"./filter":33,"./filterinvalid":34,"./formatparse":35,"./geojson":36,"./geopoint":37,"./indentifier":38,"./lookup":39,"./source":43,"./stack":44,"./timeunit":45}],29:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../bin"),g=e("../../fielddef"),o=e("../../util"),l=e("../common"),c=e("../model");function u(e,t){var n;n="as"in e?[e.as,e.as+"_end"]:[g.vgField(e,{}),g.vgField(e,{binSuffix:"end"})];var i,r,o,a,s=g.normalizeBin(e.bin,void 0)||{},l=(i=s,r=e.field,p.binToString(i)+"_"+r),c=(a=l,{signal:(o=t).getName(a+"_bins"),extentSignal:o.getName(a+"_extent")}),u=c.signal,f=c.extentSignal;return{key:l,binComponent:d({bin:s,field:e.field,as:n},u?{signal:u}:{},f?{extentSignal:f}:{})}}var a=function(i){function s(e,t){var n=i.call(this,e)||this;return n.bins=t,n}return r(s,i),s.prototype.clone=function(){return new s(null,o.duplicate(this.bins))},s.makeFromEncoding=function(e,a){var t=a.reduceFieldDef(function(e,t,n){if(t.bin){var i=u(t,a),r=i.key,o=i.binComponent;e[r]=d({},o,e[r],function(e,t,n,i){if(l.binRequiresRange(t,n)){var r=c.isUnitModel(e)&&(e.axis(n)||e.legend(n))||{},o=g.vgField(t,{expr:"datum"}),a=g.vgField(t,{expr:"datum",binSuffix:"end"});return{formulaAs:g.vgField(t,{binSuffix:"range"}),formula:l.binFormatExpression(o,a,r.format,i)}}return{}}(a,t,n,a.config))}return e},{});return 0===o.keys(t).length?null:new s(e,t)},s.makeFromTransform=function(e,t,n){var i,r=u(t,n),o=r.key,a=r.binComponent;return new s(e,((i={})[o]=a,i))},s.prototype.merge=function(e){this.bins=d({},this.bins,e.bins),e.remove()},s.prototype.producedFields=function(){var t={};return o.vals(this.bins).forEach(function(e){e.as.forEach(function(e){return t[e]=!0})}),t},s.prototype.dependentFields=function(){var t={};return o.vals(this.bins).forEach(function(e){t[e.field]=!0}),t},s.prototype.assemble=function(){return o.flatten(o.vals(this.bins).map(function(e){var t=[],n=d({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},s}(e("./dataflow").DataFlowNode);n.BinNode=a},{"../../bin":14,"../../fielddef":106,"../../util":125,"../common":24,"../model":69,"./dataflow":31}],30:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../util"),a=function(i){function e(e,t){var n=i.call(this,e)||this;return n.transform=t,n}return r(e,i),e.prototype.clone=function(){return new e(null,o.duplicate(this.transform))},e.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},e.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},e}(e("./dataflow").DataFlowNode);n.CalculateNode=a},{"../../util":125,"./dataflow":31}],31:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){(this._parent=e).addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++){t[e].parent=this._parent}this._parent.removeChild(this)},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,i=this._children;n<i.length;n++){i[n].parent=e}this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}(),a=function(o){function e(e,t,n,i){var r=o.call(this,e,t)||this;return r.type=n,r.refCounts=i,r._source=r._name=t,!r.refCounts||r._name in r.refCounts||(r.refCounts[r._name]=0),r}return r(e,o),e.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},e.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},e.prototype.isRequired=function(){return!!this.refCounts[this._name]},e.prototype.setSource=function(e){this._source=e},e}(n.DataFlowNode=o);n.OutputNode=a},{}],32:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),c=e("../../log"),u=e("../../scale"),f=e("../../vega.schema"),d=e("../scale/domain"),o=function(o){function e(e,t,n,i){var r=o.call(this,e)||this;return r.model=t,r.name=n,r.data=i,t.facet.column&&(r.columnFields=[t.vgField(s.COLUMN)],r.columnName=t.getName("column_domain"),t.fieldDef(s.COLUMN).bin&&r.columnFields.push(t.vgField(s.COLUMN,{binSuffix:"end"}))),t.facet.row&&(r.rowFields=[t.vgField(s.ROW)],r.rowName=t.getName("row_domain"),t.fieldDef(s.ROW).bin&&r.rowFields.push(t.vgField(s.ROW,{binSuffix:"end"}))),r.childModel=t.child,r}return r(e,o),Object.defineProperty(e.prototype,"fields",{get:function(){var e=[];return this.columnFields&&(e=e.concat(this.columnFields)),this.rowFields&&(e=e.concat(this.rowFields)),e},enumerable:!0,configurable:!0}),e.prototype.getSource=function(){return this.name},e.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var i=n[t],r=this.childModel.component.scales[i];if(r&&!r.merged){var o=r.get("type"),a=r.get("range");if(u.hasDiscreteDomain(o)&&f.isVgRangeStep(a)){var s=d.assembleDomain(this.childModel,i),l=d.getFieldFromDomain(s);l?e[i]=l:c.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},e.prototype.assembleRowColumnData=function(e,t,n){var i={},r="row"===e?"y":"x";return n[r]&&(i=t?{fields:["distinct_"+n[r]],ops:["max"],as:["distinct_"+n[r]]}:{fields:[n[r]],ops:["distinct"]}),{name:"row"===e?this.rowName:this.columnName,source:t||this.data,transform:[a({type:"aggregate",groupby:"row"===e?this.rowFields:this.columnFields},i)]}},e.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(n.x||n.y)){t="cross_"+this.columnName+"_"+this.rowName;var i=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),r=i.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:i,ops:r}]})}return this.columnName&&e.push(this.assembleRowColumnData("column",t,n)),this.rowName&&e.push(this.assembleRowColumnData("row",t,n)),e},e}(e("./dataflow").DataFlowNode);n.FacetNode=o},{"../../channel":15,"../../log":110,"../../scale":115,"../../vega.schema":127,"../scale/domain":78,"./dataflow":31}],33:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../predicate"),s=e("../../util"),r=function(r){function e(e,t,n){var i=r.call(this,e)||this;return i.model=t,i.filter=n,i.expr=a.expression(i.model,i.filter,i),i}return o(e,r),e.prototype.clone=function(){return new e(null,this.model,s.duplicate(this.filter))},e.prototype.assemble=function(){return{type:"filter",expr:this.expr}},e}(e("./dataflow").DataFlowNode);n.FilterNode=r},{"../../predicate":113,"../../util":125,"./dataflow":31}],34:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),s=e("../../fielddef"),l=e("../../scale"),c=e("../../util"),u=function(i){function n(e,t){var n=i.call(this,e)||this;return n.fieldDefs=t,n}return r(n,i),n.prototype.clone=function(){return new n(null,o({},this.fieldDefs))},n.make=function(e,o){if("filter"!==o.config.invalidValues)return null;var t=o.reduceFieldDef(function(e,t,n){var i=a.isScaleChannel(n)&&o.getScaleComponent(n);if(i){var r=i.get("type");l.hasContinuousDomain(r)&&!t.aggregate&&(e[t.field]=t)}return e},{});return c.keys(t).length?new n(e,t):null},Object.defineProperty(n.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:!0,configurable:!0}),n.prototype.assemble=function(){var r=this,e=c.keys(this.filter).reduce(function(e,t){var n=r.fieldDefs[t],i=s.vgField(n,{expr:"datum"});return null!==n&&(e.push(i+" !== null"),e.push("!isNaN("+i+")")),e},[]);return 0<e.length?{type:"filter",expr:e.join(" && ")}:null},n}(e("./dataflow").DataFlowNode);n.FilterInvalidNode=u},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../util":125,"./dataflow":31}],35:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),l=e("../../aggregate"),c=e("../../fielddef"),u=e("../../log"),f=e("../../logical"),d=e("../../predicate"),p=e("../../transform"),g=e("../../util"),m=e("../model");var s=function(i){function s(e,t){var n=i.call(this,e)||this;return n._parse={},n._parse=t,n}return r(s,i),s.prototype.clone=function(){return new s(null,g.duplicate(this.parse))},s.make=function(e,t){var n={},i={};(t.transforms||[]).forEach(function(e){p.isCalculate(e)?i[e.as]=!0:p.isFilter(e)&&f.forEachLeave(e.filter,function(e){d.isFieldPredicate(e)&&e.timeUnit&&(n[e.field]="date")})},{}),(m.isUnitModel(t)||m.isFacetModel(t))&&t.forEachFieldDef(function(e){if(c.isTimeFieldDef(e))n[e.field]="date";else if(c.isNumberFieldDef(e)){if(i[e.field]||l.isCountingAggregateOp(e.aggregate))return;n[e.field]="number"}});var r=t.data;if(r&&r.format&&r.format.parse){var o=r.format.parse;g.keys(o).forEach(function(e){n[e]=o[e]})}var a=t.component.data.ancestorParse;return g.keys(a).forEach(function(e){n[e]!==a[e]?u.warn(u.message.differentParse(e,n[e],a[e])):delete n[e]}),0===g.keys(n).length?null:new s(e,n)},Object.defineProperty(s.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),s.prototype.merge=function(e){this._parse=o({},this._parse,e.parse),e.remove()},s.prototype.assembleFormatParse=function(){return this._parse},s.prototype.producedFields=function(){return a.toSet(g.keys(this.parse))},s.prototype.dependentFields=function(){return a.toSet(g.keys(this.parse))},s.prototype.assembleTransforms=function(){var o=this;return g.keys(this._parse).map(function(e){var t,n,i,r=(t=e,n=o._parse[e],i="datum"+g.accessPath(t),"number"===n?"toNumber("+i+")":"boolean"===n?"toBoolean("+i+")":"string"===n?"toString("+i+")":"date"===n?"toDate("+i+")":0===n.indexOf("date:")?"timeParse("+i+","+n.slice(5,n.length)+")":0===n.indexOf("utc:")?"utcParse("+i+","+n.slice(4,n.length)+")":(u.warn(u.message.unrecognizedParse(n)),null));return r?{type:"formula",expr:r,as:e}:null}).filter(function(e){return null!==e})},s}(e("./dataflow").DataFlowNode);n.ParseNode=s},{"../../aggregate":12,"../../fielddef":106,"../../log":110,"../../logical":111,"../../predicate":113,"../../transform":123,"../../util":125,"../model":69,"./dataflow":31,"vega-util":10}],36:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),c=e("../../type"),u=e("../../util"),o=function(o){function a(e,t,n,i){var r=o.call(this,e)||this;return r.fields=t,r.geojson=n,r.signal=i,r}return r(a,o),a.prototype.clone=function(){return new a(null,u.duplicate(this.fields),this.geojson,this.signal)},a.parseAll=function(n,i){var r=0;if([[l.LONGITUDE,l.LATITUDE],[l.LONGITUDE2,l.LATITUDE2]].forEach(function(e){var t=e.map(function(e){return i.channelHasField(e)?i.fieldDef(e).field:void 0});(t[0]||t[1])&&(n=new a(n,t,null,i.getName("geojson_"+r++)))}),i.channelHasField(l.SHAPE)){var e=i.fieldDef(l.SHAPE);e.type===c.GEOJSON&&(n=new a(n,null,e.field,i.getName("geojson_"+r++)))}return n},a.prototype.assemble=function(){return s({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})},a}(e("./dataflow").DataFlowNode);n.GeoJSONNode=o},{"../../channel":15,"../../type":124,"../../util":125,"./dataflow":31}],37:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),l=e("../../util"),o=function(o){function a(e,t,n,i){var r=o.call(this,e)||this;return r.projection=t,r.fields=n,r.as=i,r}return r(a,o),a.prototype.clone=function(){return new a(null,this.projection,l.duplicate(this.fields),l.duplicate(this.as))},a.parseAll=function(i,r){return r.projectionName()&&[[s.LONGITUDE,s.LATITUDE],[s.LONGITUDE2,s.LATITUDE2]].forEach(function(e){var t=e.map(function(e){return r.channelHasField(e)?r.fieldDef(e).field:void 0}),n=e[0]===s.LONGITUDE2?"2":"";(t[0]||t[1])&&(i=new a(i,r.projectionName(),t,[r.getName("x"+n),r.getName("y"+n)]))}),i},a.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}},a}(e("./dataflow").DataFlowNode);n.GeoPointNode=o},{"../../channel":15,"../../util":125,"./dataflow":31}],38:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../selection"),a=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype.clone=function(){return new e(null)},e.prototype.producedFields=function(){return(e={})[o.SELECTION_ID]=!0,e;var e},e.prototype.assemble=function(){return{type:"identifier",as:o.SELECTION_ID}},e}(e("./dataflow").DataFlowNode);n.IdentifierNode=a},{"../../selection":116,"./dataflow":31}],39:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("vega-util"),l=e("../../log"),u=e("./dataflow"),f=e("./source"),r=function(r){function c(e,t,n){var i=r.call(this,e)||this;return i.transform=t,i.secondary=n,i}return o(c,r),c.make=function(e,t,n,i){var r=t.component.data.sources,o=new f.SourceNode(n.from.data),a=r[o.hash()];a||(a=r[o.hash()]=o);var s=t.getName("lookup_"+i),l=new u.OutputNode(a,s,"lookup",t.component.data.outputNodeRefCounts);return new c(e,n,(t.component.data.outputNodes[s]=l).getSource())},c.prototype.producedFields=function(){return s.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},c.prototype.assemble=function(){var e;if(this.transform.from.fields)e=a({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;s.isString(t)||(l.warn(l.message.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return a({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},c}(u.DataFlowNode);n.LookupNode=r},{"../../log":110,"./dataflow":31,"./source":43,"vega-util":10}],40:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../data"),a=e("../../util"),s=e("./aggregate"),l=e("./dataflow"),c=e("./facet"),n=e("./filterinvalid"),r=e("./optimizers"),u=e("./stack");function f(t){if(t instanceof c.FacetNode)if(1!==t.numChildren()||t.children[0]instanceof l.OutputNode){!function e(t){if(t instanceof l.OutputNode&&t.type===i.MAIN&&1===t.numChildren()){var n=t.children[0];n instanceof c.FacetNode||(n.swapWithParent(),e(t))}}(t.model.component.data.main),a.flatten(t.children.map((r=t,function e(t){if(!(t instanceof c.FacetNode)){var n=t.clone();if(n instanceof l.OutputNode){var i=o.FACET_SCALE_PREFIX+n.getSource();n.setSource(i),r.model.component.data.outputNodes[i]=n}else(n instanceof s.AggregateNode||n instanceof u.StackNode)&&n.addDimensions(r.fields);return a.flatten(t.children.map(e)).forEach(function(e){return e.parent=n}),[n]}return a.flatten(t.children.map(e))}))).forEach(function(e){return e.parent=t.model.component.data.main})}else{var e=t.children[0];(e instanceof s.AggregateNode||e instanceof u.StackNode)&&e.addDimensions(t.fields),e.swapWithParent(),f(t)}else t.children.forEach(f);var r}function d(e){e instanceof n.FilterInvalidNode&&a.every(a.vals(e.filter),function(e){return null===e})&&e.remove(),e instanceof l.OutputNode&&!e.isRequired()&&e.remove(),e.children.forEach(d)}function p(e){var n=[];return e.forEach(function e(t){0===t.numChildren()?n.push(t):t.children.forEach(e)}),n}o.FACET_SCALE_PREFIX="scale_",o.optimizeDataflow=function(t){var e=a.vals(t.sources);e.forEach(d),p(e=e.filter(function(e){return 0<e.numChildren()})).forEach(r.iterateFromLeaves(r.removeUnusedSubtrees)),p(e=e.filter(function(e){return 0<e.numChildren()})).forEach(r.iterateFromLeaves(r.moveParseUp)),p(e).forEach(r.removeDuplicateTimeUnits),e.forEach(f),a.keys(t.sources).forEach(function(e){0===t.sources[e].numChildren()&&delete t.sources[e]})}},{"../../data":102,"../../util":125,"./aggregate":27,"./dataflow":31,"./facet":32,"./filterinvalid":34,"./optimizers":41,"./stack":44}],41:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),o=e("./dataflow"),a=e("./facet"),s=e("./formatparse"),l=e("./source"),c=e("./timeunit");function u(i){return function e(t){if(!(t instanceof l.SourceNode)){var n=t.parent;i(t)&&e(n)}}}n.iterateFromLeaves=u,n.moveParseUp=function(e){var t=e.parent;if(e instanceof s.ParseNode){if(t instanceof l.SourceNode)return!1;if(1<t.numChildren())return!0;if(t instanceof s.ParseNode)t.merge(e);else{if(r.hasIntersection(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0},n.removeUnusedSubtrees=function(e){return!(e instanceof o.OutputNode||0<e.numChildren()||e instanceof a.FacetNode||(e.remove(),0))},n.removeDuplicateTimeUnits=function(e){var n={};return u(function(e){if(e instanceof c.TimeUnitNode){var t=e.producedFields();r.keys(t).every(function(e){return!!n[e]})?e.remove():n=i({},n,t)}return!0})(e)}},{"../../util":125,"./dataflow":31,"./facet":32,"./formatparse":35,"./source":43,"./timeunit":45}],42:[function(e,t,n){"use strict";var g=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("vega-util"),m=e("../../data"),l=e("../../datetime"),c=e("../../log"),u=e("../../predicate"),f=e("../../transform"),d=e("../../util"),h=e("../model"),v=e("../selection/selection"),y=e("./aggregate"),b=e("./bin"),p=e("./calculate"),O=e("./dataflow"),_=e("./facet"),S=e("./filter"),E=e("./filterinvalid"),x=e("./formatparse"),w=e("./geojson"),N=e("./geopoint"),T=e("./indentifier"),P=e("./lookup"),D=e("./source"),k=e("./stack"),j=e("./timeunit");function A(r,o){var a=0;return o.transforms.forEach(function(e){if(f.isCalculate(e))r=new p.CalculateNode(r,e);else if(f.isFilter(e)){var t={},n=e.filter,i=null;u.isFieldEqualPredicate(n)?i=n.equal:u.isFieldRangePredicate(n)?i=n.range[0]:u.isFieldOneOfPredicate(n)&&(i=(n.oneOf||n.in)[0]),i&&(l.isDateTime(i)?t[n.field]="date":s.isNumber(i)?t[n.field]="number":s.isString(i)&&(t[n.field]="string")),0<d.keys(t).length&&(r=new x.ParseNode(r,t)),r=new S.FilterNode(r,o,e.filter)}else if(f.isBin(e))r=b.BinNode.makeFromTransform(r,e,o);else if(f.isTimeUnit(e))r=j.TimeUnitNode.makeFromTransform(r,e);else if(f.isAggregate(e))r=y.AggregateNode.makeFromTransform(r,e),v.requiresSelectionId(o)&&(r=new T.IdentifierNode(r));else{if(!f.isLookup(e))return void c.warn(c.message.invalidTransformIgnored(e));r=P.LookupNode.make(r,o,e,a++)}}),r}n.parseTransformArray=A,n.parseData=function(e){var t=function(e,t){if(e.data||!e.parent){var n=new D.SourceNode(e.data),i=n.hash();return i in t?t[i]:t[i]=n}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources),n=e.component.data.outputNodes,i=e.component.data.outputNodeRefCounts;v.requiresSelectionId(e)&&!e.parent&&(t=new T.IdentifierNode(t));var r=e.parent&&h.isLayerModel(e.parent);(h.isUnitModel(e)||h.isFacetModel(e))&&r&&(t=b.BinNode.makeFromEncoding(t,e)||t),0<e.transforms.length&&(t=A(t,e));var o=x.ParseNode.make(t,e);o&&(t=o),h.isUnitModel(e)&&(t=w.GeoJSONNode.parseAll(t,e),t=N.GeoPointNode.parseAll(t,e)),(h.isUnitModel(e)||h.isFacetModel(e))&&(r||(t=b.BinNode.makeFromEncoding(t,e)||t),t=j.TimeUnitNode.makeFromEncoding(t,e)||t);var a=e.getName(m.RAW),s=new O.OutputNode(t,a,m.RAW,i);if(t=n[a]=s,h.isUnitModel(e)){var l=y.AggregateNode.makeFromEncoding(t,e);l&&(t=l,v.requiresSelectionId(e)&&(t=new T.IdentifierNode(t))),t=k.StackNode.make(t,e)||t}h.isUnitModel(e)&&(t=E.FilterInvalidNode.make(t,e)||t);var c=e.getName(m.MAIN),u=new O.OutputNode(t,c,m.MAIN,i);t=n[c]=u;var f=null;if(h.isFacetModel(e)){var d=e.getName("facet");f=new _.FacetNode(t,e,d,u.getSource()),t=n[d]=f}var p=g({},e.component.data.ancestorParse,o?o.parse:{});return g({},e.component.data,{outputNodes:n,outputNodeRefCounts:i,raw:s,main:u,facetRoot:f,ancestorParse:p})}},{"../../data":102,"../../datetime":103,"../../log":110,"../../predicate":113,"../../transform":123,"../../util":125,"../model":69,"../selection/selection":85,"./aggregate":27,"./bin":29,"./calculate":30,"./dataflow":31,"./facet":32,"./filter":33,"./filterinvalid":34,"./formatparse":35,"./geojson":36,"./geopoint":37,"./indentifier":38,"./lookup":39,"./source":43,"./stack":44,"./timeunit":45,"vega-util":10}],43:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../data"),c=e("../../util"),o=function(o){function e(e){var t=o.call(this,null)||this;if(e=e||{name:"source"},l.isInlineData(e))t._data={values:e.values};else if(l.isUrlData(e)){if(t._data={url:e.url},e.format||(e.format={}),!e.format||!e.format.type){var n=/(?:\.([^.]+))?$/.exec(e.url)[1];c.contains(["json","csv","tsv","topojson"],n)||(n="json"),e.format.type=n}}else l.isNamedData(e)&&(t._name=e.name,t._data={});if(!l.isNamedData(e)&&e.format){var i=e.format,r=(i.parse,s(i,["parse"]));t._data.format=r}return t}return r(e,o),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.hasName=function(){return!!this._name},Object.defineProperty(e.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),e.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},e.prototype.hash=function(){return l.isInlineData(this._data)?(this._hash||(this._hash=c.hash(this._data)),this._hash):l.isUrlData(this._data)?c.hash([this._data.url,this._data.format]):this._name},e.prototype.assemble=function(){return a({name:this._name},this._data,{transform:[]})},e}(e("./dataflow").DataFlowNode);n.SourceNode=o},{"../../data":102,"../../util":125,"./dataflow":31}],44:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-util"),u=e("../../fielddef"),a=e("../../util"),l=e("../common");var s=function(i){function s(e,t){var n=i.call(this,e)||this;return n._stack=t,n}return r(s,i),s.prototype.clone=function(){return new s(null,a.duplicate(this._stack))},s.make=function(e,t){var n,i=t.stack;if(!i)return null;i.groupbyChannel&&(n=t.fieldDef(i.groupbyChannel));var r,o=t.stack.stackBy.reduce(function(e,t){var n=t.fieldDef,i=u.vgField(n);return i&&e.push(i),e},[]),a=t.encoding.order;return r=a?l.sortParams(a):o.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new s(e,{dimensionFieldDef:n,field:t.vgField(i.fieldChannel),facetby:[],stackby:o,sort:r,offset:i.offset,impute:i.impute})},Object.defineProperty(s.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),s.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},s.prototype.dependentFields=function(){var t={};t[this._stack.field]=!0,this.getGroupbyFields().forEach(function(e){return t[e]=!0}),this._stack.facetby.forEach(function(e){return t[e]=!0});var e=this._stack.sort.field;return o.isArray(e)?e.forEach(function(e){return t[e]=!0}):t[e]=!0,t},s.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},s.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute;return t?t.bin?n?[u.vgField(t,{binSuffix:"mid"})]:[u.vgField(t,{}),u.vgField(t,{binSuffix:"end"})]:[u.vgField(t)]:[]},s.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,i=t.field,r=t.dimensionFieldDef,o=t.impute,a=t.offset,s=t.sort,l=t.stackby;if(o&&r){var c=r?u.vgField(r,{binSuffix:"mid"}):void 0;r.bin&&e.push({type:"formula",expr:"("+u.vgField(r,{expr:"datum"})+"+"+u.vgField(r,{expr:"datum",binSuffix:"end"})+")/2",as:c}),e.push({type:"impute",field:i,groupby:l,key:c,method:"value",value:0})}return e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:i,sort:s,as:[i+"_start",i+"_end"],offset:a}),e},s}(e("./dataflow").DataFlowNode);n.StackNode=s},{"../../fielddef":106,"../../util":125,"../common":24,"./dataflow":31,"vega-util":10}],45:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../fielddef"),l=e("../../timeunit"),c=e("../../util"),r=function(i){function r(e,t){var n=i.call(this,e)||this;return n.formula=t,n}return o(r,i),r.prototype.clone=function(){return new r(null,c.duplicate(this.formula))},r.makeFromEncoding=function(e,t){var n=t.reduceFieldDef(function(e,t){if(t.timeUnit){var n=s.vgField(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===c.keys(n).length?null:new r(e,n)},r.makeFromTransform=function(e,t){return new r(e,((n={})[t.field]={as:t.as,timeUnit:t.timeUnit,field:t.field},n));var n},r.prototype.merge=function(e){this.formula=a({},this.formula,e.formula),e.remove()},r.prototype.producedFields=function(){var t={};return c.vals(this.formula).forEach(function(e){t[e.as]=!0}),t},r.prototype.dependentFields=function(){var t={};return c.vals(this.formula).forEach(function(e){t[e.field]=!0}),t},r.prototype.assemble=function(){return c.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:l.fieldExpr(e.timeUnit,e.field)}})},r}(e("./dataflow").DataFlowNode);n.TimeUnitNode=r},{"../../fielddef":106,"../../timeunit":120,"../../util":125,"./dataflow":31}],46:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var d=e("../channel"),o=e("../encoding"),p=e("../fielddef"),g=e("../log"),m=e("../scale"),a=e("../util"),h=e("../vega.schema"),v=e("./axis/assemble"),l=e("./buildmodel"),y=e("./data/assemble"),c=e("./data/parse"),b=e("./layout/header"),O=e("./layoutsize/parse"),s=e("./model"),_=e("./repeater"),S=e("./resolve"),E=e("./scale/domain"),u=function(s){function u(e,t,n,i,r){var o=s.call(this,e,t,n,r,e.resolve)||this;o.type="facet",o.child=l.buildModel(e.spec,o,o.getName("child"),void 0,i,r,!1),o.children=[o.child];var a=_.replaceRepeaterInFacet(e.facet,i);return o.facet=o.initFacet(a),o}return r(u,s),u.prototype.initFacet=function(e){return o.reduce(e,function(e,t,n){return a.contains([d.ROW,d.COLUMN],n)?void 0===t.field?g.warn(g.message.emptyFieldDef(t,n)):e[n]=p.normalize(t,n):g.warn(g.message.incompatibleChannel(n,"facet")),e},{})},u.prototype.channelHasField=function(e){return!!this.facet[e]},u.prototype.fieldDef=function(e){return this.facet[e]},u.prototype.parseData=function(){this.component.data=c.parseData(this),this.child.parseData()},u.prototype.parseLayoutSize=function(){O.parseChildrenLayoutSize(this)},u.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},u.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},u.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},u.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},i=void 0!==n.title?n.title:p.title(t,this.config);this.child.component.layoutHeaders[e].title&&(i+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:i,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},u.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},u.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]){var n=this.component,i=n.layoutHeaders,r=n.resolve;if(r.axis[e]=S.parseGuideResolve(r,e),"shared"===r.axis[e])for(var o="x"===e?"column":"row",a=i[o],s=0,l=t.component.axes[e];s<l.length;s++){var c=l[s],u=b.getHeaderType(c.get("orient"));a[u]=a[u]||[this.makeHeaderComponent(o,!1)];var f=v.assembleAxis(c,"main",this.config,{header:!0});a[u][0].axes.push(f),c.mainExtracted=!0}}},u.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},u.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},u.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},u.prototype.getLayoutBandMixins=function(e){for(var t={},n="header"===e?"headerBand":"footerBand",i=0,r=["row","column"];i<r.length;i++){var o=r[i],a=this.component.layoutHeaders[o][e];if(a&&a[0]){var s="row"===o?"height":"width";this.child.component.layoutSize.get(s)||(t[n]=t[n]||{},t[n][o]=.5)}}return t},u.prototype.assembleLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return f({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:e,bounds:"full",align:"all"})},u.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},u.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof u))return{signal:"length(data('"+this.getName("column_domain")+"'))"}},u.prototype.assembleGroup=function(e){return this.parent&&this.parent instanceof u?f({},this.channelHasField("column")?{encode:{update:{columns:{field:p.vgField(this.facet.column,{prefix:"distinct"})}}}}:{},s.prototype.assembleGroup.call(this,e)):s.prototype.assembleGroup.call(this,e)},u.prototype.getCardinalityAggregateForChild=function(){var e=[],t=[];if(this.child instanceof u)this.child.channelHasField("column")&&(e.push(p.vgField(this.child.facet.column)),t.push("distinct"));else for(var n=0,i=["x","y"];n<i.length;n++){var r=i[n],o=this.child.component.scales[r];if(o&&!o.merged){var a=o.get("type"),s=o.get("range");if(m.hasDiscreteDomain(a)&&h.isVgRangeStep(s)){var l=E.assembleDomain(this.child,r),c=E.getFieldFromDomain(l);c?(e.push(c),t.push("distinct")):g.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e.length?{fields:e,ops:t}:void 0},u.prototype.assembleMarks=function(){var e=this.child,t=this.facet,n=this.component.data.facetRoot,i=y.assembleFacetData(n),r=this.channelHasField(d.ROW),o=this.channelHasField(d.COLUMN),a=e.assembleLayoutSize(),s={};r&&o&&(s.aggregate={cross:!0});var l=this.getCardinalityAggregateForChild();l&&(s.aggregate=f({},s.aggregate,l));var c=e.assembleTitle(),u=e.assembleGroupStyle();return[f({name:this.getName("cell"),type:"group"},c?{title:c}:{},u?{style:u}:{},{from:{facet:f({name:n.name,data:n.data,groupby:[].concat(r?[this.vgField(d.ROW)]:[],o?[this.vgField(d.COLUMN)]:[])},s)},sort:{field:[].concat(r?[this.vgField(d.ROW,{expr:"datum"})]:[],o?[this.vgField(d.COLUMN,{expr:"datum"})]:[]),order:[].concat(r?[t.row.sort||"ascending"]:[],o?[t.column.sort||"ascending"]:[])}},0<i.length?{data:i}:{},a?{encode:{update:a}}:{},e.assembleGroup())]},u.prototype.getMapping=function(){return this.facet},u}(s.ModelWithField);n.FacetModel=u},{"../channel":15,"../encoding":104,"../fielddef":106,"../log":110,"../scale":115,"../util":125,"../vega.schema":127,"./axis/assemble":16,"./buildmodel":23,"./data/assemble":28,"./data/parse":42,"./layout/header":48,"./layoutsize/parse":50,"./model":69,"./repeater":74,"./resolve":75,"./scale/domain":78}],47:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var d=e("../log"),p=e("../spec"),o=e("../util"),a=e("./axis/parse"),s=e("./data/parse"),l=e("./layoutsize/assemble"),g=e("./layoutsize/parse"),m=e("./legend/assemble"),c=e("./model"),h=e("./selection/selection"),v=e("./unit"),u=function(c){function u(e,t,n,i,r,o,a){var s=c.call(this,e,t,n,o,e.resolve)||this;s.type="layer";var l=f({},i,e.width?{width:e.width}:{},e.height?{height:e.height}:{});return s.initSize(l),s.children=e.layer.map(function(e,t){if(p.isLayerSpec(e))return new u(e,s,s.getName("layer_"+t),l,r,o,a);if(p.isUnitSpec(e))return new v.UnitModel(e,s,s.getName("layer_"+t),l,r,o,a);throw new Error(d.message.INVALID_SPEC)}),s}return r(u,c),u.prototype.parseData=function(){this.component.data=s.parseData(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},u.prototype.parseLayoutSize=function(){g.parseLayerLayoutSize(this)},u.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),o.keys(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,i=this.children;t<i.length;t++){e(i[t])}},u.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},u.prototype.parseAxisAndHeader=function(){a.parseLayerAxis(this)},u.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},u.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},u.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},l.assembleLayoutSignals(this))},u.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},u.prototype.assembleTitle=function(){var e=c.prototype.assembleTitle.call(this);if(e)return e;for(var t=0,n=this.children;t<n.length;t++){if(e=n[t].assembleTitle())return e}},u.prototype.assembleLayout=function(){return null},u.prototype.assembleMarks=function(){return h.assembleLayerSelectionMarks(this,o.flatten(this.children.map(function(e){return e.assembleMarks()})))},u.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},m.assembleLegends(this))},u}(c.Model);n.LayerModel=u},{"../log":110,"../spec":118,"../util":125,"./axis/parse":20,"./data/parse":42,"./layoutsize/assemble":49,"./layoutsize/parse":50,"./legend/assemble":51,"./model":69,"./selection/selection":85,"./unit":96}],48:[function(e,t,u){"use strict";var h=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(u,"__esModule",{value:!0});var v=e("../../fielddef"),y=e("../../util"),b=e("../common");function O(e){return((e=(e%360+360)%360)+90)%180==0?{}:e<90||270<e?{align:{value:"right"}}:135<=e&&e<225?{align:{value:"left"}}:{}}function _(e){return 45<=(e=(e%360+360)%360)&&e<=135?{baseline:{value:"top"}}:{}}function f(e,t,n,i,r){if(r){var o=null,a=i.facetFieldDef;if(a&&r.labels){var s=a.header,l=void 0===s?{}:s,c=l.format,u=l.labelAngle,f=h({},void 0!==u?{angle:{value:u}}:{},O(u),_(u));o=h({text:b.formatSignalRef(a,c,"parent",e.config),offset:10,orient:"row"===t?"left":"top",style:"guide-label"},0<y.keys(f).length?{encode:{update:f}}:{})}var d=r.axes,p=d&&0<d.length;if(o||p){var g="row"===t?"height":"width";return h({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:{field:v.vgField(a,{expr:"datum"}),order:a.sort||"ascending"}}:{},o?{title:o}:{},r.sizeSignal?{encode:{update:(m={},m[g]=r.sizeSignal,m)}}:{},p?{axes:d}:{})}}return null;var m}u.HEADER_CHANNELS=["row","column"],u.HEADER_TYPES=["header","footer"],u.getHeaderType=function(e){return"top"===e||"left"===e?"header":"footer"},u.getTitleGroup=function(e,t){var n=e.component.layoutHeaders[t].title,i=h({align:{value:"center"},text:{value:n}},"vertical"===("row"===t?"vertical":void 0)?{angle:{value:270}}:{});return{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[h({type:"text",role:t+"-title-text",style:"guide-title"},0<y.keys(i).length?{encode:{update:i}}:{})]}},u.getHeaderGroups=function(e,t){for(var n=e.component.layoutHeaders[t],i=[],r=0,o=u.HEADER_TYPES;r<o.length;r++){var a=o[r];if(n[a])for(var s=0,l=n[a];s<l.length;s++){var c=l[s];i.push(f(e,t,a,n,c))}}return i},u.labelAlign=O,u.labelBaseline=_},{"../../fielddef":106,"../../util":125,"../common":24}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../scale"),u=e("../../vega.schema"),f=e("../model");function i(e,t){var n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];var r=e.getSizeSignalRef(t).signal;if("range-step"===i){var o=e.getScaleComponent(n);if(o){var a=o.get("type"),s=o.get("range");if(c.hasDiscreteDomain(a)&&u.isVgRangeStep(s)){var l=e.scaleName(n);if(f.isFacetModel(e.parent))if("independent"===e.parent.component.resolve.scale[n])return[d(l,s)];return[d(l,s),{name:r,update:p(l,o,"domain('"+l+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:r,value:i}]}function d(e,t){return{name:e+"_step",value:t.step}}function p(e,t,n){var i=t.get("type"),r=t.get("padding"),o=t.get("paddingOuter");o=void 0!==o?o:r;var a=t.get("paddingInner");return"bandspace("+n+", "+(a="band"===i?void 0!==a?a:r:1)+", "+o+") * "+e+"_step"}n.assembleLayoutSignals=function(e){return[].concat(i(e,"width"),i(e,"height"))},n.sizeSignals=i,n.sizeExpr=p},{"../../scale":115,"../../vega.schema":127,"../model":69}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../scale"),l=e("../../vega.schema"),d=e("../split");function i(e){r(e);var t=e.component.layoutSize;t.setWithExplicit("width",o(e,"width")),t.setWithExplicit("height",o(e,"height"))}function r(e){for(var t=0,n=e.children;t<n.length;t++){n[t].parseLayoutSize()}}function o(e,t){for(var n,i="width"===t?"x":"y",r=e.component.resolve,o=0,a=e.children;o<a.length;o++){var s=(f=a[o]).component.layoutSize.getWithExplicit(t),l=r.scale[i];if("independent"===l&&"range-step"===s.value){n=void 0;break}if(n){if("independent"===l&&n.value!==s.value){n=void 0;break}n=d.mergeValuesWithExplicit(n,s,t,"")}else n=s}if(n){for(var c=0,u=e.children;c<u.length;c++){var f=u[c];e.renameLayoutSize(f.getName(t),e.getName(t)),f.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function a(e,t){var n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){var o=r.get("type"),a=r.get("range");return s.hasDiscreteDomain(o)&&l.isVgRangeStep(a)?"range-step":i.view[t]}return"width"===t&&"text"===e.mark()?i.scale.textXRangeStep:i.scale.rangeStep||s.defaultScaleConfig.rangeStep}n.parseLayerLayoutSize=i,n.parseRepeatLayoutSize=i,n.parseConcatLayoutSize=function(e){r(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,o(e,n))},n.parseChildrenLayoutSize=r,n.parseUnitLayoutSize=function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=a(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var i=a(e,"height");t.set("height",i,!1)}}},{"../../scale":115,"../../vega.schema":127,"../split":95}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../util"),d=e("./parse");n.assembleLegends=function(e){for(var t=e.component.legends,n={},i=0,r=f.keys(t);i<r.length;i++){var o=r[i],a=e.getScaleComponent(o),s=f.stringify(a.domains);if(n[s])for(var l=0,c=n[s];l<c.length;l++){var u=c[l];d.mergeLegendComponent(u,t[o])||n[s].push(t[o])}else n[s]=[t[o].clone()]}return f.flatten(f.vals(n)).map(function(e){return e.combine()})}},{"../../util":125,"./parse":54}],52:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(e("../split").Split);n.LegendComponent=o},{"../split":95}],53:[function(e,t,n){"use strict";var d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),p=e("../../channel"),g=e("../../fielddef"),m=e("../../mark"),c=e("../../scale"),h=e("../../util"),v=e("../common"),y=e("../mark/mixins");function b(e){if(g.isValueDef(e)){if(g.hasConditionalValueDef(e)){var t=i.isArray(e.condition)?e.condition.map(function(e){return e.value}):[e.condition.value];return Math.max.apply(null,[e.value].concat(t))}return e.value}}n.symbols=function(e,t,n,i,r){if("gradient"!==r){var o={},a=n.mark();switch(a){case m.BAR:case m.TICK:case m.TEXT:o.shape={value:"square"};break;case m.CIRCLE:case m.SQUARE:o.shape={value:a};break;case m.POINT:case m.LINE:case m.GEOSHAPE:case m.AREA:}var s=n.markDef.filled,l=i===p.COLOR?h.without(m.FILL_STROKE_CONFIG,[s?"fill":"stroke","strokeDash","strokeDashOffset"]):m.FILL_STROKE_CONFIG;if(l=h.without(l,["strokeDash","strokeDashOffset"]),v.applyMarkConfig(o,n,l),i!==p.COLOR){var c=y.color(n);c.fill&&(c.fill.field||"transparent"===c.fill.value)&&delete c.fill,c.stroke&&(c.stroke.field||"transparent"===c.stroke.value)&&delete c.stroke,o=d({},o,c)}if(i!==p.SHAPE){var u=n.encoding.shape;g.isValueDef(u)&&(o.shape={value:u.value})}if(i!==p.OPACITY){var f=b(n.encoding.opacity)||n.markDef.opacity;f&&(o.opacity={value:f})}return o=d({},o,t),0<h.keys(o).length?o:void 0}},n.gradient=function(e,t,n,i,r){var o={};if("gradient"===r){var a=b(n.encoding.opacity)||n.markDef.opacity;a&&(o.opacity={value:a})}return o=d({},o,t),0<h.keys(o).length?o:void 0},n.labels=function(e,t,n,i,r){var o=n.legend(i),a=n.config,s={};if(g.isTimeFieldDef(e)){var l=n.getScaleComponent(i).get("type")===c.ScaleType.UTC;t=d({text:{signal:v.timeFormatExpression("datum.value",e.timeUnit,o.format,a.legend.shortTimeLabels,a.timeFormat,l)}},t)}return s=d({},s,t),0<h.keys(s).length?s:void 0}},{"../../channel":15,"../../fielddef":106,"../../mark":112,"../../scale":115,"../../util":125,"../common":24,"../mark/mixins":62,"vega-util":10}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../channel"),u=e("../../fielddef"),f=e("../../legend"),o=e("../../type"),d=e("../../util"),p=e("../common"),a=e("../model"),l=e("../resolve"),g=e("../split"),m=e("../split"),h=e("./component"),v=e("./encode"),y=e("./properties");function b(e){var i,r;a.isUnitModel(e)?e.component.legends=(r=(i=e).encoding,[c.COLOR,c.FILL,c.STROKE,c.SIZE,c.SHAPE,c.OPACITY].reduce(function(e,t){var n=r[t];return!i.legend(t)||!i.getScaleComponent(t)||u.isFieldDef(n)&&t===c.SHAPE&&n.type===o.GEOJSON||(e[t]=s(i,t)),e},{})):e.component.legends=function(r){for(var e=r.component,n=e.legends,o=e.resolve,t=function(t){b(t),d.keys(t.component.legends).forEach(function(e){o.legend[e]=l.parseGuideResolve(r.component.resolve,e),"shared"===o.legend[e]&&(n[e]=O(n[e],t.component.legends[e]),n[e]||(o.legend[e]="independent",delete n[e]))})},i=0,a=r.children;i<a.length;i++){var s=a[i];t(s)}return d.keys(n).forEach(function(e){for(var t=0,n=r.children;t<n.length;t++){var i=n[t];i.component.legends[e]&&"shared"===o.legend[e]&&delete i.component.legends[e]}}),n}(e)}function s(i,r){var o=i.fieldDef(r),a=i.legend(r),s=new h.LegendComponent({},function(e,t){switch(t){case c.COLOR:var n=e.scaleName(c.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case c.FILL:case c.STROKE:case c.SIZE:case c.SHAPE:case c.OPACITY:return(i={})[t]=e.scaleName(t),i}var i}(i,r));f.LEGEND_PROPERTIES.forEach(function(e){var t=function(e,t,n,i){var r=i.fieldDef(n);switch(e){case"format":return p.numberFormat(r,t.format,i.config);case"title":return p.getSpecifiedOrDefaultValue(t.title||(void 0===t.title?void 0:null),u.title(r,i.config))||void 0;case"values":return y.values(t);case"type":return p.getSpecifiedOrDefaultValue(t.type,y.type(r.type,n,i.getScaleComponent(n).get("type")))}return t[e]}(e,a,r,i);if(void 0!==t){var n="values"===e?!!a.values:t===a[e];(n||void 0===i.config.legend[e])&&s.set(e,t,n)}});var l=a.encoding||{},e=["labels","legend","title","symbols","gradient"].reduce(function(e,t){var n=v[t]?v[t](o,l[t],i,r,s.get("type")):l[t];return void 0!==n&&0<d.keys(n).length&&(e[t]={update:n}),e},{});return 0<d.keys(e).length&&s.set("encode",e,!!a.encoding),s}function O(t,i){if(!t)return i.clone();var e=t.getWithExplicit("orient"),n=i.getWithExplicit("orient");if(!e.explicit||!n.explicit||e.value===n.value){for(var r=!1,o=function(n){var e=m.mergeValuesWithExplicit(t.getWithExplicit(n),i.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return p.titleMerger(e,t);case"type":return r=!0,g.makeImplicit("symbol")}return m.defaultTieBreaker(e,t,n,"legend")});t.setWithExplicit(n,e)},a=0,s=f.VG_LEGEND_PROPERTIES;a<s.length;a++){o(s[a])}return r&&(((t.implicit||{}).encode||{}).gradient&&d.deleteNestedProperty(t.implicit,["encode","gradient"]),((t.explicit||{}).encode||{}).gradient&&d.deleteNestedProperty(t.explicit,["encode","gradient"])),t}}n.parseLegend=b,n.parseLegendForChannel=s,n.mergeLegendComponent=O},{"../../channel":15,"../../fielddef":106,"../../legend":109,"../../type":124,"../../util":125,"../common":24,"../model":69,"../resolve":75,"../split":95,"./component":52,"./encode":53,"./properties":55}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),r=e("../../datetime"),o=e("../../scale"),a=e("../../util");n.values=function(e){var t=e.values;return t&&r.isDateTime(t[0])?t.map(function(e){return{signal:r.dateTimeExpr(e,!0)}}):t},n.type=function(e,t,n){if(i.isColorChannel(t)&&("quantitative"===e&&!o.isBinScale(n)||"temporal"===e&&a.contains(["time","utc"],n)))return"gradient"}},{"../../channel":15,"../../datetime":103,"../../scale":115,"../../util":125}],56:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mixins");n.area={vgMark:"area",encodeEntry:function(e){return i({},r.baseEncodeEntry(e,{size:"ignore",orient:"include"}),r.pointPosition("x",e,"zeroOrMin"),r.pointPosition("y",e,"zeroOrMin"),r.pointPosition2(e,"zeroOrMin"))}}},{"./mixins":62}],57:[function(e,t,n){"use strict";var f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),d=e("../../channel"),p=e("../../fielddef"),s=e("../../log"),g=e("../../scale"),l=e("../../vega.schema"),m=e("./mixins"),h=e("./valueref");function v(e,t,n,i){if(void 0!==e.size)return{value:e.size};if(i.bar.discreteBandSize)return{value:i.bar.discreteBandSize};if(n){var r=n.get("type");if(r!==g.ScaleType.POINT)return r===g.ScaleType.BAND?h.bandRef(t):{value:i.bar.continuousBandSize};var o=n.get("range");if(l.isVgRangeStep(o)&&a.isNumber(o.step))return{value:o.step-1};s.warn(s.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}else if(i.scale.rangeStep&&null!==i.scale.rangeStep)return{value:i.scale.rangeStep-1};return{value:20}}n.bar={vgMark:"rect",encodeEntry:function(e){return f({},m.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.config,n=e.encoding,i=e.markDef,r=e.width,o=i.orient,a=n.size,s=n.x,l=e.scaleName(d.X),c=e.getScaleComponent(d.X);{if("horizontal"===o)return f({},m.pointPosition("x",e,"zeroOrMin"),m.pointPosition2(e,"zeroOrMin"));if(p.isFieldDef(s)){var u=c.get("type");if(s.bin&&!a&&!g.hasDiscreteDomain(u))return m.binnedPosition(s,"x",e.scaleName("x"),t.bar.binSpacing,c.get("reverse"));if(u===g.ScaleType.BAND)return m.bandPosition(s,"x",e)}return m.centeredBandPosition("x",e,f({},h.mid(r)),v(i,l,c,t))}}(e),function(e){var t=e.config,n=e.encoding,i=e.height,r=e.markDef,o=r.orient,a=n.size,s=n.y,l=e.scaleName(d.Y),c=e.getScaleComponent(d.Y);{if("vertical"===o)return f({},m.pointPosition("y",e,"zeroOrMin"),m.pointPosition2(e,"zeroOrMin"));if(p.isFieldDef(s)){var u=c.get("type");if(s.bin&&!a&&!g.hasDiscreteDomain(u))return m.binnedPosition(s,"y",e.scaleName("y"),t.bar.binSpacing,c.get("reverse"));if(u===g.ScaleType.BAND)return m.bandPosition(s,"y",e)}return m.centeredBandPosition("y",e,h.mid(i),v(r,l,c,t))}}(e))}}},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../scale":115,"../../vega.schema":127,"./mixins":62,"./valueref":68,"vega-util":10}],58:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mixins"),o=e("../../fielddef"),a=e("../../type");n.geoshape={vgMark:"shape",encodeEntry:function(e){return i({},r.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding.shape;return[i({type:"geoshape",projection:e.projectionName()},t&&o.isFieldDef(t)&&t.type===a.GEOJSON?{field:o.vgField(t,{expr:"datum"})}:{})]}}},{"../../fielddef":106,"../../type":124,"./mixins":62}],59:[function(e,t,n){"use strict";var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../encoding"),f=e("../../fielddef"),d=e("../../log"),p=e("../../mark"),g=e("../../type"),m=e("../../util"),h=e("../common");n.normalizeMarkDef=function(e,t,n){var i,r,o,a,s=p.isMarkDef(e)?c({},e):{type:e},l=s.orient||h.getMarkConfig("orient",s,n);return s.orient=function(e,t,n){switch(e){case p.POINT:case p.CIRCLE:case p.SQUARE:case p.TEXT:case p.RECT:return}var i=t.y2,r=t.x2;switch(e){case p.RULE:if(r&&i)return;case p.BAR:case p.AREA:if(i)return"vertical";if(r)return"horizontal";if(e===p.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case p.LINE:case p.TICK:var o=f.isFieldDef(t.x)&&f.isContinuous(t.x),a=f.isFieldDef(t.y)&&f.isContinuous(t.y);if(o&&!a)return"tick"!==e?"horizontal":"vertical";if(!o&&a)return"tick"!==e?"vertical":"horizontal";if(o&&a){var s=t.x,l=t.y,c=s.type===g.TEMPORAL,u=l.type===g.TEMPORAL;return c&&!u?"tick"!==e?"vertical":"horizontal":!c&&u?"tick"!==e?"horizontal":"vertical":!s.aggregate&&l.aggregate?"tick"!==e?"vertical":"horizontal":s.aggregate&&!l.aggregate?"tick"!==e?"horizontal":"vertical":n||(e===p.LINE&&t.order||d.warn(d.message.unclearOrientContinuous(e)),"vertical")}return void d.warn(d.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}(s.type,t,l),void 0!==l&&l!==s.orient&&d.warn(d.message.orientOverridden(s.orient,l)),void 0===(s.opacity||h.getMarkConfig("opacity",s,n))&&(s.opacity=function(e,t){if(m.contains([p.POINT,p.TICK,p.CIRCLE,p.SQUARE],e)&&!u.isAggregate(t))return.7}(s.type,t)),void 0===s.filled&&(s.filled=(i=s,r=n,o=h.getMarkConfig("filled",i,r),a=i.type,void 0!==o?o:a!==p.POINT&&a!==p.LINE&&a!==p.RULE)),s}},{"../../encoding":104,"../../fielddef":106,"../../log":110,"../../mark":112,"../../type":124,"../../util":125,"../common":24}],60:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mixins"),o=e("./valueref");n.line={vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return i({},r.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),r.pointPosition("x",e,o.mid(t)),r.pointPosition("y",e,o.mid(n)),r.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":62,"./valueref":68}],61:[function(e,t,n){"use strict";var f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-util"),d=e("../../data"),r=e("../../encoding"),a=e("../../fielddef"),s=e("../../mark"),l=e("../../sort"),c=e("../../util"),p=e("../common"),i=e("./area"),u=e("./bar"),g=e("./geoshape"),m=e("./line"),h=e("./point"),v=e("./rect"),y=e("./rule"),b=e("./text"),O=e("./tick"),_={area:i.area,bar:u.bar,line:m.line,point:h.point,text:b.text,tick:O.tick,rect:v.rect,rule:y.rule,circle:h.circle,square:h.square,geoshape:g.geoshape};n.parseMarkGroup=function(e){return c.contains([s.LINE,s.AREA],e.mark())?(n=w((t=e).encoding),i=x(t,{fromPrefix:0<n.length?S:""}),0<n.length?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:S+t.requestDataName(d.MAIN),data:t.requestDataName(d.MAIN),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:i}]:i):x(e);var t,n,i};var S="faceted_path_";function E(e){if(e.channelHasField("order")&&!e.stack)return p.sortParams(e.encoding.order,{expr:"datum"});if(c.contains(["line","area"],e.mark())){var t="horizontal"===e.markDef.orient?"y":"x",n=e.sort(t),i=l.isSortField(n)?a.vgField({aggregate:r.isAggregate(e.encoding)?n.op:void 0,field:n.field},{expr:"datum"}):e.vgField(t,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"});return i?{field:i,order:"descending"}:void 0}}function x(e,t){void 0===t&&(t={fromPrefix:""});var n,i,r,o=e.mark(),a=void 0!==e.markDef.clip?!!e.markDef.clip:(i=(n=e).getScaleComponent("x"),r=n.getScaleComponent("y"),!!(i&&i.get("domainRaw")||r&&r.get("domainRaw"))),s=p.getStyles(e.markDef),l=e.encoding.key,c=E(e),u=_[o].postEncodingTransform?_[o].postEncodingTransform(e):null;return[f({name:e.getName("marks"),type:_[o].vgMark},a?{clip:!0}:{},s?{style:s}:{},l?{key:{field:l.field}}:{},c?{sort:c}:{},{from:{data:t.fromPrefix+e.requestDataName(d.MAIN)},encode:{update:_[o].encodeEntry(e)}},u?{transform:u}:{})]}function w(r){return c.keys(r).reduce(function(t,e){switch(e){case"x":case"y":case"order":case"tooltip":case"href":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":return t;case"detail":case"key":var n=r[e];return n&&(o.isArray(n)?n:[n]).forEach(function(e){e.aggregate||t.push(a.vgField(e,{}))}),t;case"color":case"fill":case"stroke":case"size":case"opacity":var i=a.getFieldDef(r[e]);return i&&!i.aggregate&&t.push(a.vgField(i,{})),t;default:throw new Error("Bug: Channel "+e+" unimplemented for line mark")}},[])}n.getSort=E,n.pathGroupingFields=w},{"../../data":102,"../../encoding":104,"../../fielddef":106,"../../mark":112,"../../sort":117,"../../util":125,"../common":24,"./area":56,"./bar":57,"./geoshape":58,"./line":60,"./point":63,"./rect":64,"./rule":65,"./text":66,"./tick":67,"vega-util":10}],62:[function(e,t,n){"use strict";var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-util"),f=e("../../fielddef"),d=e("../../log"),p=e("../../predicate"),a=e("../../util"),r=e("../../vega.schema"),s=e("../common"),g=e("../selection/selection"),m=e("./valueref");function o(e){var t=e.config,n=e.markDef,i=n.filled,r=n.type,o=i?"fill":"stroke";return c({},a.contains(["bar","point","circle","square","geoshape"],r)?{fill:{value:"transparent"}}:{},h("color",e,{vgChannel:o,defaultValue:e.markDef[o]||e.markDef.color||s.getMarkConfig(o,e.markDef,t)||s.getMarkConfig("color",e.markDef,t)}),h("fill",e),h("stroke",e))}function h(t,n,e){void 0===e&&(e={});var i=e.defaultValue,r=e.vgChannel,o=e.defaultRef||(void 0!==i?{value:i}:void 0),a=n.encoding[t];return l(n,a,r||t,function(e){return m.midPoint(t,e,n.scaleName(t),n.getScaleComponent(t),null,o)})}function l(i,e,t,r){var n,o,a=e&&e.condition,s=r(e);if(a){var l=(u.isArray(a)?a:[a]).map(function(e){var t=r(e),n=f.isConditionalSelection(e)?g.selectionPredicate(i,e.selection):p.expression(i,e.test);return c({test:n},t)});return(n={})[t]=l.concat(void 0!==s?[s]:[]),n}return void 0!==s?((o={})[t]=s,o):{}}function v(t,e){void 0===e&&(e="text");var n=t.encoding[e];return l(t,n,e,function(e){return m.text(e,t.config)})}function y(e,t,n,i){var r,o=t.encoding,a=t.stack,s=o[e]||!o.latitude&&!o.longitude?m.stackable(e,o[e],t.scaleName(e),t.getScaleComponent(e),a,n):{field:t.getName(e)};return(r={})[i||e]=s,r}n.color=o,n.baseEncodeEntry=function(e,t){return c({},(n=e.markDef,i=t,r.VG_MARK_CONFIGS.reduce(function(e,t){return void 0!==n[t]&&"ignore"!==i[t]&&(e[t]={value:n[t]}),e},{})),o(e),h("opacity",e),v(e,"tooltip"),v(e,"href"));var n,i},n.valueIfDefined=function(e,t){if(void 0!==t)return(n={})[e]={value:t},n;var n},n.nonPosition=h,n.text=v,n.bandPosition=function(e,t,n){var i,r,o,a=n.scaleName(t),s="x"===t?"width":"height";if(n.encoding.size||void 0!==n.markDef.size)if(n.markDef.orient){var l=((i={})[t+"c"]=m.fieldRef(e,a,{},{band:.5}),i);if(f.getFieldDef(n.encoding.size))d.warn(d.message.cannotUseSizeFieldWithBandSize(t));else{if(f.isValueDef(n.encoding.size))return c({},l,h("size",n,{vgChannel:s}));if(void 0!==n.markDef.size)return c({},l,((r={})[s]={value:n.markDef.size},r))}}else d.warn(d.message.cannotApplySizeToNonOrientedMark(n.markDef.type));return(o={})[t]=m.fieldRef(e,a,{binSuffix:"range"}),o[s]=m.bandRef(a),o},n.centeredBandPosition=function(e,t,n,i){var r="x"===e?"width":"height";return c({},y(e,t,n,"x"===e?"xc":"yc"),h("size",t,{defaultRef:i,vgChannel:r}))},n.binnedPosition=function(e,t,n,i,r){return"x"===t?{x2:m.bin(e,n,"start",r?0:i),x:m.bin(e,n,"end",r?i:0)}:{y2:m.bin(e,n,"start",r?i:0),y:m.bin(e,n,"end",r?0:i)}},n.pointPosition=y,n.pointPosition2=function(e,t,n){var i,r=e.encoding,o=e.markDef,a=e.stack,s="x2"===(n=n||("horizontal"===o.orient?"x2":"y2"))?"x":"y",l=r[s],c=l||!r.latitude&&!r.longitude?m.stackable2(n,l,r[n],e.scaleName(s),e.getScaleComponent(s),a,t):{field:e.getName(n)};return(i={})[n]=c,i}},{"../../fielddef":106,"../../log":110,"../../predicate":113,"../../util":125,"../../vega.schema":127,"../common":24,"../selection/selection":85,"./valueref":68,"vega-util":10}],63:[function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../common"),a=e("./mixins"),s=e("./valueref");function r(e,t){var n=e.config,i=e.width,r=e.height;return o({},a.baseEncodeEntry(e,{size:"include",orient:"ignore"}),a.pointPosition("x",e,s.mid(i)),a.pointPosition("y",e,s.mid(r)),a.nonPosition("size",e),l(e,n,t))}function l(e,t,n){return n?{shape:{value:n}}:a.nonPosition("shape",e,{defaultValue:i.getMarkConfig("shape",e.markDef,t)})}n.shapeMixins=l,n.point={vgMark:"symbol",encodeEntry:function(e){return r(e)}},n.circle={vgMark:"symbol",encodeEntry:function(e){return r(e,"circle")}},n.square={vgMark:"symbol",encodeEntry:function(e){return r(e,"square")}}},{"../common":24,"./mixins":62,"./valueref":68}],64:[function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),c=e("../../mark"),u=e("../../scale"),f=e("./mixins");n.rect={vgMark:"rect",encodeEntry:function(e){return o({},f.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.encoding.x,n=e.encoding.x2,i=e.getScaleComponent(a.X),r=i?i.get("type"):void 0;{if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"x",e.scaleName("x"),0,i.get("reverse"));if(s.isFieldDef(t)&&i&&u.hasDiscreteDomain(r)){if(r===u.ScaleType.BAND)return f.bandPosition(t,"x",e);throw new Error(l.message.scaleTypeNotWorkWithMark(c.RECT,r))}return o({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}}(e),function(e){var t=e.encoding.y,n=e.encoding.y2,i=e.getScaleComponent(a.Y),r=i?i.get("type"):void 0;{if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"y",e.scaleName("y"),0,i.get("reverse"));if(s.isFieldDef(t)&&i&&u.hasDiscreteDomain(r)){if(r===u.ScaleType.BAND)return f.bandPosition(t,"y",e);throw new Error(l.message.scaleTypeNotWorkWithMark(c.RECT,r))}return o({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}}(e))}}},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../mark":112,"../../scale":115,"./mixins":62}],65:[function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./mixins"),s=e("./valueref");n.rule={vgMark:"rule",encodeEntry:function(e){e.config;var t=e.markDef,n=e.width,i=e.height,r=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?o({},a.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),a.pointPosition("x",e,"horizontal"===r?"zeroOrMin":s.mid(n)),a.pointPosition("y",e,"vertical"===r?"zeroOrMin":s.mid(i)),"vertical"!==r?a.pointPosition2(e,"zeroOrMax","x2"):{},"horizontal"!==r?a.pointPosition2(e,"zeroOrMax","y2"):{},a.nonPosition("size",e,{vgChannel:"strokeWidth"})):{}}}},{"./mixins":62,"./valueref":68}],66:[function(e,t,n){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),l=e("../../encoding"),c=e("../../fielddef"),u=e("../../type"),f=e("../common"),d=e("./mixins"),p=e("./valueref");n.text={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding,i=e.height,r=e.markDef,o=n.text;return a({},d.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),d.pointPosition("x",e,function(e,t){if(c.isFieldDef(t)&&t.type===u.QUANTITATIVE)return{field:{group:"width"},offset:-5};return{value:e.scale.textXRangeStep/2}}(t,o)),d.pointPosition("y",e,p.mid(i)),d.text(e),d.nonPosition("size",e,a({},r.size?{defaultValue:r.size}:{},{vgChannel:"fontSize"})),d.valueIfDefined("align",function(e,t,n){if(void 0===(e.align||f.getMarkConfig("align",e,n)))return l.channelHasField(t,s.X)||l.channelHasField(t,s.LONGITUDE)?"center":"right";return}(e.markDef,n,t)))}}},{"../../channel":15,"../../encoding":104,"../../fielddef":106,"../../type":124,"../common":24,"./mixins":62,"./valueref":68}],67:[function(e,t,n){"use strict";var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../vega.schema"),f=e("./mixins"),d=e("./valueref");n.tick={vgMark:"rect",encodeEntry:function(e){var t,n=e.config,i=e.markDef,r=e.width,o=e.height,a=i.orient,s="horizontal"===a?"width":"height",l="horizontal"===a?"height":"width";return c({},f.baseEncodeEntry(e,{size:"ignore",orient:"ignore"}),f.pointPosition("x",e,d.mid(r),"xc"),f.pointPosition("y",e,d.mid(o),"yc"),f.nonPosition("size",e,{defaultValue:function(e){var t=e.config,n=e.markDef,i=n.orient,r=e.getScaleComponent("horizontal"===i?"x":"y");{if(void 0!==n.size)return n.size;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var o=r?r.get("range"):void 0,a=o&&u.isVgRangeStep(o)?o.step:t.scale.rangeStep;if("number"!=typeof a)throw new Error("Function does not handle non-numeric rangeStep");return a/1.5}}(e),vgChannel:s}),((t={})[l]={value:n.tick.thickness},t))}}},{"../../vega.schema":127,"./mixins":62,"./valueref":68}],68:[function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../channel"),u=e("../../fielddef"),f=e("../../scale"),d=e("../../type"),p=e("../../util"),g=e("../common");function m(e,t,n,i){var r=o({},t?{scale:t}:{},{field:u.vgField(e,n)});return i?o({},r,i):r}function s(e,t,n,i,r,o){if(t){if(u.isFieldDef(t)){if(t.bin)return p.contains([c.X,c.Y],e)&&t.type===d.QUANTITATIVE?r&&r.impute?m(t,n,{binSuffix:"mid"}):(s=t,{signal:'(scale("'+(l=n)+'", '+u.vgField(s,{expr:"datum"})+') + scale("'+l+'", '+u.vgField(s,{binSuffix:"end",expr:"datum"})+"))/2"}):m(t,n,g.binRequiresRange(t,e)?{binSuffix:"range"}:{});if(i){var a=i.get("type");if(f.hasDiscreteDomain(a))return"band"===a?m(t,n,{binSuffix:"range"},{band:.5}):m(t,n,{binSuffix:"range"})}return m(t,n,{})}if(u.isValueDef(t))return{value:t.value}}var s,l;if("zeroOrMin"===o){if(e===c.X||e===c.X2)return function(e,t){if(e&&!p.contains([f.ScaleType.LOG,f.ScaleType.TIME,f.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{value:0}}(n,i);if(e===c.Y||e===c.Y2)return function(e,t){if(e&&!p.contains([f.ScaleType.LOG,f.ScaleType.TIME,f.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{field:{group:"height"}}}(n,i);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===o){if(e===c.X||e===c.X2)return function(e,t){if(e&&!p.contains([f.ScaleType.LOG,f.ScaleType.TIME,f.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{field:{group:"width"}}}(n,i);if(e===c.Y||e===c.Y2)return function(e,t){if(e&&!p.contains([f.ScaleType.LOG,f.ScaleType.TIME,f.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{value:0}}(n,i);throw new Error("Unsupported channel "+e+" for base function")}return o}n.stackable=function(e,t,n,i,r,o){return u.isFieldDef(t)&&r&&e===r.fieldChannel?m(t,n,{suffix:"end"}):s(e,t,n,i,r,o)},n.stackable2=function(e,t,n,i,r,o,a){return u.isFieldDef(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?m(t,i,{suffix:"start"}):s(e,n,i,r,o,a)},n.bin=function(e,t,n,i){return m(e,t,{binSuffix:"start"===n?void 0:"end"},i?{offset:i}:{})},n.fieldRef=m,n.bandRef=function(e,t){return void 0===t&&(t=!0),{scale:e,band:t}},n.midPoint=s,n.text=function(e,t){if(e){if(u.isFieldDef(e))return g.formatSignalRef(e,e.format,"datum",t);if(u.isValueDef(e))return{value:e.value}}},n.mid=function(e){return o({},e,{mult:.5})}},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../type":124,"../../util":125,"../common":24}],69:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("vega-util"),o=e("../channel"),l=e("../encoding"),c=e("../fielddef"),u=e("../log"),f=e("../scale"),d=e("../spec"),p=e("../title"),g=e("../transform"),m=e("../util"),h=e("../vega.schema"),v=e("./axis/assemble"),y=e("./layout/header"),b=e("./layoutsize/assemble"),O=e("./legend/assemble"),_=e("./legend/parse"),S=e("./projection/assemble"),E=e("./projection/parse"),x=e("./scale/assemble"),w=e("./scale/domain"),N=e("./scale/parse"),T=e("./split"),P=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();function D(e){return e&&"unit"===e.type}function k(e){return e&&"facet"===e.type}n.NameMap=P,n.isUnitModel=D,n.isFacetModel=k,n.isRepeatModel=function(e){return e&&"repeat"===e.type},n.isConcatModel=function(e){return e&&"concat"===e.type},n.isLayerModel=function(e){return e&&"layer"===e.type};var j=function(){function e(e,t,n,i,r){var o=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=o.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=o.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=i,this.name=e.name||n,this.title=s.isString(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new P,this.projectionNameMap=t?t.projectionNameMap:new P,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new P,this.data=e.data,this.description=e.description,this.transforms=g.normalizeTransform(e.transform||[]),this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},ancestorParse:t?a({},t.component.data.ancestorParse):{},isFaceted:d.isFacetSpec(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new T.Split,layoutHeaders:{row:{},column:{}},mark:null,resolve:a({scale:{},axis:{},legend:{}},r||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseProjection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){N.parseScale(this)},e.prototype.parseProjection=function(){E.parseProjection(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseLegend=function(){_.parseLegend(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,i=y.HEADER_CHANNELS;n<i.length;n++){e[a=i[n]].title&&t.push(y.getTitleGroup(this,a))}for(var r=0,o=y.HEADER_CHANNELS;r<o.length;r++){var a=o[r];t=t.concat(y.getHeaderGroups(this,a))}return t},e.prototype.assembleAxes=function(){return v.assembleAxes(this.component.axes,this.config)},e.prototype.assembleLegends=function(){return O.assembleLegends(this)},e.prototype.assembleProjections=function(){return S.assembleProjections(this)},e.prototype.assembleTitle=function(){var e=a({},p.extractTitleConfig(this.config.title).nonMark,this.title);if(e.text)return m.contains(["unit","layer"],this.type)||(e.anchor&&"start"!==e.anchor&&u.warn(u.message.cannotSetTitleAnchor(this.type)),e.anchor="start"),0<m.keys(e).length?e:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};0<(e=e.concat(this.assembleSelectionSignals())).length&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var i=!this.parent||k(this.parent)?x.assembleScales(this):[];0<i.length&&(t.scales=i);var r=this.assembleAxes();0<r.length&&(t.axes=r);var o=this.assembleLegends();return 0<o.length&&(t.legends=o),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var i=n[t];if(D(i)){if(i.channelHasField(e))return!0}else if(i.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return m.varName((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(k(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var i=n.get("type"),r=n.get("range");if(f.hasDiscreteDomain(i)&&h.isVgRangeStep(r)){var o=n.get("name"),a=w.assembleDomain(this,t),s=w.getFieldFromDomain(a);if(s){var l=c.vgField({aggregate:"distinct",field:s},{expr:"datum"});return{signal:b.sizeExpr(o,n,l)}}return u.warn("Unknown field for ${channel}.  Cannot calculate view size."),null}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):o.isChannel(e)&&o.isScaleChannel(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.projectionName=function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(u.message.selectionNotFound(t));return n},e}(),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.vgField=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return c.vgField(n,t)},t.prototype.reduceFieldDef=function(r,e,t){return l.reduce(this.getMapping(),function(e,t,n){var i=c.getFieldDef(t);return i?r(e,i,n):e},e,t)},t.prototype.forEachFieldDef=function(i,e){l.forEach(this.getMapping(),function(e,t){var n=c.getFieldDef(e);n&&i(n,t)},e)},t}(n.Model=j);n.ModelWithField=A},{"../channel":15,"../encoding":104,"../fielddef":106,"../log":110,"../scale":115,"../spec":118,"../title":121,"../transform":123,"../util":125,"../vega.schema":127,"./axis/assemble":16,"./layout/header":48,"./layoutsize/assemble":49,"./legend/assemble":51,"./legend/parse":54,"./projection/assemble":70,"./projection/parse":72,"./scale/assemble":76,"./scale/domain":78,"./scale/parse":79,"./split":95,"vega-util":10}],70:[function(e,t,n){"use strict";var s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},l=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../util"),u=e("../../vega.schema"),i=e("../model");function r(e){return e.children.reduce(function(e,t){return e.concat(t.assembleProjections())},o(e))}function o(i){var e=i.component.projection;if(!e||e.merged)return[];var t=e.combine(),n=t.name,r=l(t,["name"]),o={signal:"["+e.size.map(function(e){return e.signal}).join(", ")+"]"},a=e.data.reduce(function(e,t){var n=u.isVgSignalRef(t)?t.signal:"data('"+i.lookupDataSource(t)+"')";return c.contains(e,n)||e.push(n),e},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[s({name:n,size:o,fit:{signal:1<a.length?"["+a.join(", ")+"]":a[0]}},r)]}n.assembleProjections=function(e){return i.isLayerModel(e)||i.isConcatModel(e)||i.isRepeatModel(e)?r(e):o(e)},n.assembleProjectionsForModelAndChildren=r,n.assembleProjectionForModel=o},{"../../util":125,"../../vega.schema":127,"../model":69}],71:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=function(o){function e(e,t,n,i){var r=o.call(this,a({},t),{name:e})||this;return r.specifiedProjection=t,r.size=n,r.data=i,r.merged=!1,r}return r(e,o),e}(e("../split").Split);n.ProjectionComponent=o},{"../split":95}],72:[function(e,t,n){"use strict";var l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../channel"),u=e("../../data"),f=e("../../fielddef"),d=e("../../mark"),o=e("../../projection"),p=e("../../type"),a=e("../../util"),i=e("../model"),g=e("./component");function s(e){i.isUnitModel(e)?e.component.projection=function(t){var e=t.specifiedProjection,n=t.markDef,i=t.config,r=t.encoding,o=n&&n.type===d.GEOSHAPE,a=r&&c.GEOPOSITION_CHANNELS.some(function(e){return f.isFieldDef(r[e])});if(o||a){var s=[];return[[c.LONGITUDE,c.LATITUDE],[c.LONGITUDE2,c.LATITUDE2]].forEach(function(e){(t.channelHasField(e[0])||t.channelHasField(e[1]))&&s.push({signal:t.getName("geojson_"+s.length)})}),t.channelHasField(c.SHAPE)&&t.fieldDef(c.SHAPE).type===p.GEOJSON&&s.push({signal:t.getName("geojson_"+s.length)}),0===s.length&&s.push(t.requestDataName(u.MAIN)),new g.ProjectionComponent(t.projectionName(!0),l({},i.projection||{},e||{}),[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")],s)}return}(e):e.component.projection=function(e){if(0===e.children.length)return;var i,t=a.every(e.children,function(e){s(e);var t=e.component.projection;if(t){if(i){var n=function(t,n){var e=a.every(o.PROJECTION_PROPERTIES,function(e){return!t.explicit.hasOwnProperty(e)&&!n.explicit.hasOwnProperty(e)||!(!t.explicit.hasOwnProperty(e)||!n.explicit.hasOwnProperty(e)||a.stringify(t.get(e))!==a.stringify(n.get(e)))});if(a.stringify(t.size)===a.stringify(n.size)){if(e)return t;if(a.stringify(t.explicit)===a.stringify({}))return n;if(a.stringify(n.explicit)===a.stringify({}))return t}return null}(i,t);return n&&(i=n),!!n}return i=t,!0}return!0});if(i&&t){var n=e.projectionName(!0),r=new g.ProjectionComponent(n,i.specifiedProjection,i.size,a.duplicate(i.data));return e.children.forEach(function(e){e.component.projection&&(r.data=r.data.concat(e.component.projection.data),e.renameProjection(e.component.projection.get("name"),n),e.component.projection.merged=!0)}),r}return}(e)}n.parseProjection=s},{"../../channel":15,"../../data":102,"../../fielddef":106,"../../mark":112,"../../projection":114,"../../type":124,"../../util":125,"../model":69,"./component":71}],73:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("../log"),o=e("./baseconcat"),m=e("./buildmodel"),l=e("./layoutsize/parse"),a=function(a){function e(e,t,n,i,r){var o=a.call(this,e,t,n,r,e.resolve)||this;return o.type="repeat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&s.warn(s.message.REPEAT_CANNOT_SHARE_AXIS),o.repeat=e.repeat,o.children=o._initChildren(e,o.repeat,i,r),o}return r(e,a),e.prototype._initChildren=function(e,t,n,i){for(var r=[],o=t.row||[n?n.row:null],a=t.column||[n?n.column:null],s=0,l=o;s<l.length;s++)for(var c=l[s],u=0,f=a;u<f.length;u++){var d=f[u],p=(c?"_"+c:"")+(d?"_"+d:""),g={row:c,column:d};r.push(m.buildModel(e.spec,this,this.getName("child"+p),void 0,g,i,!1))}return r},e.prototype.parseLayoutSize=function(){l.parseRepeatLayoutSize(this)},e.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},e}(o.BaseConcatModel);n.RepeatModel=a},{"../log":110,"./baseconcat":22,"./buildmodel":23,"./layoutsize/parse":50}],74:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),o=e("../fielddef"),s=e("../log"),l=e("../sort");function c(e,t){return o.isRepeatRef(e.field)?e.field.repeat in t?i({},e,{field:t[e.field.repeat]}):void s.warn(s.message.noSuchRepeatedValue(e.field.repeat)):e}function u(e,t){if(void 0!==(e=c(e,t))){if(e.sort&&l.isSortField(e.sort)){var n=c(e.sort,t);e=i({},e,n?{sort:n}:{})}return e}}function f(e,t){if(!o.isFieldDef(e)){if(o.hasConditionalFieldDef(e)){if(n=u(e.condition,t))return i({},e,{condition:n});e.condition;return r(e,["condition"])}return e}var n;return(n=u(e,t))?n:o.isConditionalDef(e)?{condition:e.condition}:void 0}function d(e,t){var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(a.isArray(r))n[i]=r.map(function(e){return f(e,t)}).filter(function(e){return e});else{var o=f(r,t);o&&(n[i]=o)}}return n}n.replaceRepeaterInFacet=function(e,t){return d(e,t)},n.replaceRepeaterInEncoding=function(e,t){return d(e,t)}},{"../fielddef":106,"../log":110,"../sort":117,"vega-util":10}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../channel"),o=e("../log"),a=e("../util"),i=e("./model");n.defaultScaleResolve=function(e,t){if(i.isLayerModel(t)||i.isFacetModel(t))return"shared";if(i.isConcatModel(t)||i.isRepeatModel(t))return a.contains(r.POSITION_SCALE_CHANNELS,e)?"independent":"shared";throw new Error("invalid model type for resolve")},n.parseGuideResolve=function(e,t){var n=e.scale[t],i=a.contains(r.POSITION_SCALE_CHANNELS,t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&o.warn(o.message.independentScaleMeansIndependentGuide(t)),"independent"):e[i][t]||"shared"}},{"../channel":15,"../log":110,"../util":125,"./model":69}],76:[function(e,t,n){"use strict";var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},f=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),i=e("../../util"),s=e("../../vega.schema"),r=e("../model"),d=e("../selection/selection"),p=e("./domain");function o(c){return i.keys(c.component.scales).reduce(function(e,t){var n=c.component.scales[t];if(n.merged)return e;var i=n.combine(),r=i.domainRaw,o=i.range,a=i.name,s=i.type,l=(i.domainRaw,i.range,f(i,["name","type","domainRaw","range"]));return o=g(o,a,c,t),r&&d.isRawSelectionDomain(r)&&(r=d.selectionScaleDomain(c,r)),e.push(u({name:a,type:s,domain:p.assembleDomain(c,t)},r?{domainRaw:r}:{},{range:o},l)),e},[])}function g(e,t,n,i){if("x"===i||"y"===i){if(s.isVgRangeStep(e))return{step:{signal:t+"_step"}};if(a.isArray(e)&&2===e.length){var r=e[0],o=e[1];if(0===r&&s.isVgSignalRef(o))return[0,{signal:n.getSizeName(o.signal)}];if(s.isVgSignalRef(r)&&0===o)return[{signal:n.getSizeName(r.signal)},0]}}return e}n.assembleScales=function n(e){return r.isLayerModel(e)||r.isConcatModel(e)||r.isRepeatModel(e)?e.children.reduce(function(e,t){return e.concat(n(t))},o(e)):o(e)},n.assembleScalesForModel=o,n.assembleScaleRange=g},{"../../util":125,"../../vega.schema":127,"../model":69,"../selection/selection":85,"./domain":78,"vega-util":10}],77:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(i){function e(e,t){var n=i.call(this,{},{name:e})||this;return n.merged=!1,n.domains=[],n.setWithExplicit("type",t),n}return r(e,i),e}(e("../split").Split);n.ScaleComponent=o},{"../split":95}],78:[function(e,t,n){"use strict";var l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-util"),i=e("../../aggregate"),u=e("../../bin"),f=e("../../channel"),d=e("../../data"),p=e("../../datetime"),g=e("../../log"),m=e("../../scale"),h=e("../../sort"),v=e("../../util"),y=e("../../util"),a=e("../../vega.schema"),b=e("../../vega.schema"),O=e("../common"),_=e("../data/optimize"),S=e("../model"),E=e("../selection/selection");function r(e){var u,f,d;S.isUnitModel(e)?(f=(u=e).specifiedScales,d=u.component.scales,y.keys(d).forEach(function(e){var t=f[e],n=t?t.domain:void 0,i=x(u,e),r=d[e];if(r.domains=i,m.isSelectionDomain(n)&&r.set("domainRaw",{signal:E.SELECTION_DOMAIN+v.hash(n)},!0),u.component.data.isFaceted){for(var o=u;!S.isFacetModel(o)&&o.parent;)o=o.parent;var a=o.component.resolve.scale[e];if("shared"===a)for(var s=0,l=i;s<l.length;s++){var c=l[s];b.isDataRefDomain(c)&&(c.data=_.FACET_SCALE_PREFIX+c.data.replace(_.FACET_SCALE_PREFIX,""))}}})):function(a){for(var e=0,t=a.children;e<t.length;e++){var n=t[e];r(n)}var s=a.component.scales;y.keys(s).forEach(function(e){for(var t,n=0,i=a.children;n<i.length;n++){var r=i[n],o=r.component.scales[e];o&&(t=void 0===t?o.domains:t.concat(o.domains))}s[e].domains=t})}(e)}function x(e,t){var n=e.getScaleComponent(t).get("type"),i=function(e,t,n,i){if("unaggregated"===e){var r=N(t,n),o=r.valid,a=r.reason;if(!o)return void g.warn(a)}else if(void 0===e&&i.useUnaggregatedDomain&&(o=N(t,n).valid))return"unaggregated";return e}(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=l({},e.specifiedScales[t],{domain:i})),"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?s(n,i,e,"x").concat(s(n,i,e,"x2")):s(n,i,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?s(n,i,e,"y").concat(s(n,i,e,"y2")):s(n,i,e,"y2"):s(n,i,e,t)}function s(e,t,n,i){var r=n.fieldDef(i);if(t&&"unaggregated"!==t&&!m.isSelectionDomain(t)){if(!r.bin)return p.isDateTime(t[0])?t.map(function(e){return{signal:"{data: "+p.dateTimeExpr(e,!0)+"}"}}):[t];g.warn(g.message.conflictedDomain(i))}var o=n.stack;if(o&&i===o.fieldChannel)return"normalize"===o.offset?[[0,1]]:[{data:a=n.requestDataName(d.MAIN),field:n.vgField(i,{suffix:"start"})},{data:a,field:n.vgField(i,{suffix:"end"})}];var a,s=f.isScaleChannel(i)?w(n,i,e):void 0;if("unaggregated"===t)return[{data:a=n.requestDataName(d.MAIN),field:n.vgField(i,{aggregate:"min"})},{data:a,field:n.vgField(i,{aggregate:"max"})}];if(!r.bin)return s?[{data:y.isBoolean(s)?n.requestDataName(d.MAIN):n.requestDataName(d.RAW),field:n.vgField(i),sort:s}]:[{data:n.requestDataName(d.MAIN),field:n.vgField(i)}];if(m.isBinScale(e)){var l=n.getName(u.binToString(r.bin)+"_"+r.field+"_bins");return[{signal:"sequence("+l+".start, "+l+".stop + "+l+".step, "+l+".step)"}]}return m.hasDiscreteDomain(e)?[{data:y.isBoolean(s)?n.requestDataName(d.MAIN):n.requestDataName(d.RAW),field:n.vgField(i,O.binRequiresRange(r,i)?{binSuffix:"range"}:{}),sort:!0!==s&&h.isSortField(s)?s:{field:n.vgField(i,{}),op:"min"}}]:"x"===i||"y"===i?[{data:a=n.requestDataName(d.MAIN),field:n.vgField(i,{})},{data:a,field:n.vgField(i,{binSuffix:"end"})}]:[{data:n.requestDataName(d.MAIN),field:n.vgField(i,{})}]}function w(e,t,n){if(m.hasDiscreteDomain(n)){var i=e.sort(t);return h.isSortField(i)?i:"descending"===i?{op:"min",field:e.vgField(t),order:"descending"}:!!y.contains(["ascending",void 0],i)||void 0}}function N(e,t){return e.aggregate?i.SHARED_DOMAIN_OP_INDEX[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:g.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:g.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:g.message.unaggregateDomainHasNoEffectForRawField(e)}}function T(e){var t=y.unique(e.map(function(e){if(b.isDataRefDomain(e)){e.sort;return c(e,["sort"])}return e}),y.hash),n=y.unique(e.map(function(e){if(b.isDataRefDomain(e)){var t=e.sort;return void 0===t||y.isBoolean(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),y.hash);if(1===t.length){var i=e[0];if(b.isDataRefDomain(i)&&0<n.length){var r=n[0];return 1<n.length&&(g.warn(g.message.MORE_THAN_ONE_SORT),r=!0),l({},i,{sort:r})}return i}var o=y.unique(n.map(function(e){return!0===e?e:"count"===e.op?e:(g.warn(g.message.domainSortDropped(e)),!0)}),y.hash),a=void 0;1===o.length?a=o[0]:1<o.length&&(g.warn(g.message.MORE_THAN_ONE_SORT),a=!0);var s=y.unique(e.map(function(e){return b.isDataRefDomain(e)?e.data:null}),function(e){return e});return 1===s.length&&null!==s[0]?i=l({data:s[0],fields:t.map(function(e){return e.field})},a?{sort:a}:{}):l({fields:t},a?{sort:a}:{})}n.parseScaleDomain=r,n.parseDomainForChannel=x,n.domainSort=w,n.canUseUnaggregatedDomain=N,n.mergeDomains=T,n.getFieldFromDomain=function(e){if(b.isDataRefDomain(e)&&o.isString(e.field))return e.field;if(a.isDataRefUnionedDomain(e)){for(var t=void 0,n=0,i=e.fields;n<i.length;n++){var r=i[n];if(b.isDataRefDomain(r)&&o.isString(r.field))if(t){if(t!==r.field)return g.warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),t}else t=r.field}return g.warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),t}if(a.isFieldRefUnionDomain(e))return g.warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),t=e.fields[0],o.isString(t)?t:void 0},n.assembleDomain=function(t,e){return T(t.component.scales[e].domains.map(function(e){return b.isDataRefDomain(e)&&(e.data=t.lookupDataSource(e.data)),e}))}},{"../../aggregate":12,"../../bin":14,"../../channel":15,"../../data":102,"../../datetime":103,"../../log":110,"../../scale":115,"../../sort":117,"../../util":125,"../../vega.schema":127,"../common":24,"../data/optimize":40,"../model":69,"../selection/selection":85,"vega-util":10}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../channel"),d=e("../../fielddef"),p=e("../../mark"),o=e("../../scale"),g=e("../../type"),a=e("../../util"),i=e("../model"),m=e("../resolve"),h=e("../split"),v=e("./component"),r=e("./domain"),s=e("./properties"),l=e("./range"),y=e("./type");function b(e){var s,l,c,u;i.isUnitModel(e)?e.component.scales=(l=(s=e).encoding,c=s.config,u=s.mark(),f.SCALE_CHANNELS.reduce(function(e,t){var n,i=void 0,r=l[t];if(d.isFieldDef(r)&&u===p.GEOSHAPE&&t===f.SHAPE&&r.type===g.GEOJSON)return e;if(d.isFieldDef(r)?i=(n=r).scale:d.hasConditionalFieldDef(r)?(n=r.condition,i=r.condition.scale):t===f.X?n=d.getFieldDef(l.x2):t===f.Y&&(n=d.getFieldDef(l.y2)),n&&null!==i&&!1!==i){var o=(i=i||{}).type,a=y.scaleType(i.type,t,n,u,c.scale);e[t]=new v.ScaleComponent(s.scaleName(t+"",!0),{value:a,explicit:o===a})}return e},{})):e.component.scales=function(s){for(var l=s.component.scales={},c={},r=s.component.resolve,e=function(i){b(i),a.keys(i.component.scales).forEach(function(e){if(r.scale[e]=r.scale[e]||m.defaultScaleResolve(e,s),"shared"===r.scale[e]){var t=c[e],n=i.component.scales[e].getWithExplicit("type");t?o.scaleCompatible(t.value,n.value)?c[e]=h.mergeValuesWithExplicit(t,n,"type","scale",O):(r.scale[e]="independent",delete c[e]):c[e]=n}})},t=0,n=s.children;t<n.length;t++){var i=n[t];e(i)}return a.keys(c).forEach(function(e){var t=s.scaleName(e,!0),n=c[e];l[e]=new v.ScaleComponent(t,n);for(var i=0,r=s.children;i<r.length;i++){var o=r[i],a=o.component.scales[e];a&&(o.renameScale(a.get("name"),t),a.merged=!0)}}),l}(e)}n.parseScale=function(e){b(e),r.parseScaleDomain(e);for(var t=0,n=o.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;t<n.length;t++){var i=n[t];s.parseScaleProperty(e,i)}l.parseScaleRange(e)},n.parseScaleCore=b;var O=h.tieBreakByComparing(function(e,t){return o.scaleTypePrecedence(e)-o.scaleTypePrecedence(t)})},{"../../channel":15,"../../fielddef":106,"../../mark":112,"../../scale":115,"../../type":124,"../../util":125,"../model":69,"../resolve":75,"../split":95,"./component":77,"./domain":78,"./properties":80,"./range":81,"./type":82}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),m=e("../../log"),h=e("../../scale"),i=e("../../util"),c=e("../../util"),r=e("../model"),u=e("../split"),o=e("./range");function f(e,t){var d,p,g;r.isUnitModel(e)?(p=t,g=(d=e).component.scales,i.keys(g).forEach(function(e){var t=d.specifiedScales[e],n=g[e],i=d.getScaleComponent(e),r=d.fieldDef(e),o=d.sort(e),a=d.config,s=t[p],l=i.get("type"),c=h.scaleTypeSupportProperty(l,p),u=h.channelScalePropertyIncompatability(e,p);if(void 0!==s&&(c?u&&m.warn(u):m.warn(m.message.scalePropertyNotWorkWithScaleType(l,p,e))),c&&void 0===u)if(void 0!==s)n.copyKeyFromObject(p,t);else{var f=v(p,e,r,o,i.get("type"),i.get("padding"),i.get("paddingInner"),t.domain,d.markDef,a);void 0!==f&&n.set(p,f,!1)}})):a(e,t)}function v(e,t,n,i,r,o,a,s,l,c){var u=c.scale;switch(e){case"nice":return d(r,t,n);case"padding":return p(t,r,u,n,l,c.bar);case"paddingInner":return g(o,t,u);case"paddingOuter":return y(o,t,r,a,u);case"reverse":return b(r,i);case"zero":return O(t,n,s)}return u[e]}function a(a,s){for(var l=a.component.scales,e=0,t=a.children;e<t.length;e++){var n=t[e];"range"===s?o.parseScaleRange(n):f(n,s)}i.keys(l).forEach(function(e){for(var t,n=0,i=a.children;n<i.length;n++){var r=i[n].component.scales[e];if(r){var o=r.getWithExplicit(s);t=u.mergeValuesWithExplicit(t,o,s,"scale",u.tieBreakByComparing(function(e,t){switch(s){case"range":return e.step&&t.step?e.step-t.step:0}return 0}))}}l[e].setWithExplicit(s,t)})}function d(e,t,n){if(!n.bin&&!c.contains([h.ScaleType.TIME,h.ScaleType.UTC],e))return c.contains([l.X,l.Y],t)}function p(e,t,n,i,r,o){if(c.contains([l.X,l.Y],e)){if(h.isContinuousToContinuous(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var a=r.type,s=r.orient;if("bar"===a&&!i.bin&&("vertical"===s&&"x"===e||"horizontal"===s&&"y"===e))return o.continuousBandSize}if(t===h.ScaleType.POINT)return n.pointPadding}}function g(e,t,n){if(void 0===e)return c.contains([l.X,l.Y],t)?n.bandPaddingInner:void 0}function y(e,t,n,i,r){if(void 0===e)return c.contains([l.X,l.Y],t)&&n===h.ScaleType.BAND?void 0!==r.bandPaddingOuter?r.bandPaddingOuter:i/2:void 0}function b(e,t){if(h.hasContinuousDomain(e)&&"descending"===t)return!0}function O(e,t,n){return"size"===e&&"quantitative"===t.type||!(!!n&&"unaggregated"!==n||t.bin||!c.contains([l.X,l.Y],e))}n.parseScaleProperty=f,n.getDefaultValue=v,n.parseNonUnitScaleProperty=a,n.nice=d,n.padding=p,n.paddingInner=g,n.paddingOuter=y,n.reverse=b,n.zero=O},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"../model":69,"../split":95,"./range":81}],81:[function(e,t,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var p=e("vega-util"),c=e("../../channel"),y=e("../../log"),b=e("../../scale"),u=e("../../scale"),g=e("../../util"),m=e("../../vega.schema"),n=e("../model"),O=e("../split"),i=e("./properties");function h(e,t,n,i,r,o,a,s,l,c){for(var u=s||null===i.rangeStep,f=0,d=v.RANGE_PROPERTIES;f<d.length;f++){var p=d[f];if(void 0!==i[p]){var g=b.scaleTypeSupportProperty(t,p),m=b.channelScalePropertyIncompatability(e,p);if(g)if(m)y.warn(m);else switch(p){case"range":return O.makeExplicit(i[p]);case"scheme":return O.makeExplicit(_(i[p]));case"rangeStep":var h=i[p];if(null!==h){if(!s)return O.makeExplicit({step:h});y.warn(y.message.rangeStepDropped(e))}}else y.warn(y.message.scalePropertyNotWorkWithScaleType(t,p,e))}}return O.makeImplicit(S(e,t,n,r,o,a,l,c,u))}function _(e){if(b.isExtendedScheme(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function S(e,t,n,i,r,o,a,s,l){switch(e){case c.X:case c.Y:if(g.contains(["point","band"],t)&&!l)if(e===c.X&&"text"===o){if(i.scale.textXRangeStep)return{step:i.scale.textXRangeStep}}else if(i.scale.rangeStep)return{step:i.scale.rangeStep};return e===c.Y&&u.hasContinuousDomain(t)?[{signal:a},0]:[0,{signal:a}];case c.SIZE:return[function(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(y.message.incompatibleChannel("size",e))}(o,r,i),function(e,t,n){var i=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:f(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var r=f(t,i);return(r-2)*(r-2)}throw new Error(y.message.incompatibleChannel("size",e))}(o,s,i)];case c.SHAPE:return"symbol";case c.COLOR:case c.FILL:case c.STROKE:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===o||"geoshape"===o?"heatmap":"ramp";case c.OPACITY:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function f(e,t){return 0<e.length?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}v.RANGE_PROPERTIES=["range","rangeStep","scheme"],v.parseScaleRange=function(e){var f,d;n.isUnitModel(e)?(d=(f=e).component.scales,c.SCALE_CHANNELS.forEach(function(e){var t=d[e];if(t){var n=f.getScaleComponent(e),i=f.specifiedScales[e],r=f.fieldDef(e),o="x"===e?"width":"y"===e?"height":void 0,a=o?!!f.component.layoutSize.get(o):void 0,s=n.get("type"),l=g.contains(["point","band"],s)||!!i.rangeStep;o&&f.fit&&!a&&l&&(y.warn(y.message.CANNOT_FIX_RANGE_STEP_WITH_FIT),a=!0);var c=function(e){var t=[],n=e.getScaleComponent("x"),i=n&&n.get("range");i&&m.isVgRangeStep(i)&&p.isNumber(i.step)&&t.push(i.step);var r=e.getScaleComponent("y"),o=r&&r.get("range");return o&&m.isVgRangeStep(o)&&p.isNumber(o.step)&&t.push(o.step),t}(f),u=h(e,s,r.type,i,f.config,t.get("zero"),f.mark(),a,f.getName(o),c);t.setWithExplicit("range",u)}})):i.parseNonUnitScaleProperty(e,"range")},v.parseRangeForChannel=h,v.defaultRange=S},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"../../vega.schema":127,"../model":69,"../split":95,"./properties":80,"vega-util":10}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),s=e("../../log"),l=e("../../scale"),i=e("../../scale"),r=e("../../type"),c=e("../../util"),o=e("../../util");function u(e,t){var n=t.type;return o.contains([r.Type.ORDINAL,r.Type.NOMINAL],n)?void 0===e||i.hasDiscreteDomain(e):n===r.Type.TEMPORAL?o.contains([l.ScaleType.TIME,l.ScaleType.UTC,l.ScaleType.SEQUENTIAL,void 0],e):n!==r.Type.QUANTITATIVE||(t.bin?o.contains([l.ScaleType.BIN_LINEAR,l.ScaleType.BIN_ORDINAL,l.ScaleType.LINEAR],e):o.contains([l.ScaleType.LOG,l.ScaleType.POW,l.ScaleType.SQRT,l.ScaleType.QUANTILE,l.ScaleType.QUANTIZE,l.ScaleType.LINEAR,l.ScaleType.SEQUENTIAL,void 0],e))}n.scaleType=function(e,t,n,i,r){var o=function(e,t,n,i){switch(t.type){case"nominal":case"ordinal":if(a.isColorChannel(e)||"discrete"===a.rangeType(e))return"shape"===e&&"ordinal"===t.type&&s.warn(s.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(c.contains(["x","y"],e)){if(c.contains(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return a.isColorChannel(e)?"sequential":"discrete"===a.rangeType(e)?(s.warn(s.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return a.isColorChannel(e)?t.bin?"bin-ordinal":"sequential":"discrete"===a.rangeType(e)?(s.warn(s.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"latitude":case"longitude":case"geojson":return}throw new Error(s.message.invalidFieldType(t.type))}(t,n,i);return a.isScaleChannel(t)?void 0!==e?l.channelSupportScaleType(t,e)?u(e,n)?e:(s.warn(s.message.scaleTypeNotWorkWithFieldDef(e,o)),o):(s.warn(s.message.scaleTypeNotWorkWithChannel(t,e,o)),o):o:null},n.fieldDefMatchScaleType=u},{"../../channel":15,"../../log":110,"../../scale":115,"../../type":124,"../../util":125}],83:[function(e,t,T){"use strict";var v=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},y=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(T,"__esModule",{value:!0});var P=e("vega-util"),D=e("../../channel"),k=e("../../log"),j=e("../../scale"),b=e("../../util"),A=e("./selection"),C=e("./transforms/scales");T.BRUSH="_brush",T.SCALE_TRIGGER="_scale_trigger";var n={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(_,S){var e=S.name,t=C.default.has(S),E=[],x=[],w=[],N=[];if(S.translate&&!t){var i="!event.item || event.item.mark.name !== "+P.stringValue(e+T.BRUSH);M(S,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(i)<0&&n.push(i)})}return S.project.forEach(function(e){var t=e.channel;if(t===D.X||t===D.Y){var n,i,r,o,a,s,l,c,u,f,d,p,g,m=(n=_,i=S,r=t,o=A.channelSignalName(i,r,"visual"),a=A.channelSignalName(i,r,"data"),s=C.default.has(i),l=n.scaleName(r),c=P.stringValue(l),u=n.getScaleComponent(r),f=u?u.get("type"):void 0,d=n.getSizeSignalRef(r===D.X?"width":"height").signal,p=r+"(unit)",(g=M(i,function(e,t){return e.concat({events:t.between[0],update:"["+p+", "+p+"]"},{events:t,update:"["+o+"[0], clamp("+p+", 0, "+d+")]"})})).push({events:{signal:i.name+T.SCALE_TRIGGER},update:j.hasContinuousDomain(f)&&!j.isBinScale(f)?"[scale("+c+", "+a+"[0]), scale("+c+", "+a+"[1])]":"[0, 0]"}),s?[{name:a,on:[]}]:[{name:o,value:[],on:g},{name:a,on:[{events:{signal:o},update:o+"[0] === "+o+"[1] ? null : invert("+c+", "+o+")"}]}]),h=A.channelSignalName(S,t,"data"),v=A.channelSignalName(S,t,"visual"),y=P.stringValue(_.scaleName(t)),b=_.getScaleComponent(t).get("type"),O=j.hasContinuousDomain(b)?"+":"";E.push.apply(E,m),w.push(h),x.push("{encoding: "+P.stringValue(t)+", field: "+P.stringValue(e.field)+", extent: "+h+"}"),N.push({scaleName:_.scaleName(t),expr:"(!isArray("+h+") || ("+O+"invert("+y+", "+v+")[0] === "+O+h+"[0] && "+O+"invert("+y+", "+v+")[1] === "+O+h+"[1]))"})}else k.warn("Interval selections only support x and y encoding channels.")}),t||E.push({name:e+T.SCALE_TRIGGER,update:N.map(function(e){return e.expr}).join(" && ")+" ? "+(e+T.SCALE_TRIGGER)+" : {}"}),E.concat({name:e+A.TUPLE,on:[{events:w.map(function(e){return{signal:e}}),update:w.join(" && ")+" ? {unit: "+A.unitName(_)+", intervals: ["+x.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+A.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+A.unitName(e)+"}")},marks:function(e,t,n){var i=t.name,r=A.positionalProjections(t),o=r.xi,a=r.yi,s="data("+P.stringValue(t.name+A.STORE)+")";if(C.default.has(t))return n;var l={x:null!==o?{signal:i+"_x[0]"}:{value:0},y:null!==a?{signal:i+"_y[0]"}:{value:0},x2:null!==o?{signal:i+"_x[1]"}:{field:{group:"width"}},y2:null!==a?{signal:i+"_y[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(var c=0,u=b.keys(l);c<u.length;c++){var f=u[c];l[f]=[v({test:s+".length && "+s+"[0].unit === "+A.unitName(e)},l[f]),{value:0}]}var d=t.mark,p=d.fill,g=d.fillOpacity,m=y(d,["fill","fillOpacity"]),h=b.keys(m).reduce(function(e,t){return e[t]={value:m[t]},e},{});return[{name:i+T.BRUSH+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:p},fillOpacity:{value:g}},update:l}}].concat(n,{name:i+T.BRUSH,type:"rect",clip:!0,encode:{enter:v({fill:{value:"transparent"}},h),update:l}})}};function M(e,n){return e.events.reduce(function(e,t){return t.between?n(e,t):(k.warn(t+" is not an ordered event stream for interval selections"),e)},[])}T.default=n},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"./selection":85,"./transforms/scales":90,"vega-util":10}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),c=e("../../util"),u=e("./selection"),f=e("./transforms/nearest"),i={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:function(i,e){var t=e.project,r=f.default.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum",o=[],n=t.map(function(e){return l.stringValue(e.channel)}).filter(function(e){return e}).join(", "),a=t.map(function(e){return l.stringValue(e.field)}).join(", "),s=t.map(function(e){var t=e.channel,n=i.fieldDef(t);return n&&n.bin?(o.push(e.field),"["+r+c.accessPath(i.vgField(t,{}))+", "+r+c.accessPath(i.vgField(t,{binSuffix:"end"}))+"]"):""+r+c.accessPath(e.field)}).join(", ");return[{name:e.name+u.TUPLE,value:{},on:[{events:e.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+u.unitName(i)+", encodings: ["+n+"], fields: ["+a+"], values: ["+s+"]"+(o.length?", "+o.map(function(e){return l.stringValue("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:!0}]}]},modifyExpr:function(e,t){return t.name+u.TUPLE+", "+("global"===t.resolve?"null":"{unit: "+u.unitName(e)+"}")}};n.default=i},{"../../util":125,"./selection":85,"./transforms/nearest":88,"vega-util":10}],85:[function(e,t,c){"use strict";var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(c,"__esModule",{value:!0});var f=e("vega-event-selector"),d=e("vega-util"),a=e("../../channel"),o=e("../../log"),n=e("../../selection"),p=e("../../util"),i=e("../model"),r=e("./interval"),s=e("./multi"),l=e("./single"),g=e("./transforms/transforms");function m(n,i){return h(n,function(t,e){i=e.marks?e.marks(n,t,i):i,g.forEachTransform(t,function(e){e.marks&&(i=e.marks(n,t,i))})}),i}function h(e,t){var n=e.component.selection;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];t(r,v(r.type))}}function v(e){switch(e){case"single":return l.default;case"multi":return s.default;case"interval":return r.default}return null}function y(e){for(var t=e.parent;t&&!i.isFacetModel(t);)t=t.parent;return t}c.STORE="_store",c.TUPLE="_tuple",c.MODIFY="_modify",c.SELECTION_DOMAIN="_selection_domain_",c.parseUnitSelection=function(o,a){var s={},l=o.config.selection,e=function(e){if(!a.hasOwnProperty(e))return"continue";var t=a[e],n=l[t.type];for(var i in n)"encodings"===i&&t.fields||"fields"===i&&t.encodings||("mark"===i&&(t[i]=u({},n[i],t[i])),void 0!==t[i]&&!0!==t[i]||(t[i]=n[i]||t[i]));e=p.varName(e);var r=s[e]=u({},t,{name:e,events:d.isString(t.on)?f.selector(t.on,"scope"):t.on});g.forEachTransform(r,function(e){e.parse&&e.parse(o,t,r)})};for(var t in a)e(t);return s},c.assembleUnitSelectionSignals=function(r,o){h(r,function(t,e){var n=t.name,i=e.modifyExpr(r,t);o.push.apply(o,e.signals(r,t)),g.forEachTransform(t,function(e){e.signals&&(o=e.signals(r,t,o)),e.modifyExpr&&(i=e.modifyExpr(r,t,i))}),o.push({name:n+c.MODIFY,on:[{events:{signal:n+c.TUPLE},update:"modify("+d.stringValue(t.name+c.STORE)+", "+i+")"}]})});var e=y(r);if(o.length&&e){var t=d.stringValue(e.getName("cell"));o.unshift({name:"facet",value:{},on:[{events:f.selector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+t+").datum"}]})}return o},c.assembleTopLevelSignals=function(n,i){var r=!1;return h(n,function(t,e){e.topLevelSignals&&(i=e.topLevelSignals(n,t,i)),g.forEachTransform(t,function(e){e.topLevelSignals&&(i=e.topLevelSignals(n,t,i))}),r=!0}),r&&(i.filter(function(e){return"unit"===e.name}).length||i.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),i},c.assembleUnitSelectionData=function(e,n){return h(e,function(t){n.filter(function(e){return e.name===t.name+c.STORE}).length||n.push({name:t.name+c.STORE})}),n},c.assembleUnitSelectionMarks=m,c.assembleLayerSelectionMarks=function(e,t){return e.children.forEach(function(e){i.isUnitModel(e)&&(t=m(e,t))}),t},c.selectionPredicate=function(a,e,s){var l=[],t=p.logicalExpr(e,function(e){var t=p.varName(e),n=a.getSelectionComponent(t,e),i=d.stringValue(t+c.STORE);if(n.timeUnit){var r=s||a.component.data.raw,o=n.timeUnit.clone();r.parent?o.insertAsParentOf(r):r.parent=o}return"none"!==n.empty&&l.push(i),v(n.type).predicate+"("+i+", datum"+("global"===n.resolve?")":", "+d.stringValue(n.resolve)+")")});return(l.length?"!("+l.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+"("+t+")"},c.isRawSelectionDomain=function(e){return 0<=e.signal.indexOf(c.SELECTION_DOMAIN)},c.selectionScaleDomain=function(e,t){var n=JSON.parse(t.signal.replace(c.SELECTION_DOMAIN,"")),i=p.varName(n.selection),r=e.component.selection&&e.component.selection[i];return r?(o.warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.'),{signal:"null"}):(r=e.getSelectionComponent(i,n.selection),n.encoding||n.field||(n.field=r.project[0].field,1<r.project.length&&o.warn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+d.stringValue(n.field)+".")),{signal:v(r.type).scaleDomain+"("+d.stringValue(i+c.STORE)+", "+d.stringValue(n.encoding||null)+", "+d.stringValue(n.field||null)+("global"===r.resolve?")":", "+d.stringValue(r.resolve)+")")})},c.unitName=function(e){var t=d.stringValue(e.name),n=y(e);return n&&(t+=(n.facet.row?" + '_' + facet"+p.accessPath(n.vgField("row")):"")+(n.facet.column?" + '_' + facet"+p.accessPath(n.vgField("column")):"")),t},c.requiresSelectionId=function(e){var t=!1;return h(e,function(e){t=t||e.project.some(function(e){return e.field===n.SELECTION_ID})}),t},c.channelSignalName=function(e,t,n){return p.varName(e.name+"_"+("visual"===n?t:e.fields[t]))},c.positionalProjections=function(e){var n=null,i=null,r=null,o=null;return e.project.forEach(function(e,t){e.channel===a.X?(n=e,i=t):e.channel===a.Y&&(r=e,o=t)}),{x:n,xi:i,y:r,yi:o}}},{"../../channel":15,"../../log":110,"../../selection":116,"../../util":125,"../model":69,"./interval":83,"./multi":84,"./single":86,"./transforms/transforms":92,"vega-event-selector":9,"vega-util":10}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),i=e("./multi"),s=e("./selection"),r={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:i.default.signals,topLevelSignals:function(e,t,n){var i=n.filter(function(e){return e.name===t.name}),r="data("+a.stringValue(t.name+s.STORE)+")",o=r+"[0].values";return i.length?n:n.concat({name:t.name,update:r+".length && {"+t.project.map(function(e,t){return e.field+": "+o+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+s.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+s.unitName(e)+"}")}};n.default=r},{"./multi":84,"./selection":85,"vega-util":10}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),c=e("../../../util"),u=e("../selection"),s=e("./nearest"),i={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,n,i){var r=n.name,t=n.project,o=n.bind,a=s.default.has(n)?"(item().isVoronoi ? datum.datum : datum)":"datum";return t.forEach(function(e){var t=c.varName(r+"_"+e.field);i.filter(function(e){return e.name===t}).length||i.unshift({name:t,value:"",on:[{events:n.events,update:"datum && item().mark.marktype !== 'group' ? "+a+c.accessPath(e.field)+" : null"}],bind:o[e.field]||o[e.channel]||o})}),i},signals:function(e,t,n){var i=t.name,r=t.project,o=n.filter(function(e){return e.name===i+u.TUPLE})[0],a=r.map(function(e){return l.stringValue(e.field)}).join(", "),s=r.map(function(e){return c.varName(i+"_"+e.field)});return o.update=s.join(" && ")+" ? {fields: ["+a+"], values: ["+s.join(", ")+"]} : null",delete o.value,delete o.on,n}};n.default=i},{"../../../util":125,"../selection":85,"./nearest":88,"vega-util":10}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../../log"),f=e("../selection"),i={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(i,e,t){var n=f.positionalProjections(e),r=n.x,o=n.y,a=i.mark();if("line"===a||"area"===a)return u.warn(u.message.nearestNotSupportForContinuous(a)),t;var s={name:i.getName("voronoi"),type:"path",from:{data:i.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:r||!r&&!o?"datum.x":{expr:"0"},y:o||!r&&!o?"datum.y":{expr:"0"},size:[i.getSizeSignalRef("width"),i.getSizeSignalRef("height")]}]},l=0,c=!1;return t.forEach(function(e,t){var n=e.name||"";n===i.component.mark[0].name?l=t:0<=n.indexOf("voronoi")&&(c=!0)}),c||t.splice(l+1,0,s),t}};n.default=i},{"../../../log":110,"../selection":85}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../../log"),c=e("../../../util"),u=e("../../data/timeunit"),i={has:function(e){var t=e;return void 0!==t.fields||void 0!==t.encodings},parse:function(i,e,t){var r={},o={};(e.fields||[]).forEach(function(e){return r[e]=null}),(e.encodings||[]).forEach(function(e){var t=i.fieldDef(e);if(t)if(t.timeUnit){var n=i.vgField(e);r[n]=e,o[n]={as:n,field:t.field,timeUnit:t.timeUnit}}else r[t.field]=e;else l.warn(l.message.cannotProjectOnChannelWithoutField(e))});var n=t.project||(t.project=[]);for(var a in r)r.hasOwnProperty(a)&&n.push({field:a,channel:r[a]});var s=t.fields||(t.fields={});n.filter(function(e){return e.channel}).forEach(function(e){return s[e.channel]=e.field}),c.keys(o).length&&(t.timeUnit=new u.TimeUnitNode(null,o))}};n.default=i},{"../../../log":110,"../../../util":125,"../../data/timeunit":45}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),s=e("../../../log"),l=e("../../../scale"),c=e("../selection"),r={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(r,e,o){var a=o.scales=[];o.project.forEach(function(e){var t=e.channel,n=r.getScaleComponent(t),i=n?n.get("type"):void 0;n&&l.hasContinuousDomain(i)&&!l.isBinScale(i)?(n.set("domainRaw",{signal:c.channelSignalName(o,t,"data")},!0),a.push(t)):s.warn(s.message.SCALE_BINDINGS_CONTINUOUS)})},topLevelSignals:function(e,n,i){if(!e.parent)return i;var t=n.scales.filter(function(t){return!i.filter(function(e){return e.name===c.channelSignalName(n,t,"data")}).length});return i.concat(t.map(function(e){return{name:c.channelSignalName(n,e,"data")}}))},signals:function(e,n,i){return e.parent&&n.scales.forEach(function(t){var e=i.filter(function(e){return e.name===c.channelSignalName(n,t,"data")})[0];e.push="outer",delete e.value,delete e.update}),i}};n.default=r,n.domain=function(e,t){return"domain("+i.stringValue(e.scaleName(t))+")"}},{"../../../log":110,"../../../scale":115,"../selection":85,"vega-util":10}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("../selection"),i={has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var i=t.name+o.TUPLE,r=t.name+"_toggle";return r+" ? null : "+i+", "+("global"===t.resolve?r+" ? null : true, ":r+" ? null : {unit: "+o.unitName(e)+"}, ")+r+" ? "+i+" : null"}};n.default=i},{"../selection":85}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./inputs"),r=e("./nearest"),o=e("./project"),a=e("./scales"),s=e("./toggle"),l=e("./translate"),c=e("./zoom"),u={project:o.default,toggle:s.default,scales:a.default,translate:l.default,zoom:c.default,inputs:i.default,nearest:r.default};n.forEachTransform=function(e,t){for(var n in u)u[n].has(e)&&t(u[n])}},{"./inputs":87,"./nearest":88,"./project":89,"./scales":90,"./toggle":91,"./translate":93,"./zoom":94}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-event-selector"),h=e("../../../channel"),f=e("../interval"),v=e("../selection"),y=e("./scales"),b="_translate_anchor",O="_translate_delta",i={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var i=t.name,r=y.default.has(t),o=i+b,a=v.positionalProjections(t),s=a.x,l=a.y,c=u.selector(t.translate,"scope");return r||(c=c.map(function(e){return e.between[0].markname=i+f.BRUSH,e})),n.push({name:o,value:{},on:[{events:c.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==s?", extent_x: "+(r?y.domain(e,h.X):"slice("+v.channelSignalName(t,"x","visual")+")"):"")+(null!==l?", extent_y: "+(r?y.domain(e,h.Y):"slice("+v.channelSignalName(t,"y","visual")+")"):"")+"}"}]},{name:i+O,value:{},on:[{events:c,update:"{x: "+o+".x - x(unit), y: "+o+".y - y(unit)}"}]}),null!==s&&d(e,t,h.X,"width",n),null!==l&&d(e,t,h.Y,"height",n),n}};function d(e,t,n,i,r){var o=t.name,a=y.default.has(t),s=r.filter(function(e){return e.name===v.channelSignalName(t,n,a?"data":"visual")})[0],l=o+b,c=o+O,u=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(n),d=f.get("type"),p=a&&n===h.X?"-":"",g=l+".extent_"+n,m=(a?"log"===d?"panLog":"pow"===d?"panPow":"panLinear":"panLinear")+"("+g+", "+(""+p+c+"."+n+" / "+(a?""+u:"span("+g+")"))+(a&&"pow"===d?", "+(f.get("exponent")||1):"")+")";s.on.push({events:{signal:c},update:a?m:"clampRange("+m+", 0, "+u+")"})}n.default=i},{"../../../channel":15,"../interval":83,"../selection":85,"./scales":90,"vega-event-selector":9}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var d=e("vega-event-selector"),p=e("vega-util"),g=e("../../../channel"),m=e("../interval"),h=e("../selection"),v=e("./scales"),y="_zoom_anchor",b="_zoom_delta",i={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var i=t.name,r=v.default.has(t),o=i+b,a=h.positionalProjections(t),s=a.x,l=a.y,c=p.stringValue(e.scaleName(g.X)),u=p.stringValue(e.scaleName(g.Y)),f=d.selector(t.zoom,"scope");return r||(f=f.map(function(e){return e.markname=i+m.BRUSH,e})),n.push({name:i+y,on:[{events:f,update:r?"{"+[c?"x: invert("+c+", x(unit))":"",u?"y: invert("+u+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:f,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==s&&O(e,t,"x","width",n),null!==l&&O(e,t,"y","height",n),n}};function O(e,t,n,i,r){var o=t.name,a=v.default.has(t),s=r.filter(function(e){return e.name===h.channelSignalName(t,n,a?"data":"visual")})[0],l=e.getSizeSignalRef(i).signal,c=e.getScaleComponent(n),u=c.get("type"),f=a?v.domain(e,n):s.name,d=o+b,p=(a?"log"===u?"zoomLog":"pow"===u?"zoomPow":"zoomLinear":"zoomLinear")+"("+f+", "+(""+o+y+"."+n)+", "+d+(a&&"pow"===u?", "+(c.get("exponent")||1):"")+")";s.on.push({events:{signal:d},update:a?p:"clampRange("+p+", 0, "+l+")"})}n.default=i},{"../../../channel":15,"../interval":83,"../selection":85,"./scales":90,"vega-event-selector":9,"vega-util":10}],95:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("../log"),o=e("../util"),a=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(o.duplicate(this.explicit),o.duplicate(this.implicit))},e.prototype.combine=function(){return i({},this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e}();function s(e,t,n,i){return e.explicit&&t.explicit&&r.warn(r.message.mergeConflictingProperty(n,i,e.value,t.value)),e}n.Split=a,n.makeExplicit=function(e){return{explicit:!0,value:e}},n.makeImplicit=function(e){return{explicit:!1,value:e}},n.tieBreakByComparing=function(o){return function(e,t,n,i){var r=o(e.value,t.value);return 0<r?e:r<0?t:s(e,t,n,i)}},n.defaultTieBreaker=s,n.mergeValuesWithExplicit=function(e,t,n,i,r){return void 0===r&&(r=s),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:o.stringify(e.value)===o.stringify(t.value)?e:r(e,t,n,i)}},{"../log":110,"../util":125}],96:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../channel"),o=e("../encoding"),d=e("../encoding"),s=e("../fielddef"),p=e("../mark"),g=e("../stack"),l=e("../util"),c=e("./axis/parse"),m=e("./data/parse"),h=e("./layoutsize/assemble"),v=e("./layoutsize/parse"),y=e("./mark/init"),b=e("./mark/mark"),O=e("./model"),_=e("./repeater"),S=e("./selection/selection"),u=function(u){function e(e,t,n,i,r,o,a){void 0===i&&(i={});var s=u.call(this,e,t,n,o,void 0)||this;s.fit=a,s.type="unit",s.specifiedScales={},s.specifiedAxes={},s.specifiedLegends={},s.specifiedProjection={},s.selection={},s.children=[],s.initSize(f({},i,e.width?{width:e.width}:{},e.height?{height:e.height}:{}));var l=p.isMarkDef(e.mark)?e.mark.type:e.mark,c=s.encoding=d.normalizeEncoding(_.replaceRepeaterInEncoding(e.encoding||{},r),l);return s.markDef=y.normalizeMarkDef(e.mark,c,o),s.stack=g.stack(l,c,s.config.stack),s.specifiedScales=s.initScales(l,c),s.specifiedAxes=s.initAxes(c),s.specifiedLegends=s.initLegend(c),s.specifiedProjection=e.projection,s.selection=e.selection,s}return r(e,u),e.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},e.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},e.prototype.axis=function(e){return this.specifiedAxes[e]},e.prototype.legend=function(e){return this.specifiedLegends[e]},e.prototype.initScales=function(e,o){return a.SCALE_CHANNELS.reduce(function(e,t){var n,i,r=o[t];return s.isFieldDef(r)?i=(n=r).scale:s.hasConditionalFieldDef(r)?(n=r.condition,i=r.condition.scale):"x"===t?n=s.getFieldDef(o.x2):"y"===t&&(n=s.getFieldDef(o.y2)),n&&(e[t]=i||{}),e},{})},e.prototype.initAxes=function(r){return[a.X,a.Y].reduce(function(e,t){var n=r[t];if(s.isFieldDef(n)||t===a.X&&s.isFieldDef(r.x2)||t===a.Y&&s.isFieldDef(r.y2)){var i=s.isFieldDef(n)?n.axis:null;null!==i&&!1!==i&&(e[t]=f({},i))}return e},{})},e.prototype.initLegend=function(r){return a.NONPOSITION_SCALE_CHANNELS.reduce(function(e,t){var n=r[t];if(n){var i=s.isFieldDef(n)?n.legend:s.hasConditionalFieldDef(n)?n.condition.legend:null;null!==i&&!1!==i&&(e[t]=f({},i))}return e},{})},e.prototype.parseData=function(){this.component.data=m.parseData(this)},e.prototype.parseLayoutSize=function(){v.parseUnitLayoutSize(this)},e.prototype.parseSelection=function(){this.component.selection=S.parseUnitSelection(this,this.selection)},e.prototype.parseMarkGroup=function(){this.component.mark=b.parseMarkGroup(this)},e.prototype.parseAxisAndHeader=function(){this.component.axes=c.parseUnitAxis(this)},e.prototype.assembleSelectionTopLevelSignals=function(e){return S.assembleTopLevelSignals(this,e)},e.prototype.assembleSelectionSignals=function(){return S.assembleUnitSelectionSignals(this,[])},e.prototype.assembleSelectionData=function(e){return S.assembleUnitSelectionData(this,e)},e.prototype.assembleLayout=function(){return null},e.prototype.assembleLayoutSignals=function(){return h.assembleLayoutSignals(this)},e.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&O.isLayerModel(this.parent)||(e=S.assembleUnitSelectionMarks(this,e)),e.map(this.correctDataNames)},e.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.getMapping=function(){return this.encoding},e.prototype.toSpec=function(e,t){var n,i=l.duplicate(this.encoding);return n={mark:this.markDef,encoding:i},e||(n.config=l.duplicate(this.config)),t||(n.data=l.duplicate(this.data)),n},e.prototype.mark=function(){return this.markDef.type},e.prototype.channelHasField=function(e){return o.channelHasField(this.encoding,e)},e.prototype.fieldDef=function(e){var t=this.encoding[e];return s.getFieldDef(t)},e}(O.ModelWithField);n.UnitModel=u},{"../channel":15,"../encoding":104,"../fielddef":106,"../mark":112,"../stack":119,"../util":125,"./axis/parse":20,"./data/parse":42,"./layoutsize/assemble":49,"./layoutsize/parse":50,"./mark/init":59,"./mark/mark":61,"./model":69,"./repeater":74,"./selection/selection":85}],97:[function(e,t,b){"use strict";var O=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},_=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(b,"__esModule",{value:!0});var S=e("vega-util"),n=e("../encoding"),E=e("./../encoding"),x=e("./../fielddef"),w=e("./../log"),N=e("./common");function T(e){return!!e.type}b.BOXPLOT="box-plot",b.isBoxPlotDef=T,b.BOXPLOT_STYLES=["boxWhisker","box","boxMid"],b.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size","color","extent"],boxWhisker:["color"],boxMid:["color"]};var i=["x","y","color","detail","opacity","size"];function P(e){return O({},e,{encoding:n.reduce(e.encoding,function(e,t,n){return-1<i.indexOf(n)?e[n]=t:w.warn(w.message.incompatibleChannel(n,b.BOXPLOT)),e},{})})}b.filterUnsupportedChannels=P,b.normalizeBoxPlot=function(e,t){var n=(e=P(e)).mark,i=(e.encoding,e.selection),r=(e.projection,_(e,["mark","encoding","selection","projection"])),o=void 0;S.isNumber(t.box.extent)&&(o=t.box.extent),T(n)&&n.extent&&"min-max"===n.extent&&(o=void 0);var a,s,l,c,u=function(e,t,n){var i=function(e,t){e.mark;var n,i,r=e.encoding;if(e.projection,_(e,["mark","encoding","projection"]),"vertical"===t?(i="y",n=r.y):(i="x",n=r.x),n&&n.aggregate){var o=n.aggregate,a=_(n,["aggregate"]);o!==b.BOXPLOT&&w.warn("Continuous axis should not have customized aggregation function "+o),n=a}return{continuousAxisChannelDef:n,continuousAxis:i}}(e,t),r=i.continuousAxisChannelDef,a=i.continuousAxis,s=e.encoding,o=void 0===n,l=[{op:"q1",field:r.field,as:"lower_box_"+r.field},{op:"q3",field:r.field,as:"upper_box_"+r.field},{op:"median",field:r.field,as:"mid_box_"+r.field}],c=[];l.push({op:"min",field:r.field,as:(o?"lower_whisker_":"min_")+r.field}),l.push({op:"max",field:r.field,as:(o?"upper_whisker_":"max_")+r.field}),o||(c=[{calculate:"datum.upper_box_"+r.field+" - datum.lower_box_"+r.field,as:"iqr_"+r.field},{calculate:"min(datum.upper_box_"+r.field+" + datum.iqr_"+r.field+" * "+n+", datum.max_"+r.field+")",as:"upper_whisker_"+r.field},{calculate:"max(datum.lower_box_"+r.field+" - datum.iqr_"+r.field+" * "+n+", datum.min_"+r.field+")",as:"lower_whisker_"+r.field}]);var u=[],f=[],d=[],p={};return E.forEach(s,function(e,t){if(t!==a)if(x.isFieldDef(e)){if(e.aggregate&&e.aggregate!==b.BOXPLOT)l.push({op:e.aggregate,field:e.field,as:x.vgField(e)});else if(void 0===e.aggregate){var n=x.vgField(e),i=e.bin;if(i){var r=e.field;f.push({bin:i,field:r,as:n})}else if(e.timeUnit){var o=e.timeUnit;r=e.field,d.push({timeUnit:o,field:r,as:n})}u.push(n)}p[t]={field:x.vgField(e),type:e.type}}else p[t]=s[t]}),{transform:[].concat(f,d,[{aggregate:l,groupby:u}],c),continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:p}}(e,function(e){var t=e.mark,n=e.encoding;if(e.projection,_(e,["mark","encoding","projection"]),x.isFieldDef(n.x)&&x.isContinuous(n.x)){if(x.isFieldDef(n.y)&&x.isContinuous(n.y)){if(void 0===n.x.aggregate&&n.y.aggregate===b.BOXPLOT)return"vertical";if(void 0===n.y.aggregate&&n.x.aggregate===b.BOXPLOT)return"horizontal";if(n.x.aggregate===b.BOXPLOT&&n.y.aggregate===b.BOXPLOT)throw new Error("Both x and y cannot have aggregate");return T(t)&&t.orient?t.orient:"vertical"}return"horizontal"}if(x.isFieldDef(n.y)&&x.isContinuous(n.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}(e),o),f=u.transform,d=u.continuousAxisChannelDef,p=u.continuousAxis,g=u.encodingWithoutContinuousAxis,m=(g.color,g.size),h=_(g,["color","size"]),v=m?{size:m}:N.getMarkSpecificConfigMixins(t.box,"size"),y={};return d.scale&&(y.scale=d.scale),d.axis&&(y.axis=d.axis),O({},r,{transform:f,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:O((a={},a[p]=O({field:"lower_whisker_"+d.field,type:d.type},y),a[p+"2"]={field:"lower_box_"+d.field,type:d.type},a),h,N.getMarkSpecificConfigMixins(t.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:O((s={},s[p]={field:"upper_box_"+d.field,type:d.type},s[p+"2"]={field:"upper_whisker_"+d.field,type:d.type},s),h,N.getMarkSpecificConfigMixins(t.boxWhisker,"color"))},O({},i?{selection:i}:{},{mark:{type:"bar",style:"box"},encoding:O((l={},l[p]={field:"lower_box_"+d.field,type:d.type},l[p+"2"]={field:"upper_box_"+d.field,type:d.type},l),g,g.color?{}:N.getMarkSpecificConfigMixins(t.box,"color"),v)}),{mark:{type:"tick",style:"boxMid"},encoding:O((c={},c[p]={field:"mid_box_"+d.field,type:d.type},c),h,N.getMarkSpecificConfigMixins(t.boxMid,"color"),v)}]})}},{"../encoding":104,"./../encoding":104,"./../fielddef":106,"./../log":110,"./common":98,"vega-util":10}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMarkSpecificConfigMixins=function(e,t){var n,i=e[t];return void 0!==i?((n={})[t]={value:i},n):{}}},{}],99:[function(e,t,n){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ERRORBAR="error-bar",n.normalizeErrorBar=function(e){e.mark,e.selection,e.projection;var t=e.encoding,n=s(e,["mark","selection","projection","encoding"]),i=(t.size,s(t,["size"])),r=(t.x2,t.y2,s(t,["x2","y2"])),o=(r.x,r.y,s(r,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return a({},n,{layer:[{mark:"rule",encoding:i},{mark:"tick",encoding:r},{mark:"tick",encoding:t.x2?a({x:t.x2,y:t.y},o):a({x:t.x,y:t.y2},o)}]})}},{}],100:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./../mark"),o=e("./boxplot"),a=e("./errorbar"),s={};function l(e,t){s[e]=t}n.add=l,n.remove=function(e){delete s[e]},n.COMPOSITE_MARK_STYLES=o.BOXPLOT_STYLES,n.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=i({},o.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),l(o.BOXPLOT,o.normalizeBoxPlot),l(a.ERRORBAR,a.normalizeErrorBar),n.normalize=function(e,t){var n=r.isMarkDef(e.mark)?e.mark.type:e.mark,i=s[n];if(i)return i(e,t);throw new Error('Invalid mark type "'+n+'"')}},{"./../mark":112,"./boxplot":97,"./errorbar":99}],101:[function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var y=e("vega-util"),i=e("./compositemark"),r=e("./compositemark/index"),b=e("./guide"),a=e("./legend"),O=e("./mark"),s=e("./mark"),l=e("./scale"),c=e("./selection"),u=e("./title"),_=e("./util");n.defaultViewConfig={width:200,height:200},n.defaultConfig={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:n.defaultViewConfig,mark:s.defaultMarkConfig,area:{},bar:s.defaultBarConfig,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:s.defaultTickConfig,box:{size:14,extent:1.5},boxWhisker:{},boxMid:{color:"white"},scale:l.defaultScaleConfig,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:a.defaultLegendConfig,selection:c.defaultConfig,style:{},title:{}},n.initConfig=function(e){return _.mergeDeep(_.duplicate(n.defaultConfig),e)};var S=["view"].concat(O.PRIMITIVE_MARKS,i.COMPOSITE_MARK_STYLES),E=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],x=o({view:["width","height"]},O.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,r.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);function w(e,t,n){var i="title"===t?u.extractTitleConfig(e.title).mark:e[t];"view"===t&&(n="cell");var r=o({},i,e.style[t]);0<_.keys(r).length&&(e.style[n||t]=r),delete e[t]}n.stripAndRedirectConfig=function(e){e=_.duplicate(e);for(var t=0,n=E;t<n.length;t++)delete e[o=n[t]];if(e.axis)for(var i=0,r=b.VL_ONLY_GUIDE_CONFIG;i<r.length;i++){var o=r[i];delete e.axis[o]}if(e.legend)for(var a=0,s=b.VL_ONLY_GUIDE_CONFIG;a<s.length;a++)o=s[a],delete e.legend[o];if(e.mark)for(var l=0,c=O.VL_ONLY_MARK_CONFIG_PROPERTIES;l<c.length;l++)o=c[l],delete e.mark[o];for(var u=0,f=S;u<f.length;u++){for(var d=f[u],p=0,g=O.VL_ONLY_MARK_CONFIG_PROPERTIES;p<g.length;p++)o=g[p],delete e[d][o];var m=x[d];if(m)for(var h=0,v=m;h<v.length;h++)o=v[h],delete e[d][o];w(e,d)}for(var o in w(e,"title","group-title"),e)y.isObject(e[o])&&0===_.keys(e[o]).length&&delete e[o];return 0<_.keys(e).length?e:void 0}},{"./compositemark":100,"./compositemark/index":100,"./guide":107,"./legend":109,"./mark":112,"./scale":115,"./selection":116,"./title":121,"./util":125,"vega-util":10}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=function(e){return!!e.url},n.isInlineData=function(e){return!!e.values},n.isNamedData=function(e){return!!e.name},n.MAIN="main",n.RAW="raw"},{}],103:[function(e,t,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var u=e("vega-util"),f=e("./log"),d=e("./util"),p=2006;c.isDateTime=function(e){return!(!e||!(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))},c.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],c.SHORT_MONTHS=c.MONTHS.map(function(e){return e.substr(0,3)}),c.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],c.SHORT_DAYS=c.DAYS.map(function(e){return e.substr(0,3)}),c.dateTimeExpr=function(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&1<d.keys(e).length&&(f.warn(f.message.droppedDay(e)),delete(e=d.duplicate(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(p):n.push(0),void 0!==e.month){var i=t?function(e){if(u.isNumber(e))return e-1+"";var t=e.toLowerCase(),n=c.MONTHS.indexOf(t);if(-1!==n)return n+"";var i=t.substr(0,3),r=c.SHORT_MONTHS.indexOf(i);if(-1!==r)return r+"";throw new Error(f.message.invalidTimeUnit("month",e))}(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){var r=t?function(e){if(u.isNumber(e))return 4<e&&f.warn(f.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(f.message.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var o=t?function(e){if(u.isNumber(e))return e%7+"";var t=e.toLowerCase(),n=c.DAYS.indexOf(t);if(-1!==n)return n+"";var i=t.substr(0,3),r=c.SHORT_DAYS.indexOf(i);if(-1!==r)return r+"";throw new Error(f.message.invalidTimeUnit("day",e))}(e.day):e.day;n.push(o+"+1")}else n.push(1);for(var a=0,s=["hours","minutes","seconds","milliseconds"];a<s.length;a++){var l=s[a];void 0!==e[l]?n.push(e[l]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}},{"./log":110,"./util":125,"vega-util":10}],104:[function(e,t,n){"use strict";var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},f=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var d=e("vega-util"),p=e("./channel"),g=e("./fielddef"),m=e("./log"),h=e("./type"),v=e("./util");function r(e,t){var n=e&&e[t];return!!n&&(d.isArray(n)?v.some(n,function(e){return!!e.field}):g.isFieldDef(n)||g.hasConditionalFieldDef(n))}n.channelHasField=r,n.isAggregate=function(i){return v.some(p.CHANNELS,function(e){if(r(i,e)){var t=i[e];if(d.isArray(t))return v.some(t,function(e){return!!e.aggregate});var n=g.getFieldDef(t);return n&&!!n.aggregate}return!1})},n.normalizeEncoding=function(l,c){return v.keys(l).reduce(function(e,n){if(!p.isChannel(n))return m.warn(m.message.invalidEncodingChannel(n)),e;if(!p.supportMark(n,c))return m.warn(m.message.incompatibleChannel(n,c)),e;var t;if("size"===n&&"line"===c&&(i=g.getFieldDef(l[n]))&&i.aggregate)return m.warn(m.message.incompatibleChannel(n,c,"when the field is aggregated.")),e;if("detail"===n||"order"===n)(r=l[n])&&(e[n]=(d.isArray(r)?r:[r]).reduce(function(e,t){return g.isFieldDef(t)?e.push(g.normalizeFieldDef(t,n)):m.warn(m.message.emptyFieldDef(t,n)),e},[]));else{var i,r=l[n];if((i=g.getFieldDef(l[n]))&&v.contains([h.Type.LATITUDE,h.Type.LONGITUDE],i.type)){var o=n,a=(e[o],f(e,["symbol"==typeof o?o:o+""])),s="x"===n?"longitude":"y"===n?"latitude":"x2"===n?"longitude2":"y2"===n?"latitude2":void 0;return m.warn(m.message.latLongDeprecated(n,i.type,s)),u({},a,((t={})[s]=u({},g.normalize(i,n),{type:"quantitative"}),t))}if(!g.isFieldDef(r)&&!g.isValueDef(r)&&!g.isConditionalDef(r))return m.warn(m.message.emptyFieldDef(r,n)),e;e[n]=g.normalize(r,n)}return e},{})},n.isRanged=function(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)},n.fieldDefs=function(n){var i=[];return p.CHANNELS.forEach(function(e){if(r(n,e)){var t=n[e];(d.isArray(t)?t:[t]).forEach(function(e){g.isFieldDef(e)?i.push(e):g.hasConditionalFieldDef(e)&&i.push(e.condition)})}}),i},n.forEach=function(e,n,i){if(e)for(var t=function(t){d.isArray(e[t])?e[t].forEach(function(e){n.call(i,e,t)}):n.call(i,e[t],t)},r=0,o=v.keys(e);r<o.length;r++)t(o[r])},n.reduce=function(i,r,e,o){return i?v.keys(i).reduce(function(e,n){var t=i[n];return d.isArray(t)?t.reduce(function(e,t){return r.call(o,e,t,n)},e):r.call(o,e,t,n)},e):e}},{"./channel":15,"./fielddef":106,"./log":110,"./type":124,"./util":125,"vega-util":10}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],106:[function(e,t,n){"use strict";var l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),u=e("./aggregate"),a=e("./bin"),r=e("./channel"),f=e("./log"),d=e("./timeunit"),p=e("./type"),s=e("./util");function o(e){return!!e&&!!e.condition&&!i.isArray(e.condition)&&g(e.condition)}function g(e){return!(!e||!e.field&&"count"!==e.aggregate)}function m(e){return e&&"value"in e&&void 0!==e.value}function h(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return!1}throw new Error(f.message.invalidFieldType(e.type))}function v(e){return!h(e)}function y(e){return"count"===e.aggregate}function b(e,t){var n=e.field,i=e.bin,r=e.timeUnit,o=e.aggregate;return"count"===o?t.countTitle:i?n+" (binned)":r?n+" ("+d.getTimeUnitParts(r).join("-")+")":o?s.titlecase(o)+" of "+n:n}function O(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}n.isConditionalSelection=function(e){return e.selection},n.isRepeatRef=function(e){return e&&!i.isString(e)&&"repeat"in e},n.toFieldDefBase=function(e){var t=e.field,n=e.timeUnit,i=e.bin,r=e.aggregate;return l({},n?{timeUnit:n}:{},i?{bin:i}:{},r?{aggregate:r}:{},{field:t})},n.isConditionalDef=function(e){return!!e&&!!e.condition},n.hasConditionalFieldDef=o,n.hasConditionalValueDef=function(e){return!!e&&!!e.condition&&(i.isArray(e.condition)||m(e.condition))},n.isFieldDef=g,n.isStringFieldDef=function(e){return g(e)&&i.isString(e.field)},n.isValueDef=m,n.isScaleFieldDef=function(e){return!(!e||!e.scale&&!e.sort)},n.vgField=function(e,t){void 0===t&&(t={});var n=e.field,i=t.prefix,r=t.suffix;if(y(e))n="count_*";else{var o=void 0;t.nofn||(e.bin?(o=a.binToString(e.bin),r=t.binSuffix||""):e.aggregate?o=String(t.aggregate||e.aggregate):e.timeUnit&&(o=String(e.timeUnit))),o&&(n=o+"_"+n)}return r&&(n=n+"_"+r),i&&(n=i+"_"+n),t.expr&&(n=""+t.expr+s.accessPath(n)),n},n.isDiscrete=h,n.isContinuous=v,n.isCount=y,n.verbalTitleFormatter=b,n.functionalTitleFormatter=O,n.defaultTitleFormatter=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return O(e);default:return b(e,t)}};var _=n.defaultTitleFormatter;function S(e){_=e}function E(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(r.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function x(e,t){if(e.aggregate&&!u.isAggregateOp(e.aggregate)){e.aggregate;var n=c(e,["aggregate"]);f.warn(f.message.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=l({},e,{timeUnit:d.normalizeTimeUnit(e.timeUnit)})),e.bin&&(e=l({},e,{bin:w(e.bin,t)})),e.type){var i=p.getFullName(e.type);e.type!==i&&(e=l({},e,{type:i})),"quantitative"!==e.type&&u.isCountingAggregateOp(e.aggregate)&&(f.warn(f.message.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=l({},e,{type:"quantitative"}))}else{var r=E(e,t);f.warn(f.message.emptyOrInvalidFieldType(e.type,t,r)),e=l({},e,{type:r})}var o=T(e,t),a=o.compatible,s=o.warning;return a||f.warn(s),e}function w(e,t){return i.isBoolean(e)?{maxbins:a.autoMaxBins(t)}:e.maxbins||e.step?e:l({},e,{maxbins:a.autoMaxBins(t)})}n.setTitleFormatter=S,n.resetTitleFormatter=function(){S(n.defaultTitleFormatter)},n.title=function(e,t){return _(e,t)},n.defaultType=E,n.getFieldDef=function(e){return g(e)?e:o(e)?e.condition:void 0},n.normalize=function(e,t){if(i.isString(e)||i.isNumber(e)||i.isBoolean(e)){var n=i.isString(e)?"string":i.isNumber(e)?"number":"boolean";return f.warn(f.message.primitiveChannelDef(t,n,e)),{value:e}}return g(e)?x(e,t):o(e)?l({},e,{condition:x(e.condition,t)}):e},n.normalizeFieldDef=x,n.normalizeBin=w;var N={compatible:!0};function T(e,t){switch(t){case"row":case"column":return v(e)&&!e.timeUnit?{compatible:!1,warning:f.message.facetChannelShouldBeDiscrete(t)}:N;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return N;case"longitude":case"longitude2":case"latitude":case"latitude2":return e.type!==p.QUANTITATIVE?{compatible:!1,warning:"Channel "+t+" should not be used with "+e.type+" field."}:N;case"opacity":case"size":case"x2":case"y2":return h(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:N;case"shape":return"nominal"!==e.type&&"geojson"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data or geojson only"}:N;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:N}throw new Error("channelCompatability not implemented for channel "+t)}n.channelCompatibility=T,n.isNumberFieldDef=function(e){return"quantitative"===e.type||!!e.bin},n.isTimeFieldDef=function(e){return"temporal"===e.type||!!e.timeUnit}},{"./aggregate":12,"./bin":14,"./channel":15,"./log":110,"./timeunit":120,"./type":124,"./util":125,"vega-util":10}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.aggregate=e("./aggregate"),n.axis=e("./axis"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var i=e("./compile/compile");n.compile=i.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":11,"./aggregate":12,"./axis":13,"./bin":14,"./channel":15,"./compile/compile":25,"./compositemark":100,"./config":101,"./data":102,"./datetime":103,"./encoding":104,"./facet":105,"./fielddef":106,"./legend":109,"./mark":112,"./scale":115,"./sort":117,"./spec":118,"./stack":119,"./timeunit":120,"./transform":123,"./type":124,"./util":125,"./validate":126}],109:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.defaultLegendConfig={};var o={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},a=i({},o,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1});n.LEGEND_PROPERTIES=r.flagKeys(o),n.VG_LEGEND_PROPERTIES=r.flagKeys(a)},{"./util":125}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r=e("vega-util"),o=e("./util"),a=r.logger(r.Warn),s=a,l=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.warns).push.apply(e,t),this},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.infos).push.apply(e,t),this},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.debugs).push.apply(e,t),this},e}();function c(){return s=a}n.LocalLogger=l,n.wrap=function(e){return function(){s=new l,e(s),c()}},n.set=function(e){return s=e},n.reset=c,n.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.warn.apply(s,arguments)},n.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.info.apply(s,arguments)},n.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.debug.apply(s,arguments)},(i=n.message||(n.message={})).INVALID_SPEC="Invalid spec",i.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',i.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',i.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},i.nearestNotSupportForContinuous=function(e){return'The "nearest" transform is not supported for '+e+" marks."},i.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},i.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",i.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},i.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",i.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",i.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},i.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},i.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},i.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+o.stringify(e)+"."},i.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the the data from the secondary source.',i.encodingOverridden=function(e){return"Layer's shared "+e.join(",")+" channel "+(1===e.length?"is":"are")+" overriden"},i.projectionOverridden=function(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+o.stringify(t)+" is overridden by a child projection "+o.stringify(n)+"."},i.primitiveChannelDef=function(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+o.stringify(n)+"}."},i.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},i.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},i.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},i.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},i.emptyFieldDef=function(e,t){return"Dropping "+o.stringify(e)+' from channel "'+t+'" since it does not contain data field or value.'},i.latLongDeprecated=function(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."},i.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},i.invalidEncodingChannel=function(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."},i.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},i.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},i.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",i.unclearOrientContinuous=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continuous fields. In this case, we use vertical by default'},i.unclearOrientDiscreteOrEmpty=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'},i.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},i.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",i.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},i.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+o.stringify(e)+")."},i.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},i.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+o.stringify(e)+")."},i.cannotUseSizeFieldWithBandSize=function(e){return"Using size field when "+e+"-channel has a band scale is not supported."},i.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},i.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},i.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},i.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},i.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},i.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},i.mergeConflictingProperty=function(e,t,n,i){return"Conflicting "+t+' property "'+e+'" ('+o.stringify(n)+" and "+o.stringify(i)+").  Using "+o.stringify(n)+"."},i.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},i.conflictedDomain=function(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'},i.domainSortDropped=function(e){return"Dropping sort property "+o.stringify(e)+" as unioned domains only support boolean or op 'count'."},i.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",i.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",i.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",i.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},i.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},i.stackNonSummativeAggregate=function(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'},i.invalidTimeUnit=function(e,t){return"Invalid "+e+": "+o.stringify(t)},i.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},i.droppedDay=function(e){return"Dropping day from datetime "+o.stringify(e)+" as day cannot be combined with other units."}},{"./util":125,"vega-util":10}],111:[function(e,t,n){"use strict";function s(e){return!!e.or}function l(e){return!!e.and}function c(e){return!!e.not}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=s,n.isLogicalAnd=l,n.isLogicalNot=c,n.forEachLeave=function e(t,n){if(c(t))e(t.not,n);else if(l(t))for(var i=0,r=t.and;i<r.length;i++)e(r[i],n);else if(s(t))for(var o=0,a=t.or;o<a.length;o++)e(a[o],n);else n(t)},n.normalizeLogicalOperand=function t(e,n){return c(e)?{not:t(e.not,n)}:l(e)?{and:e.and.map(function(e){return t(e,n)})}:s(e)?{or:e.or.map(function(e){return t(e,n)})}:n(e)}},{}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r,o=e("vega-util"),a=e("./util");(r=i=n.Mark||(n.Mark={})).AREA="area",r.BAR="bar",r.LINE="line",r.POINT="point",r.RECT="rect",r.RULE="rule",r.TEXT="text",r.TICK="tick",r.CIRCLE="circle",r.SQUARE="square",r.GEOSHAPE="geoshape",n.AREA=i.AREA,n.BAR=i.BAR,n.LINE=i.LINE,n.POINT=i.POINT,n.TEXT=i.TEXT,n.TICK=i.TICK,n.RECT=i.RECT,n.RULE=i.RULE,n.GEOSHAPE=i.GEOSHAPE,n.CIRCLE=i.CIRCLE,n.SQUARE=i.SQUARE;var s={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function l(e){return e.type}n.isMark=function(e){return!!s[e]},n.PRIMITIVE_MARKS=a.flagKeys(s),n.isMarkDef=l;var c=o.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=function(e){return(l(e)?e.type:e)in c},n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:5},n.defaultTickConfig={thickness:1}},{"./util":125,"vega-util":10}],113:[function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-util"),o=e("./compile/selection/selection"),a=e("./datetime"),s=e("./fielddef"),l=e("./timeunit"),c=e("./util");function u(e){return e&&e.selection}function f(e){return e&&!!e.field&&void 0!==e.equal}function d(e){return!!(e&&e.field&&r.isArray(e.range)&&2===e.range.length)}function p(e){return e&&!!e.field&&(r.isArray(e.oneOf)||r.isArray(e.in))}function g(e){return p(e)||f(e)||d(e)}function m(t,e){void 0===e&&(e=!0);var n=t.timeUnit?"time("+l.fieldExpr(t.timeUnit,t.field)+")":s.vgField(t,{expr:"datum"});if(f(t))return n+"==="+h(t.equal,t.timeUnit);if(p(t))return"indexof(["+(t.oneOf||t.in).map(function(e){return h(e,t.timeUnit)}).join(",")+"], "+n+") !== -1";if(d(t)){var i=t.range[0],r=t.range[1];if(null!==i&&null!==r&&e)return"inrange("+n+", ["+h(i,t.timeUnit)+", "+h(r,t.timeUnit)+"])";var o=[];return null!==i&&o.push(n+" >= "+h(i,t.timeUnit)),null!==r&&o.push(n+" <= "+h(r,t.timeUnit)),0<o.length?o.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(t))}function h(e,t){if(a.isDateTime(e))return"time("+a.dateTimeExpr(e,!0)+")";if(l.isLocalSingleTimeUnit(t)){var n={};return n[t]=e,"time("+a.dateTimeExpr(n,!0)+")"}return l.isUtcSingleTimeUnit(t)?h(e,l.getLocalTimeUnit(t)):JSON.stringify(e)}n.isSelectionPredicate=u,n.isFieldEqualPredicate=f,n.isFieldRangePredicate=d,n.isFieldOneOfPredicate=p,n.isFieldPredicate=g,n.expression=function(t,e,n){return c.logicalExpr(e,function(e){return r.isString(e)?e:u(e)?o.selectionPredicate(t,e.selection,n):m(e)})},n.fieldFilterExpression=m,n.normalizePredicate=function(e){return g(e)&&e.timeUnit?i({},e,{timeUnit:l.normalizeTimeUnit(e.timeUnit)}):e}},{"./compile/selection/selection":85,"./datetime":103,"./fielddef":106,"./timeunit":120,"./util":125,"vega-util":10}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PROJECTION_PROPERTIES=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"]},{}],115:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var r,o=e("vega-util"),a=e("./channel"),s=e("./log"),l=e("./util");(r=n.ScaleType||(n.ScaleType={})).LINEAR="linear",r.BIN_LINEAR="bin-linear",r.LOG="log",r.POW="pow",r.SQRT="sqrt",r.TIME="time",r.UTC="utc",r.SEQUENTIAL="sequential",r.QUANTILE="quantile",r.QUANTIZE="quantize",r.THRESHOLD="threshold",r.ORDINAL="ordinal",r.BIN_ORDINAL="bin-ordinal",r.POINT="point",r.BAND="band";var c={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.SCALE_TYPES=l.keys(c),n.scaleCompatible=function(e,t){var n=c[e],i=c[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n};var u={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=function(e){return u[e]},n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var f=o.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var d=o.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var p=o.toSet(n.DISCRETE_DOMAIN_SCALES),g=o.toSet(["bin-linear","bin-ordinal"]);function m(e){return e in d}function h(e){return e in f}n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=function(e){return e in p},n.isBinScale=function(e){return e in g},n.hasContinuousDomain=m,n.isContinuousToContinuous=h,n.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},n.isExtendedScheme=function(e){return e&&!!e.name},n.isSelectionDomain=function(e){return e&&e.selection};var v={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};n.SCALE_PROPERTIES=l.flagKeys(v);var y=i(v,["type","domain","range","rangeStep","scheme"]);n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=l.flagKeys(y),n.scaleTypeSupportProperty=function(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return l.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return l.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return h(e)||"band"===e||"point"===e;case"padding":return h(e)||l.contains(["point","band"],e);case"paddingOuter":case"rangeStep":return l.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return h(e)||"sequential"===e;case"nice":return h(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return m(e)&&!l.contains(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")},n.channelScalePropertyIncompatability=function(e,t){switch(t){case"interpolate":case"scheme":return a.isColorChannel(e)?void 0:s.message.cannotUseScalePropertyWithNonColor(e);case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')},n.channelSupportScaleType=function(e,t){switch(e){case a.Channel.X:case a.Channel.Y:case a.Channel.SIZE:case a.Channel.OPACITY:return h(t)||l.contains(["band","point"],t);case a.Channel.COLOR:case a.Channel.FILL:case a.Channel.STROKE:return"band"!==t;case a.Channel.SHAPE:return"ordinal"===t}return!1}},{"./channel":15,"./log":110,"./util":125,"vega-util":10}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELECTION_ID="_vgsid_",n.defaultConfig={single:{on:"click",fields:[n.SELECTION_ID],resolve:"global",empty:"all"},multi:{on:"click",fields:[n.SELECTION_ID],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}}},{}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=function(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}},{}],118:[function(e,t,n){"use strict";var A=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},C=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var M=e("./channel"),d=e("./compositemark"),I=e("./encoding"),i=e("./encoding"),F=e("./log"),p=e("./mark"),m=e("./stack"),g=e("./util");function L(e){return void 0!==e.facet}function R(e){return!!e.mark}function U(e){return void 0!==e.layer}function z(e){return void 0!==e.repeat}function r(e){return H(e)||G(e)}function H(e){return void 0!==e.vconcat}function G(e){return void 0!==e.hconcat}function B(e,t){if(L(e))return i=t,r=(n=e).spec,o=C(n,["spec"]),A({},o,{spec:B(r,i)});var n,i,r,o,a,s,l,c,u,f,d,p,g,m,h,v,y,b,O,_,S,E,x,w,N,T,P,D;if(U(e))return function t(e,n,i,r){var o=e.layer,a=e.encoding,s=e.projection,l=C(e,["layer","encoding","projection"]);var c=q({parentEncoding:i,encoding:a});var u=W({parentProjection:r,projection:s});return A({},l,{layer:o.map(function(e){return U(e)?t(e,n,c,u):V(e,n,c,u)})})}(e,t);if(z(e))return s=t,l=(a=e).spec,c=C(a,["spec"]),A({},c,{spec:B(l,s)});if(H(e))return f=t,d=(u=e).vconcat,p=C(u,["vconcat"]),A({},p,{vconcat:d.map(function(e){return B(e,f)})});if(G(e))return m=t,h=(g=e).hconcat,v=C(g,["hconcat"]),A({},v,{hconcat:h.map(function(e){return B(e,m)})});if(R(e)){var k=I.channelHasField(e.encoding,M.ROW),j=I.channelHasField(e.encoding,M.COLUMN);return k||j?(b=t,O=(y=e).encoding,_=O.row,S=O.column,E=C(O,["row","column"]),x=y.mark,w=y.width,N=y.projection,T=y.height,P=y.selection,y.encoding,D=C(y,["mark","width","projection","height","selection","encoding"]),A({},D,{facet:A({},_?{row:_}:{},S?{column:S}:{}),spec:V(A({},N?{projection:N}:{},{mark:x},w?{width:w}:{},T?{height:T}:{},{encoding:E},P?{selection:P}:{}),b)})):V(e,t)}throw new Error(F.message.INVALID_SPEC)}function q(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var i=g.keys(t).reduce(function(e,t){return n[t]&&e.push(t),e},[]);0<i.length&&F.warn(F.message.encodingOverridden(i))}var r=A({},t||{},n||{});return 0<g.keys(r).length?r:void 0}function W(e){var t=e.parentProjection,n=e.projection;return t&&n&&F.warn(F.message.projectionOverridden({parentProjection:t,projection:n})),n||t}function V(e,t,n,i){var r,o=e.encoding,a=e.projection;if(n||i){var s=W({parentProjection:i,projection:a}),l=q({parentEncoding:n,encoding:o});return V(A({},e,s?{projection:s}:{},l?{encoding:l}:{}),t)}if(r=e,p.isPrimitiveMark(r.mark)){if(I.isRanged(o))return function(e){var t=I.channelHasField(e.encoding,M.X),n=I.channelHasField(e.encoding,M.Y),i=I.channelHasField(e.encoding,M.X2),r=I.channelHasField(e.encoding,M.Y2);if(i&&!t||r&&!n){var o=g.duplicate(e);return i&&!t&&(o.encoding.x=o.encoding.x2,delete o.encoding.x2),r&&!n&&(o.encoding.y=o.encoding.y2,delete o.encoding.y2),o}return e}(e);var c=t&&t.overlay,u=c&&e.mark===p.AREA&&g.contains(["linepoint","line"],c.area),f=c&&(c.line&&e.mark===p.LINE||"linepoint"===c.area&&e.mark===p.AREA);return f||u?function(e,t,n,i){var r,o=e.mark,a=e.selection,s=e.projection,l=e.encoding,c=C(e,["mark","selection","projection","encoding"]),u=[{mark:o,encoding:l}],f=m.stack(o,l,i?i.stack:void 0),d=l;if(f){var p=f.fieldChannel,g=f.offset;d=A({},l,((r={})[p]=A({},l[p],g?{stack:g}:{}),r))}n&&u.push(A({},s?{projection:s}:{},{mark:{type:"line",style:"lineOverlay"}},a?{selection:a}:{},{encoding:d}));t&&u.push(A({},s?{projection:s}:{},{mark:{type:"point",filled:!0,style:"pointOverlay"}},a?{selection:a}:{},{encoding:d}));return A({},c,{layer:u})}(e,f,u,t):e}return d.normalize(e,t)}function o(i,e){return e.forEach(function(n){var e=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,t){return void 0!==n[t]&&(e[t]=n[t]),e},{}),t=g.hash(e);i[t]=i[t]||n}),i}n.isFacetSpec=L,n.isUnitSpec=R,n.isLayerSpec=U,n.isRepeatSpec=z,n.isConcatSpec=r,n.isVConcatSpec=H,n.isHConcatSpec=G,n.normalize=B,n.fieldDefs=function(e){return g.vals(function t(e,n){return void 0===n&&(n={}),U(e)?e.layer.forEach(function(e){R(e)?o(n,i.fieldDefs(e.encoding)):t(e,n)}):L(e)?(o(n,i.fieldDefs(e.facet)),t(e.spec,n)):z(e)?t(e.spec,n):r(e)?(H(e)?e.vconcat:e.hconcat).forEach(function(e){return t(e,n)}):o(n,i.fieldDefs(e.encoding)),n}(e))},n.isStacked=function(e,t){return t=t||e.config,!!p.isPrimitiveMark(e.mark)&&null!==m.stack(e.mark,e.encoding,t?t.stack:void 0)}},{"./channel":15,"./compositemark":100,"./encoding":104,"./log":110,"./mark":112,"./stack":119,"./util":125}],119:[function(e,t,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});var p=e("vega-util"),g=e("./aggregate"),m=e("./channel"),h=e("./encoding"),v=e("./fielddef"),y=e("./log"),b=e("./mark"),O=e("./scale"),_=e("./util"),n={zero:1,center:1,normalize:1};function S(e){return!!n[e]}d.isStackOffset=S,d.STACKABLE_MARKS=[b.BAR,b.AREA,b.RULE,b.POINT,b.CIRCLE,b.SQUARE,b.LINE,b.TEXT,b.TICK],d.STACK_BY_DEFAULT_MARKS=[b.BAR,b.AREA],d.stack=function(e,t,n){var i=b.isMarkDef(e)?e.type:e;if(!_.contains(d.STACKABLE_MARKS,i))return null;var r=function(e){var t=e.x,n=e.y;if(v.isFieldDef(t)&&v.isFieldDef(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(v.isFieldDef(t)&&"quantitative"===t.type)return"x";if(v.isFieldDef(n)&&"quantitative"===n.type)return"y"}}(t);if(!r)return null;var o=t[r],a=v.isStringFieldDef(o)?v.vgField(o,{}):void 0,s="x"===r?"y":"x",l=t[s],c=v.isStringFieldDef(l)?v.vgField(l,{}):void 0,u=m.NONPOSITION_CHANNELS.reduce(function(i,r){if(h.channelHasField(t,r)){var e=t[r];(p.isArray(e)?e:[e]).forEach(function(e){var t=v.getFieldDef(e);if(!t.aggregate){var n=v.isStringFieldDef(t)?v.vgField(t,{}):void 0;(!n||n!==c&&n!==a)&&i.push({channel:r,fieldDef:t})}})}return i},[]);if(0===u.length)return null;var f=void 0;return(f=void 0!==o.stack?o.stack:_.contains(d.STACK_BY_DEFAULT_MARKS,i)&&void 0===n?"zero":n)&&S(f)?o.scale&&o.scale.type&&o.scale.type!==O.ScaleType.LINEAR?(y.warn(y.message.cannotStackNonLinearScale(o.scale.type)),null):h.channelHasField(t,r===m.X?m.X2:m.Y2)?(y.warn(y.message.cannotStackRangedMark(r)),null):(o.aggregate&&!_.contains(g.SUM_OPS,o.aggregate)&&y.warn(y.message.stackNonSummativeAggregate(o.aggregate)),{groupbyChannel:l?s:void 0,fieldChannel:r,impute:_.contains(["area","line"],i),stackBy:u,offset:f}):null}},{"./aggregate":12,"./channel":15,"./encoding":104,"./fielddef":106,"./log":110,"./mark":112,"./scale":115,"./util":125,"vega-util":10}],120:[function(e,t,f){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(f,"__esModule",{value:!0});var d,i,a=e("./datetime"),r=e("./log"),s=e("./util");(i=d=f.TimeUnit||(f.TimeUnit={})).YEAR="year",i.MONTH="month",i.DAY="day",i.DATE="date",i.HOURS="hours",i.MINUTES="minutes",i.SECONDS="seconds",i.MILLISECONDS="milliseconds",i.YEARMONTH="yearmonth",i.YEARMONTHDATE="yearmonthdate",i.YEARMONTHDATEHOURS="yearmonthdatehours",i.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",i.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",i.MONTHDATE="monthdate",i.HOURSMINUTES="hoursminutes",i.HOURSMINUTESSECONDS="hoursminutesseconds",i.MINUTESSECONDS="minutesseconds",i.SECONDSMILLISECONDS="secondsmilliseconds",i.QUARTER="quarter",i.YEARQUARTER="yearquarter",i.QUARTERMONTH="quartermonth",i.YEARQUARTERMONTH="yearquartermonth",i.UTCYEAR="utcyear",i.UTCMONTH="utcmonth",i.UTCDAY="utcday",i.UTCDATE="utcdate",i.UTCHOURS="utchours",i.UTCMINUTES="utcminutes",i.UTCSECONDS="utcseconds",i.UTCMILLISECONDS="utcmilliseconds",i.UTCYEARMONTH="utcyearmonth",i.UTCYEARMONTHDATE="utcyearmonthdate",i.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",i.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",i.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",i.UTCMONTHDATE="utcmonthdate",i.UTCHOURSMINUTES="utchoursminutes",i.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",i.UTCMINUTESSECONDS="utcminutesseconds",i.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",i.UTCQUARTER="utcquarter",i.UTCYEARQUARTER="utcyearquarter",i.UTCQUARTERMONTH="utcquartermonth",i.UTCYEARQUARTERMONTH="utcyearquartermonth";var o={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};f.TIMEUNIT_PARTS=s.flagKeys(o),f.isLocalSingleTimeUnit=function(e){return!!o[e]};var l={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};f.isUtcSingleTimeUnit=function(e){return!!l[e]};var c={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},u=n({},l,c);function p(e){return!!u[e]}f.isUTCTimeUnit=p,f.getLocalTimeUnit=function(e){return e.substr(3)};var g=n({},o,l,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},c);f.TIMEUNITS=s.flagKeys(g),f.isTimeUnit=function(e){return!!g[e]};var m={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function h(e,t){var n=m[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function v(e,t){var n=e.indexOf(t);return-1<n&&(t!==d.SECONDS||0===n||"i"!==e.charAt(n-1))}f.convert=function(e,t){for(var n=p(e),i=n?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),r=0,o=f.TIMEUNIT_PARTS;r<o.length;r++){var a=o[r];if(v(e,a))switch(a){case d.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case d.QUARTER:var s=h("month",n),l=s.getDateMethod;i[s.setDateMethod](3*Math.floor(t[l]()/3));break;default:var c=h(a,n),u=c.getDateMethod;i[c.setDateMethod](t[u]())}}return i},f.getTimeUnitParts=function(n){return f.TIMEUNIT_PARTS.reduce(function(e,t){return v(n,t)?e.concat(t):e},[])},f.containsTimeUnit=v,f.fieldExpr=function(i,e){var r="datum"+s.accessPath(e),o=p(i)?"utc":"",t=f.TIMEUNIT_PARTS.reduce(function(e,t){var n;return v(i,t)&&(e[t]=(n=t)===d.QUARTER?"("+o+"quarter("+r+")-1)":""+o+n+"("+r+")"),e},{});return a.dateTimeExpr(t)},f.formatExpression=function(e,t,n,i){if(e){var r=[],o="",a=v(e,d.YEAR);v(e,d.QUARTER)&&(o="'Q' + quarter("+t+")"),v(e,d.MONTH)&&r.push(!1!==n?"%b":"%B"),v(e,d.DAY)?r.push(n?"%a":"%A"):v(e,d.DATE)&&r.push("%d"+(a?",":"")),a&&r.push(n?"%y":"%Y");var s=[];v(e,d.HOURS)&&s.push("%H"),v(e,d.MINUTES)&&s.push("%M"),v(e,d.SECONDS)&&s.push("%S"),v(e,d.MILLISECONDS)&&s.push("%L");var l=[];return 0<r.length&&l.push(r.join(" ")),0<s.length&&l.push(s.join(":")),0<l.length&&(o&&(o+=" + ' ' + "),o+=i?"utcFormat("+t+", '"+l.join(" ")+"')":"timeFormat("+t+", '"+l.join(" ")+"')"),o||void 0}},f.normalizeTimeUnit=function(e){return"day"!==e&&0<=e.indexOf("day")?(r.warn(r.message.dayReplacedWithDate(e)),e.replace("day","date")):e}},{"./datetime":103,"./log":110,"./util":125}],121:[function(e,t,n){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.extractTitleConfig=function(e){var t=e.anchor,n=e.offset,i=e.orient,r=e.color,o=s(e,["anchor","offset","orient","color"]);return{mark:a({},o,r?{fill:r}:{}),nonMark:a({},t?{anchor:t}:{},n?{offset:n}:{},i?{orient:i}:{})}}},{}],122:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),o=e("./log");function a(e){return i.isString(e)?{type:e}:e||{}}n.normalizeAutoSize=function(e,t,n){void 0===n&&(n=!0);var i=r({type:"pad"},a(t),a(e));return"fit"===i.type&&(n||(o.warn(o.message.FIT_NON_SINGLE),i.type="pad")),i};var s=["background","padding","datasets"];n.extractTopLevelProperties=function(n){return s.reduce(function(e,t){return n&&void 0!==n[t]&&(e[t]=n[t]),e},{})}},{"./log":110,"vega-util":10}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./logical"),r=e("./predicate");function o(e){return void 0!==e.filter}n.isFilter=o,n.isLookup=function(e){return void 0!==e.lookup},n.isCalculate=function(e){return void 0!==e.calculate},n.isBin=function(e){return!!e.bin},n.isTimeUnit=function(e){return void 0!==e.timeUnit},n.isAggregate=function(e){return void 0!==e.aggregate},n.normalizeTransform=function(e){return e.map(function(e){return o(e)?{filter:i.normalizeLogicalOperand(e.filter,r.normalizePredicate)}:e})}},{"./logical":111,"./predicate":113}],124:[function(e,t,n){"use strict";var i,r;Object.defineProperty(n,"__esModule",{value:!0}),(r=i=n.Type||(n.Type={})).QUANTITATIVE="quantitative",r.ORDINAL="ordinal",r.TEMPORAL="temporal",r.NOMINAL="nominal",r.LATITUDE="latitude",r.LONGITUDE="longitude",r.GEOJSON="geojson";var o={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};n.isType=function(e){return!!o[e]},n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.GEOJSON=i.GEOJSON,n.getFullName=function(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal";case i.LATITUDE:return"latitude";case i.LONGITUDE:return"longitude";case n.GEOJSON:return"geojson"}}},{}],125:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=e("json-stable-stringify"),a=e("vega-util"),i=e("./logical");function n(e,t){return-1<e.indexOf(t)}function s(e,t){return e.filter(function(e){return!n(t,e)})}function l(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++){e=c(e,r[i])}return e}function c(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||a.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=l(a.isArray(t[n].constructor)?[]:{},t[n]):l(e[n],t[n]));return e}function u(e){return JSON.parse(JSON.stringify(e))}o.pick=function(e,t){for(var n={},i=0,r=t;i<r.length;i++){var o=r[i];e.hasOwnProperty(o)&&(n[o]=e[o])}return n},o.omit=function(e,t){for(var n=u(e),i=0,r=t;i<r.length;i++)delete n[r[i]];return n},o.stringify=r,o.hash=function(e){if(a.isNumber(e))return e;var t=a.isString(e)?e:r(e);if(t.length<100)return t;for(var n=0,i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i),n&=n;return n},o.contains=n,o.without=s,o.union=function(e,t){return e.concat(s(t,e))},o.some=function(e,t){for(var n=0,i=0;i<e.length;i++)if(t(e[i],i,n++))return!0;return!1},o.every=function(e,t){for(var n=0,i=0;i<e.length;i++)if(!t(e[i],i,n++))return!1;return!0},o.flatten=function(e){return[].concat.apply([],e)},o.mergeDeep=l,o.unique=function(e,t){for(var n,i=[],r={},o=0,a=e;o<a.length;o++){var s=a[o];(n=t(s))in r||(r[n]=1,i.push(s))}return i},o.differ=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1},o.hasIntersection=function(e,t){for(var n in e)if(n in t)return!0;return!1},o.isNumeric=function(e){return!isNaN(e)},o.differArray=function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},o.keys=Object.keys,o.vals=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},o.flagKeys=function(e){return o.keys(e)},o.duplicate=u,o.isBoolean=function(e){return!0===e||!1===e},o.varName=function(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t},o.logicalExpr=function t(e,n){return i.isLogicalNot(e)?"!("+t(e.not,n)+")":i.isLogicalAnd(e)?"("+e.and.map(function(e){return t(e,n)}).join(") && (")+")":i.isLogicalOr(e)?"("+e.or.map(function(e){return t(e,n)}).join(") || (")+")":n(e)},o.deleteNestedProperty=function(e,t){for(var n=!0;0<t.length&&n;){for(var i=e,r=0;r<t.length-1;r++)i=i[t[r]];delete i[t.pop()],0!==o.keys(i).length&&(n=!1)}},o.titlecase=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},o.accessPath=function(e){return"["+a.splitAccessPath(e).map(a.stringValue).join("][")+"]"}},{"./logical":111,"json-stable-stringify":1,"vega-util":10}],126:[function(e,t,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var n=e("vega-util"),u=e("./mark"),f=e("./mark");c.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},c.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:n.toSet(["row","column","x","y","size","color","fill","stroke","detail"]),line:n.toSet(["row","column","x","y","color","fill","stroke","color","detail"]),area:n.toSet(["row","column","x","y","color","fill","stroke","detail"]),tick:n.toSet(["row","column","x","y","color","fill","stroke","detail"]),circle:n.toSet(["row","column","x","y","color","fill","stroke","size","detail"]),square:n.toSet(["row","column","x","y","color","fill","stroke","size","detail"]),point:n.toSet(["row","column","x","y","color","fill","stroke","size","detail","shape"]),geoshape:n.toSet(["row","column","color","fill","stroke","detail","shape"]),text:n.toSet(["row","column","size","color","fill","stroke","text"])},c.getEncodingMappingError=function(e,t,n){void 0===t&&(t=c.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===n&&(n=c.DEFAULT_SUPPORTED_CHANNEL_TYPE);var i=u.isMarkDef(e.mark)?e.mark.type:e.mark,r=e.encoding,o=t[i],a=n[i];for(var s in o)if(!(o[s]in r))return'Missing encoding channel "'+o[s]+'" for mark "'+i+'"';for(var l in r)if(!a[l])return'Encoding channel "'+l+'" is not supported by mark type "'+i+'"';return i!==f.BAR||r.x||r.y?null:"Missing both x and y for bar"}},{"./mark":112,"vega-util":10}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),r=e("./util");n.isVgSignalRef=function(e){return!!e.signal},n.isVgRangeStep=function(e){return!!e.step},n.isDataRefUnionedDomain=function(e){return!i.isArray(e)&&"fields"in e&&!("data"in e)},n.isFieldRefUnionDomain=function(e){return!i.isArray(e)&&"fields"in e&&"data"in e},n.isDataRefDomain=function(e){return!i.isArray(e)&&"field"in e&&"data"in e},n.isSignalRefDomain=function(e){return!i.isArray(e)&&"signal"in e};n.VG_MARK_CONFIGS=r.flagKeys({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,limit:1,dx:1,dy:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1})},{"./util":125,"vega-util":10}]},{},[108])(108)});